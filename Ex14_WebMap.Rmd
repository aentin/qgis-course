---
editor_options: 
  markdown: 
    wrap: sentence
---

# (PART) Веб-картографирование {.unnumbered}

# Создание веб-карты {#web-map}

[Файл отчёта]()

## Введение {#web-map-intro}

**Цель задания** --- получение навыков создания веб-карт с использованием QGIS.

**Необходимая теоретическая подготовка:** модели пространственных данных, модели пространственных объектов, базы пространственных объектов, картографические проекции.

**Необходимая практическая подготовка:** Знание основных компонент интерфейса QGIS (менеджер источников данных, таблица слоёв, фрейм карты, менеджер компоновок).
Работа с различными форматами источников пространственных данных.
Настройка символики и подписей объектов.
Владение базовыми ГИС-технологиями, в том числе пространственный и атрибутивный запросы.

**Исходные данные:** [Natural Earth](https://www.naturalearthdata.com/), [индекс-городов.рф](https://xn----dtbcccdtsypabxk.xn--p1ai/#/), [how-old-is-this.house](https://kontikimaps.ru/how-old/dataset?p=h-menu).

**Ожидаемый результат:** мультимасштабная веб-карта, доступная для просмотра по ссылке.

### Контольный лист {#web-map-checklist}

-   Добавить на карту слои пространственных данных
-   Подготовить слои пространственных данных с помощью атрибутивных и пространственных запросов
-   Оформить слои
-   Задать масштабные границы отображения слоёв
-   Экспортировать результат в виде веб-страницы
-   Опубликовать веб-страницу

### Аннотация {#web-map-annotation}

Веб-карты — это карты, предназначенные для использования в сети. Их основными достоинствами являются интерактивность, общедоступность и мультимасштабность. В рамках данного упражнения мы научимся создавать веб-карты с помощью QGIS, по ходу подготовки веб-карты закрепим полученные на предыдущих занятиях навыки.

## Получение и подготовка исходных данных {#web-map-init}
[В начало упражнения ⇡](#web-map)

### Получение пространственных данных

1. Скопируйте материалы к упражнению (файл GeoPackage) в свою рабочую директорию
1. Создайте проект QGIS и сохраните его в свою рабочую директорию
1. Добавьте в созданный проект все слои, содержащиеся в скопированном наборе данных
1. Изучите слои
1. Временно отключите слой со зданиями

### Подготовка слоя регионов ЦФО

1. Выберите из слоя с регионами мира регионы Центрального Федерального округа (ЦФО) РФ
1. Экспортируйте регионы ЦФО в отдельный слой
1. Добавьте в проект слой с регионами ЦФО
1. Удалите из проекта слой со всеми регионами мира

### Подготовка слоя городов ЦФО

1. Выберите из слоя с городами РФ города в пределах ЦФО
1. Экспортируйте города ЦФО в отдельный слой
1. Добавьте в проект слой с городами ЦФО
1. Удалите из проекта слой со всеми городами РФ
1. Изучите атрибутивную таблицу слоя с городами ЦФО.

*За что отвечают поля с суффиксом "\_points" (ответ для каждого поля)?*

### Расчёт среднего качества городской среды в регионе

Подсчитайте среднее значение поля "total_points" для регионов ЦФО: используйте инструмент Vector \> Analysis Tools \> Count Points in Polygon..., чтобы подсчитать сумму баллов "total_points" всех городов в регионе, и используйте его, чтобы подсчитать количество городов в регионе; используйте калькулятор полей, чтобы получить среднее значение индекса городов в каждом регионе (используйте целое число для хранения данных).

## Оформление карты

[В начало упражнения ⇡](#web-map)

1. Оставьте слои с регионами ЦФО, для которых подсчитаны средние значения индекса, городами ЦФО, зданиями города Владимир.
1. Для городов используйте поле "total_points", примените градиурованный знак, выполните классификацию городов (количество классов, вариант классификации и шкалы подберите самостоятельно, учитывая особенности картографируемого показателя).
1. Аналогичную классификацию примените к слою с регионами ЦФО (шкала, количество классов и их граничные значения должны совпадать со слоем городов), используйте рассчитанное поле со средним значением индекса в регионе.
1. Для зданий используйте поле с годом постройки, границы классов задайте самостоятельно (примените, например, знания об истории России или особенности распределения значений показателя в слое), отключите обводку полигонов.

*Зачем мы устанавливаем аналогичное оформления для слоя городов и слоя регионов?  Скриншот*

## Подготовка к публикации

[В начало упражнения ⇡](#web-map)

### Перевод

Необходимо заменить английские наименования полей на русские, чтобы пользователю было удобнее работать с информацией на карте.

1. В слое с регионами назовите по-русски поля с названием региона и со средним значением индекса качества городской среды. Экспортируйте его в новый слой, оставив только переведённые поля.
1. В слое с городами назовите по-русски поля с названием города и поля с суффиксом "_points". Экспортируйте его в новый слой, оставив только переведённые поля.
1. В слое со зданиями назовите по-русски поле "r_year_int" и другие поля на своё усмотрение. Экспортируйте его в новый слой, оставив только переведённые поля.

*Зачем выполняется экспорт в новый слой? Почему после перевода названий полей исчезают слои?*

### Мультимасштабность

В мелком масштабе нецелесообразно показывать городские здания, а в крупном — регионы.

Для определения мультимасштабности используйте вкладку Rendering в свойствах слоя. Регионы должны отображаться в масштабах мельче 1:1 000 000. Города — в масштабах от 1:2 000 000 до 1:100 000. Здания — в масштабах крупнее 1:100 000.

### Добавление базовой карты

Для добавления базовой карты используйте плагин QuickWebServices (Web > QuickWebServices > CartoDB > Positron).

> Лицензии ряда базовых карт жёстко ограничивают возможности их использования. Например, подложку Яндекс карт можно использовать только в сервисах на основе API Яндекс карт. При создании веб-карт, доступных в глобальной сети, к этому надо относиться особенно внимательно.

## Публикация карты

[В начало упражнения ⇡](#web-map)

Чтобы карта стала доступна в Интернете, её надо экспортировать в виде веб-страницы и разместить её на веб-сервере (мы для этого используем бесплатные возможности сервиса Netlify).

1. Установите плагин qgis2web
1. Приблизьтесь к карте так, как бы хотели, чтобы она выглядела при публикации. Создайте веб-карту на основе проекта Web > qgis2web > Create web map.
    1. Для каждого из полей во всплывающем окне кроме полей с индексами установите строчную подпись (inline label).
    1. В качестве движка для создания веб-карты выберите OpenLayers или Leaflet.
    1. Во вкладке Appearance добавьте список слоёв и возможность поиска городов по названию.
    1. Во вкладке Export задайте папку, куда будет экспортирована папка с веб-картой.
1. Зарегистрируйтесь на Netlify
1. Зайдите в аккаунт и перенесите папку с веб-страницей карты в соответсвующее окно.
1. В настройках сайта замените имя сайта по собственному усмотрению.

![](images/Ex14_WebMap/deploy_site.png)