[["index.html", "Основы геоинформатики: практикум в QGIS Общие сведения Учебные материалы Программное обеспечение для работы", " Основы геоинформатики: практикум в QGIS Андрей Энтин, Тимофей Самсонов, Андрей Карпачевский 2024-03-12 Общие сведения Практикум предназначен для курса «Основы геоинформатики» для студентов 2 года обучения географического факультета МГУ имени М.В. Ломоносова. Упражнения выполяются в свободно распространяемом ГИС-пакете QGIS. Если вы ищете практикум на основе ArcGIS, то он находится тут. Учебные материалы Презентации: Самсонов Т. Е. Основы геоинформатики: курс лекций для студентов географического факультета МГУ, 2023. Website Учебное пособие: Лурье И. К., Самсонов Т. Е. Информатика с основами геоинформатики. Часть 2. Основы геоинформатики. Учебное пособие. Москва. Изд-во МГУ, 2016. PDF Учебник: Лурье И. К. Геоинформационное картографирование. Методы геоинформатики и цифровой обработки космических снимков: Учебник для вузов. 2-е изд. – М.: КДУ, 2010. DJVU Практикум в QGIS: Энтин А. Л., Самсонов Т. Е., Карпачевский А.М. Основы геоинформатики: практикум в QGIS. Website Практикум в ArcGIS: Самсонов Т. Е. Основы геоинформатики: практикум в ArcGIS. — Географический факультет МГУ Москва, 2018. — 460 с. DOI: 10.5281/zenodo.1167857. Website Программное обеспечение для работы Для работы вам потребуется скачать и установить на свои компьютеры геоинформационное приложение QGIS. Это свободно распространяемое программное обеспечение, для его установки не требуется покупка или регистрация. Windows Скачайте с официального сайта последнюю версию QGIS. По состоянию на 7 февраля 2023 г. это версия 3.28.3-1. Скачать. Если на вашем компьютере уже установлена более старая версия QGIS, удалите её перед началом установки новой версии. Вы можете использовать старую версию QGIS для выполнения большинства заданий практикума, однако, если у вас возникнут технические проблемы, Когда исполняемый файл загрузится, запустите его. Если потребуется, разрешите приложению вносить изменения на вашем устройстве. Будет показано приветственное окно мастера установки. Нажмите «Далее» (Next), чтобы перейти на следующий шаг. Окно мастера установки QGIS На следующем шаге будет показано лицензионное соглашение QGIS и другого программного обеспечения, входящего в пакет поставки. Установите галочку напротив опции «Я принимаю условия лицензионного соглашения» (I accept the terms in the License Agreement) и нажмите «Далее» (Next). Лицензионное соглашение На следующем шаге выберите папку для установки и отметьте, нужно ли создавать ярлыки на рабочем столе и в меню «Пуск». По возможности используйте параметры, предлагаемые по умолчанию. Опции установки На следующем шаге предлагается запустить процедуру установки. Нажмите «Install». Когда система выдаст запрос на внесение изменений, примите его. Запуск установки Дождитесь окончания установки Процесс установки После окончания установки может произойти так, что окно установщика будет смещено с дисплея целиком или частично. В этом случае кликните на иконку окна установщика в панели задач, а затем нажмите Enter. Когда установка будет завершена, вы сможете запустить QGIS одним из следующих способов: с помощью ярлыка QGIS Desktop 3.28.3 из папки QGIS Desktop 3.28.3 на рабочем столе; с помощью ярлыка приложения QGIS Desktop 3.28.3 в меню «Пуск» macOS Скачайте с официального сайта образ диска QGIS последней вышедшей версии. По состоянию на 7 февраля 2023 г. это версия 3.28.3-1. Скачать. Страница загрузки QGIS для macOS После того как образ загрузится, запустите его. В открывшемся окне нажмите кнопку «Agree», чтобы принять условия лицензионного соглашения. Лицензионное соглашение Дождитесь, пока нужные файлы будут распакованы. Распаковка образа По окончании распаковки появится окно, в котором нужно будет перетащить значок QGIS в папку «Приложения» (Applications). Окно установки Перетащите значок QGIS в папку «Приложения» (Applications). Это запустит процесс установки. Дождитесь, пока компьютер выполнит необходимые действия. Процедура установки Запустите приложение QGIS, чтобы убедиться в его работоспособности. Если установка выполнена корректно, откроется главное окно приложения. Главное окно приложения QGIS При первом запуске может потребоваться разрешение на использование приложений от сторонних разработчиков. В этом случае откройте настройки и включите соответствующую опцию. По окончании установки можно размонтировать («извлечь») образ диска QGIS. Извлечение виртуального образа с помощью контекстного меню Linux Воспользуйтесь инструкциями по этой ссылке. Дополнительную информацию по установке можно найти на https://qgis.org/ru/site/forusers/download.html. "],["map-design-general.html", "Упражнение 1 Создание общегеографической карты 1.1 Введение 1.2 Начало работы 1.3 Настройка системы координат 1.4 Навигация по карте 1.5 Оформление изображения рельефа 1.6 Добавление векторных наборов данных 1.7 Использование атрибутов объектов при визуализации 1.8 Подписи 1.9 Настройка компоновки карты", " Упражнение 1 Создание общегеографической карты Архив с исходными данными Контрольный лист 1.1 Введение Цель задания — знакомство с моделями пространственных объектов и пространственных данных, форматами хранения растровых и векторных данных. Визуализация данных на карте. Оформление легенды и компоновки карты. Необходимая теоретическая подготовка: модели пространственных данных, модели пространственных объектов, базы пространственных объектов, картографические проекции. Необходимая практическая подготовка: специальная практическая подготовка не требуется. Исходные данные: база географических данных на территорию Кавказских гор, собранная из нескольких источников. Ожидаемый результат: общегеографическая карта гор Кавказа и прилегающих территорий масштаба 1:4 500 000. 1.1.1 Контольный лист Добавить на карту слои растровых пространственных данных Создать изображение отмывки рельефа Добавить на карту слои векторных пространственных данных, настроить их оформление Настроить подписи объектов Создать компоновку карты и легенду Экспортировать результат в графический файл Перед началом работы рекомендуется включить отображение расширений имён файлов. 1.2 Начало работы В начало упражнения ⇡ Скачайте архив с исходными данными для упражнения. Распакуйте этот архив в свою рабочую директорию. В вашей рабочей директории должна появиться папка Ex01. Перед продолжением работы убедитесь, что это именно папка, а не файл архива. Запустите QGIS. Для запуска воспользуйтесь иконкой с названием QGIS Desktop ..., где ... — номер версии QGIS, установленной на вашем компьютере. Окно загрузки QGIS В открывшемся окне QGIS нажмите кнопку Создать новый проект , чтобы создать новый проект. Сохраните проект QGIS в папку Ex01, где лежат материалы к упражнению. Для этого нажмите иконку сохранения , в открывшемся окне проводника перейдите в папку Ex01 и введите название вашего проекта QGIS по шаблону: Ex01_Фамилия, где Фамилия — ваша фамилия латинскими буквами. Окно проводника с целевой директорией и именем проекта Окно QGIS должно принять вид, аналогичный показанному на изображении ниже: Окно QGIS после создания нового проекта Ряд действий в QGIS можно выполнить с помощью горячих клавиш. Так, для создания нового проекта можно нажать Ctrl+N, а для сохранения проекта — Ctrl+S. Сведения о доступных горячих главишах отображаются во всплывающих подсказках при наведении курсора на иконку. Найдите в рабочем окне QGIS панель браузера и разверните в нём домашний каталог проекта. Если панель браузера отключена, её можно включить в меню «Вид» — «Панели», пункт «Браузер». Панель браузера в окне QGIS Домашний каталог проекта — это папка (каталог, директория), где сохранён проект, в котором вы работаете в настоящий момент. В домашнем каталоге разверните содержимое директории raster_data. В этом каталоге отображается единственный источник данных — 30n030e_20101117_gmted_mea300.tif. Иконка и расширение *.tif (Tagged Image Tile Format) подсказывают вам, что этот источник представляет пространственные данные в растровой (регулярно-сеточной) модели. Растровый источник данных в панели браузера Замечание 1: растр, с которым вы будете работать сейчас, сохранён в формате GeoTIFF. От «обычного» TIFF этот формат отличается тем, что сведения о пространственной привязке в GeoTIFF записываются непосредственно в файл с данными, в то время как «обычный» формат TIFF не поддерживает запись сведений о пространственной привязке, поэтому она хранится отдельно — в world-файле. В дальнейшем вы часто будете работать и с тем, и с другим способом хранения пространственных данных. Замечание 2: файл 30n030e_20101117_gmted_mea300.tif является фрагментом («тайлом») глобальной цифровой модели рельефа (ЦМР) GMTED2010. Этот источник часто используется для геоинформационного анализа и картографирования. Загрузить тайлы GMTED2010 можно через сервис EarthExplorer геологической службы США. Дважды щёлкните левой кнопкой мыши на название файла 30n030e_20101117_gmted_mea300.tif в окне браузера. В панель слоёв (по умолчанию она находится слева) добавится слой с названием 30n030e_20101117_gmted_mea300. Окно QGIS после добавления нового растрового слоя Сохраните проект и сделайте снимок экрана. Снимок экрана №1. Окно QGIS после загрузки набора данных Примечание: файл проекта QGIS (*.qgs, *.qgz) и документ карты ArcGIS (*.mxd) отличаются от тех файлов, с которыми вы работали ранее (документы Word, таблицы Excel и т.п.). В файлах проекта хранятся не сами пространственные данные, а только ссылки на них и настройки их отображения (включая порядок слоёв, символику и подписи). Если вы перемещаете файл проекта относительно источников данных, ссылки «теряются». Поэтому важно правильно организовать структуру ГИС-проекта. В рамках нашего упражнения мы разместили файл проекта в директории более высокого уровня по отношению к тем директориям, где лежат данные. Теперь, если мы переместим всю папку Ex01 вместе со всем её содержимым, относительные пути от файла проекта до файлов данных не изменятся, и проект сохранит работоспособность. Конечно, такое решение не будет оптимальным для крупных организаций с разветвлённой структурой сетевых ресурсов, но для студенческих проектов оно, как правило, работает. 1.3 Настройка системы координат В начало упражнения ⇡ В правом нижнем углу карты вы видите надпись . Нажмите на эту надпись, чтобы открыть интерфейс выбора системы координат проекта. Свойства проекта: системы координат В открывшемся окне вы видите более подробную информацию об используемой системе координат. Код EPSG:4326 соответствует системе географических координат WGS 84. Термин «географическая система координат» (geographic coordinate systems) в ГИС означает, что координаты объектов и линейные параметры растров хранятся в виде широты и долготы. Альтернативный подход — проецированные системы координат (projected coordinate systems), где плановые координаты измеряются в метрических единицах. Система координат проекта была импортирована из первого (в нашем случае — пока единственного) загруженного источника пространственных данных. Система координат WGS 84 обычно не используется для картографирования, поэтому мы изменим систему координат проекта. Для выбора проекции воспользуемся инструментом, который позволяет оптимизировать этот процесс — Projection Wizard. Перейдите на сайт Projection Wizard. Настройте параметры территории и проекции следующим образом: класс проекции по виду искажений: равнопромежуточная (Equidistant); охват территории картографирования: примерно как показано на рисунке ниже Если все сделано верно, то окно приложения должно принять приблизительно следующий вид: Вам будет предложено две проекции. Нажмите на ссылку PROJ, соответствующую косой азимутальной проекции (англ. oblique azimuthal). На экране будет отображено всплывающее окно с параметрами выбранной проекции в формате PROJ. Скопируйте строку PROJ в буфер обмена и вставьте скопированную строку в отчётный документ. С помощью сайта Projection Wizard вы успешно создали новое определение системы координат. Теперь нужно ввести это определение во внутреннюю базу QGIS. В QGIS откройте меню Настройки — Пользовательские проекции… Нажмите кнопку Добавить систему координат В полях для ввода ниже введите название проекции: Azimuthal Equidistant (Caucasus), в поле Формат выберите Proj, в поле Параметры вставьте скопированную строку PROJ. Определение новой системы координат Замечание: формат PROJ помечен в QGIS как устаревший и не рекомендуемый, но тем не менее мы используем его в этом упражнении, потому что использование более совершенного формата WKT может привести к ошибкам QGIS на следующих шагах. Нажмите кнопку Проверить, чтобы убедиться, что синтаксис вставленной строки корректен Нажмите ОК. Вы успешно добавили новую систему координат в пользовательский список. Теперь нужно применить её к проекту. Откройте интерфейс выбора системы координат. Это можно сделать нажатием на элемент в правом нижнем углу, или через меню Проект — Свойства… (вкладка Система координат). В открывшемся меню найдите в списке свою проекцию (для этого можно использовать поле “Фильтр” вверху окна), выберите её и нажмите ОК. Новая система координат в окне параметров проекта Если все сделано верно, изображение ЦМР должно приобрести форму сфероидической трапеции. Сделайте снимок экрана и вставьте его в отчётный файл. Проект с изменённой системой координат Сохраните проект и сделайте снимок экрана Снимок экрана №2. Окно QGIS после изменения проекции Закройте интерфейс выбора системы координат и нажмите правой кнопкой на слой 30n030e_20101117_gmted_mea300 в таблице слоёв. В контекстном меню выберите Свойства… и в открывшемся окне перейдите на вкладку Информация. Вы видите, что проекция набора данных не изменилась. QGIS, как и большинство ГИС-пакетов, умеет трансформировать наборы данных для отображения их в целевой проекции. На жаргоне ГИС-специалистов это называется «перепроецирование на лету» (reprojection on the fly). 1.4 Навигация по карте В начало упражнения ⇡ Чтобы иметь возможность рассмотреть территорию картографирования более детально, потребуется увеличить масштаб и переместить изображение. Изучите функциональные возможности инструментов навигациии, которые расположены на панели инструментов Map Navigation (если панель отсутствует, щелкните на пустом поле среди панелей инструментов, и активируйте соответствующий пункт в меню): Инструменты перемещения по карте Некоторые инструменты навигации могут быть задействованы независимо. Например, масштабирование выполняется прокруткой колеса мыши, а перемещение по карте — движением мыши с зажатой средней кнопкой. Режим панорамирования (перемещения карты) также активируется нажитием пробела. Зажмите пробел и просто двигайте курсор мышкой или тачпадом. Нажимать кнопку мыши или тачпад при этом не надо! После того как инструменты навигации станут понятны, установите масштаб карты равным \\(1:5~000~000\\). Это можно сделать в элементе Масштаб в нижней панели QGIS. При этом достаточно ввести только знаменатель масштаба, выделив его двойным кликом и заменив на нужное значение без пробела (5000000). После этого переместите изображение таким образом, чтобы Кавказские горы занимали картографическое изображение целиком по ширине. Охват данных для продолжения работы над картой 1.5 Оформление изображения рельефа В начало упражнения ⇡ Изображение рельефа, которые вы видите, представляет собой так называемую аналитическую отмывку по высоте. Для аналитической отмывки используется шкала оттенков серого, применяемая по умолчанию. Мы будем использовать аналитическую отмывку по высоте вместе со светотеневой отмывкой. Откройте свойства слоя 30n030e_20101117_gmted_mea300 и перейдите на вкладку Стиль. Измените тип представления с Одноканальное серое на Одноканальное псевдоцветное. Установите минимальное значение равным 0, а максимальное значение — 4000. Настройки стиля растра В строке выбора градиента («Градиент») нажмите правой кнопкой на шкалу и в открывшемся контекстном меню выберите опцию Создать новый градиент… Создание нового градиента В появившемся всплывающем окне в ниспадающем списке выберите тип градиента Каталог: cpt-city Выбор каталога градиентов Подробнее о cpt-city вы можете прочитать здесь В открывшемся каталоге в разделе Topography выберите градиент c3t3 и нажмите OK Выбор градиента После нажатия OK были закрыты все окна, кроме окна свойств слоя 30n030e_20101117_gmted_mea300. Нажмите OK, чтобы применить изменения символики и закрыть окно свойств слоя. Окно проекта QGIS примет вид, аналогичный показанному на рисунке ниже. Окно QGIS после применения стиля слоя Вы успешно применили аналитическую отмывку по высоте к цифровой модели рельефа. Но для красочного, визуально привлекательного изображения этого недостаточно. Помимо аналитической отмывки по высоте, мы создадим светотеневую отмывку. Переименуйте слой 30n030e_20101117_gmted_mea300 в Аналитическая отмывка. Для этого откройте контекстное меню слоя (нажмите на слой в таблице слоёв правой кнопкой мыши) и выберите опцию «Переименовать слой». Названия слоёв никак не затрагивают источник пространственных данных. До тех пор, пока вам не приходится работать со слоями с помощью скриптов на языке Python, вы можете никак не ограничивать себя в названиях. Используя контекстное меню, создайте дубликат слоя Аналитическая отмывка (опция называется «Дублировать слой»). Дубликат слоя будет помещён в таблице слоёв ниже исходного слоя, его отображение будет отключено, а к его имени будет приписано “копия”. Дубликат представляет собой самостоятельный слой, после его создания он никак не связан с исходным слоем. Обратите внимание, что оба слоя используют один и тот же источник данных. Вы можете сделать сколько угодно слоёв с разными настройками визуализации на базе одного и того же набора пространственных данных. Но если вы измените используемый набор пространственных данных, это повлечёт за собой автоматическое изменение вида слоёв (но не настроек их визуализации). Назовите новый слой Светотеневая отмывка, включите его отображение и переместите его наверх панели слоёв. Слои в QGIS отрисовываются последовательно в том порядке, в котором они перечислены в панели слоёв. Сначала визуализируется самый нижний слой, затем второй снизу и так далее. Откройте свойства слоя «Светотеневая отмывка» и перейдите на вкладку «Стиль». Измените способ визуализации на Теневой рельеф и нажмите Применить. При этом изменения будут применены, но окно свойств не закроется. Окно QGIS после применения стиля слоя «Светотеневая отмывка» На этом шаге вы видите изменения, произошедшие с вашим слоем. Во-первых, изображение светотеневой отмывки полностью закрыло изображение аналитической отмывки по высоте. Эту проблему можно решить, включив настройки прозрачности для слоя. Во-вторых, сама светотеневая отмывка выглядит очень тёмной. Это связано с несовпадением единиц измерения «по горизонтали» и «по вертикали» в исходном наборе данных: ячейки растра образут градусную сетку, а высотные отметки хранятся в метрах. Проблему можно решить двумя путями: трансформировать слой в проецированную систему координат или применить коэффициент масштабирования по оси Z (Z-factor). Мы пойдём вторым путём и будем изменять значение коэффициента масштабирования. Коэффициент масштабирования представляет собой переводной коэффициент из «вертикальных» единиц измерения в «горизонтальные». Для растров на градусной сетке, коэффициент, строго говоря, будет различным по широте и долготе в силу сближения меридианов. Тем не менее, в качестве первого приближения можно рассчитать этот коэффициент, исходя из длины 1° меридиана: \\(1° / 111 км \\approx 9 \\cdot 10^{-6} °/м\\), или \\(0,000009\\). Но если мы применим именно такой коэффициент масштабирования по Z, изображение будет выглядеть очень плоским, поскольку превышения на местности значительно меньше расстояний. Чтобы сделать изображение более рельефным, применяют дополнительный множитель в пределах от 1,5 до 10. Мы воспользуемся коэффициентом 5. Таким образом, целевое значение коэффициента масштабирования по оси Z составит \\(0,000045\\). Вернитесь в окно свойств слоя, если вы закрыли его, и на вкладке Стиль введите значение коэффициента масштабирования по Z, равное \\(0,000045\\). Перейдите на вкладку Прозрачность и установите коэффициент непрозрачности для слоя равным 50 %. Примените изменения и закройте окно свойств слоя. Окно QGIS после изменения свойств светотеневой отмывки Сохраните проект и сделайте снимок экрана. Снимок экрана №3. Изображение рельефа с высотной и светотеневой отмывкой Далее мы не будем напоминать вам о необходимости сохранять проект. Делайте это сами после каждого значительного изменения в проекте. Примечание для картографов: настройки визуализации рельефа, которые применяются в этом упражнении, подобраны приблизительно, без предварительного анализа распределения высот картографируемой территории и выбора оптимальной шкалы. Эти вопросы подробно освещаются в курсах «Оформление карт» и «Общегеографическое картографирование», читаемых на кафедре картографии и геоинформатики 1.6 Добавление векторных наборов данных В начало упражнения ⇡ Раскройте содержимое папки vector_data в домашнем каталоге проекта Содержимое папки vector_data Вы видите несколько источников данных, обозначенных символом . Это векторные наборы данных, представленные в формате шейп-файлов. Теперь откройте эту же директорию через Проводник Windows (или любой другой файловый менеджер). Сравните количество файлов в Проводнике с количеством доступных источников данных в браузере QGIS Шейп-файлы были базовым форматом ГИС-пакета ArcView и за счёт этого получили очень широкое распространение. Шейп-файлы не такие функциональные, как базы геоданных ESRI (современный базовый формат для продуктов линейки ArcGIS) или GeoPackage, но тем не менее их продолжают активно использовать. Многие особенности шейп-файлов обусловлены спецификой и возможностями компьютеров начала 90-х гг. В частности, геометрия набора данных хранится отдельно (в файле *.shp), семантика — отдельно (в формате dBASE, *.dbf), а для связи между ними используется индекс-файл (*.shx). Эти три файла — обязательные компоненты шейп-файла. Помимо них, отдельно могут быть записаны сведения о проекции (*.prj), кодировке (*.cpg) и многое другое. Основным файлом, тем не менее, считается *.shp, а все остальные на компьютерном сленге называются sidecar-файлами. Важно: при копировании шейп-файлов через Проводник необходимо копировать все файлы с одинаковым именем Добавьте на карту наборы данных об объектах гидрографии (hydrography-polyline.shp, hydrography-polygon.shp). В таблице слоёв разместите линии над полигонами. Переименуйте слои в «Водотоки» и «Водоёмы» соответственно. Все векторные наборы данных для этого упражнения созданы на основе цифровых географических основ ВСЕГЕИ. До недавнего времени это был лучший источник мелкомасштабных общегеографических пространственных данных на территорию Российской Федерации и сопредельных стран. По состоянию на 6 февраля 2024 г. ВСЕГЕИ переименован в Институт Карпинского, а приведённая ссылка не работает, но коллектив авторов надеется, что рано или поздно географические основы будут вновь доступны свободно. Настройте символику для добавленных векторных наборов данных. Также, как и для растров, настройки символики векторных данных помещаются в свойствах слоя, на вкладке Стиль. Для полигонов гидрографии установите стандартный стиль topo water из библиотеки QGIS. Для линейных объектов используйте стандартный стиль simple blue line, но уменьшите толщину линии до 0,26 мм Настройки стиля полигональных объектов Настройки стиля линейных объектов Если приглядеться, то можно увидеть, что знак контура береговой линии и знаки линейных объектов гидрографии на суше не совпадают. Можно изменить цвет и толщину обводки для полигонов объектов гидрографии, сделав их такими же, как у рек и каналов. Добавьте к карте железные дороги и автодороги. Переименуйте слои и изобразите их линиями толщиной 0,26 мм. Для автодорог используйте красный цвет, для железных дорог — тёмно-серый (20 % светлоты). После всех операций окно QGIS должно принять вид, аналогичный изображению ниже. Окно QGIS после добавления слоёв гидрографической сети и путей сообщения 1.7 Использование атрибутов объектов при визуализации В начало упражнения ⇡ До этого момента мы работали только визуальным представлением слоя и никак не касались семантической составляющей. На следующем шаге вы будете использовать разные значки для различных типов объектов в одном слое. Добавьте к карте набор данных adm_line, переместите добавленный слой ниже всех линейных объектов и переименуйте его в «Границы». Вызовите контекстное меню слоя «Границы» и выберите опцию «Открыть таблицу атрибутов». Откроется таблица атрибутов источника данных. Таблица атрибутов слоя «Границы» Таблица атрибутов — это представление базы данных, связанной с набором пространственных объектов. База функционирует по общим правилам реляционной базы данных: каждый объект представляется одной «строкой», в каждом столбце (поле) одному объекту соответствует одно значение. Атрибуты играют важную роль в геоинформационных системах. На их основе происходит визуализация данных, также они участвуют в большинстве операций пространственного анализа. В этом упражнении вы используете атрибуты, чтобы присвоить различные стили объектам в одном слое. Закройте таблицу атрибутов. Откройте свойства слоя границ на вкладке Стиль. Измените тип визуализации с Простая симолика на Символизация по уникальным значениям. Эта настройка позволяет присваивать объектам различные стили в соответствии со значениями определённого атрибута. Способы визуализации векторных наборов пространственных данных в QGIS В выпадающем списке Поле выберите столбец L_TYPE, по которому будет происходить классификация, и нажмите кнопку Классифицировать внизу формы. В форму добавились три записи. Две из них представляют фактически имеющиеся значения атрибутов, третья — «пустая» — предназначена для визуализации всех остальных значений (которых фактически нет в таблице на настоящий момент, но которые могут появиться позже в результате редактирования). Рассчитанные классы с разными условными знаками Дважды щёлкните на значке, соответствующем классу Границы государственные. Откроется уже знакомый вам интерфейс настройки условных знаков. Обратите внимание на форму в левом верхнем углу: вы можете задать несколько слоёв для одного условного знака, используя опцию добавления слоёв (). Слои в таблице слоёв и слои условного знака — это две разные, не связанные между собой сущности. Создайте для государственных границ двухслойный знак. Нижний слой: линия серого цвета (75 % светлоты) шириной 1 мм, с плоскими концами (чтобы концы линии не «свешивались» в воду). Верхний слой: линия тёмно-серого цвета (светлота 20 %) толщиной 0,26 мм, штрихпунктирная, с плоскими концами. Настройки визуализации линий границ Создайте аналогичный знак для границ субъектов РФ. Нижний слой: линия серого цвета (75 % светлоты) шириной 0,8 мм, с плоскими концами. Верхний слой: линия тёмно-серого цвета (светлота 20 %) толщиной 0,26 мм, штриховая, с плоскими концами. Для прочих границ используйте однослойный условный знак: пунктирная линия тёмно-серого цвета. 1.8 Подписи В начало упражнения ⇡ Добавьте на карту набор данных elevation_points.shp, расположите слой на самом верху списка и переименуйте его в Вершины. Настройте отображение единым знаком в виде чёрного треугольника, аналогично тому, как показываются отметки высот в школьных географических атласах. Откройте таблицу атрибутов слоя. Какие поля можно использовать для подписей? На общегеографических картах обычно приводятся высоты и названия горных вершин. В этом упражнении мы ограничимся названиями. Закройте таблицу атрибутов и откройте свойства слоя. Перейдите на вкладку «Подписи». Переключите режим подписей на Обычные подписи (подписывать объекты значением атрибута). В открывшемся меню в выпадающем списке «Подписывать значениями» выберите поле NAME — тексты подписей будут «считываться» из него. Вкладка настройки текста В поле Образец текста отображается пример подписи с теми настройками, которые заданы по умолчанию. Если вы будете менять настройки подписей (шрифт, форматирование, «гало» и др.), этот пример будет меняться. Сейчас мы последовательно пройдём по вкладкам настройки подписей, исправив необходимые параметры. На вкладке Текст установите гарнитуру («шрифт») Times New Roman, начертание («стиль») полужирный курсив, кегль («размер») 8. На вкладке Буфер включите опцию «Буферизовать подписи» и задайте буферизацию размером 0,6 мм. Это повысит читаемость подписей на карте. На вкладке Размещение выберите опцию «Картографическое», расстояние 0,1 мм от границ знака (from symbol bounds) Примените настройки подписей и закройте свойства слоя. Окно QGIS после добавления слоёв границ и отметок высот В каталоге vector_data остался незадействованный слой — населённые пункты (population_points). Добавьте его в проект, переименуйте и самостоятельно настройте условные знаки и подписи. Используйте параметр уникальные значения для того, чтобы отобразить города с разной численностью населения разными условными знаками. После завершения настройки населённых пунктов сделайте снимок экрана Снимок экрана №4. Окно QGIS после завершения настройки символов 1.9 Настройка компоновки карты В начало упражнения ⇡ Изображение, которое вы видите во фрейме данных, можно экспортировать в отдельный графический файл «как есть» (с помощью опции Проекты — Импорт/экспорт — Экспортировать карту как изображение…). Однако для картографических целей, как правило, формируется компоновка карты. На листе заданного формата размещается картографическое изображение, добавляется название, легенда, масштабная линейка и элементы зарамочного оформления. Сейчас мы создадим макет компоновки с расчётом на то, что итоговая карта будет вставлена в отчёт. Создайте новый макет компоновки (Проект — Создать Макет…) или Ctrl+P. Введите название макета: Ex01_%Фамилия%, где %Фамилия% — ваша фамилия на русском языке. После ввода названия откроется окно компоновки (Layout) Новый макет компоновки Добавьте на лист картографическое изображение. Для этого используется инструмент Добавить карту из панели инструментов. Выберите инструмент и «растяните» прямоугольник карты на листе. Инструмент добавления карты После добавления элемента откроется панель его свойств. Изучите настройки, доступные в этой панели, а затем установите для карты знаменатель масштаба 4 000 000 и размеры \\(237\\times130\\) мм. В том же разделе, где устанавливаются размеры элемента, задайте для элемента карты положение по \\(X = 30\\) мм и положение по \\(Y = 30\\) мм. Положение элемента на листе отсчитывается от верхнего левого угла листа до точки привязки элемента. Картографическое изображение в макете компоновки Добавьте к карте градусную сетку. Для этого в свойствах элемента найдите раздел Сетки, нажмите на кнопку Добавить новую сетку, а затем Настроить сетку… (Modify Grid). Откроется меню настройки сетки. Задайте для сетки проекцию WGS84, интервал по долготе — \\(4°\\), интервал по широте — \\(2°\\). Также уменьшите толщину линий сетки до \\(0.1\\) мм. Для этого щёлкните левой кнокой мыши по элементу Стиль линии и выполните необходимые настройки в уже привычном для вас интерфейсе. Вернуться обратно к настройкам сетки можно, нажав на кнопку Назад в левом верхнем углу интерфейса. Панель настроек сетки Добавьте рамку сетки в виде простой линии. Для этого в свойствах элемента в разделе Рамка установите настройку Стиль области: Линия границы Настройка рамки сетки Включите отображение подписей координатной сетки. Для этого в настройках координатной сетки отметьте флажок Отображение координат. Настройте отображение подписей так, чтобы широта подписывалась только вдоль западной и восточной рамки, а долгота — только вдоль северной и южной. Используйте формат координат Десятичные с окончанием и нулевое число знаков после запятой (этот параметр в QGIS называется Точность координат). Панель настроек координат сетки Вернитесь к макету и передвиньте картографическое изображение внутри элемента таким образом, чтобы вместилась вся основная часть Главного Кавказского хребта. Можно ориентироваться на города: в северо-западном углу карты должен отображаться Краснодар, в юго-восточном — Баку. При необходимости можно уменьшить масштаб карты. Для перемещения карты внутри фрейма используется инструмент Перемещение содержимого элемента . Добавьте на лист название карты. Для этого вставьте новую надпись и разместите её над элементом карты. Введите название карты «Кавказские горы», используйте выключку (горизонтальное выравнивание) по центру, настройте параметры шрифта на своё усмотрение (заголовки обычно набираются прописными буквами с разреженным кернингом). Макет компоновки после добавления названия Добавьте на лист масштабную линейку с помощью кнопки Добавить масштабную линейку . Переместите линейку в юго-западный угол карты, установите для неё отображение фона и границы. Если необходимо, уменьшите высоту линейки, кегль шрифта и отступы подписей, чтобы линейка смотрелась более компактно. Добавьте на лист легенду с помощью кнопки Добавить легенду . Легенда будет собрана автоматически на основе тех настроек визуализации, которые применены для слоёв карты. Отредактируйте легенду. Для этого сначала выключите автообновление (Auto update) элементов легенды, чтобы сделать список элементов доступным для редактирования. Сохраните в легенде только условные знаки населённых пунктов и границ, а также переименуйте неинформативные или пустые подписи. Добавьте обводку для элемента легенды и разместите легенду в северо-восточном углу карты. Макет компоновки после добавления масштабной линейки и легенды Добавьте ещё один текстовый элемент и впишите в него сведения об авторстве. Экспортируйте получившуюся карту в изображение формата PNG («Макет» — «Экспорт в изображение…» или специальная кнопка на главной панели инструментов макета). Энтин А.Л., Самсонов Т.Е., Карпачевский А.М. Основы геоинформатики: практикум в QGIS. М.: Географический факультет МГУ, 2024. "],["map-design-world.html", "Упражнение 2 Создание политической карты мира 2.1 Введение 2.2 Начало работы 2.3 Загрузка исходных данных 2.4 Создание ГИС-проекта и загрузка данных в проект 2.5 Настройка системы координат проекта 2.6 Окраска стран в разные цвета 2.7 Добавление других слоёв на карту 2.8 Создание компоновки карты", " Упражнение 2 Создание политической карты мира Контрольный лист 2.1 Введение Цель задания — закрепление навыков загрузки и визуализации данных в QGIS. Необходимая теоретическая подготовка: модели пространственных данных, модели пространственных объектов, базы пространственных объектов, картографические проекции. Необходимая практическая подготовка: не требуется. Исходные данные: Natural Earth. Ожидаемый результат: политическая карта мира М 1:130 000 000 2.1.1 Контольный лист Добавить на карту источники пространственных данных Создать определение проекции Настроить отображение объектов на карте различными цветами в соответствии с данными в таблице атрибутов Скомпоновать картографическое изображение Экспортировать результат в графический файл 2.2 Начало работы В начало упражнения ⇡ Работа с пространственными данными обычно подразумевает одновременное использование множества файлов и баз данных, которые могут располагаться как на вашем локальном компьютере, так и в локальной сети или в Интернете. Хотя в реальной практике использования ГИС обычно применяется сетевое размещение ресурсов, в этом упражнении и далее в курсе геоинформатики вы, как правило, будете организовывать все ресурсы ваших ГИС-проекты в локальных директориях. Создайте или выберите директорию (папку) для упражнений по геоинформатике на вашем рабочем компьютере. Например, для компьютеров под управлением ОС Windows: D:\\GIS\\207_CAR\\Ivanov. Мы настоятельно рекомендуем, чтобы полный путь к рабочей директории не содержал символов русского алфавита, диакритики или других специальных символов. В рабочей директории создайте папку для текущего упражнения, например, Ex02. Все данные, относящиеся к этому упражнению, будут находиться здесь. В папке для текущего упражнения создайте ещё одну вложенную папку. Назовите её data. В эту папку вы будете помещать пространственные данные, которые получите на последующих этапах. 2.3 Загрузка исходных данных В начало упражнения ⇡ Работа в ГИС — это в первую очередь работа с пространственными данными. Пространственные данные могут иметь различную форму представления, уровень детализации, назначение и лицензионные ограничения на использование. В этом упражнении мы воспользуемся данными ресурса Natural Earth. Это наборы пространственных данных низкой детализации, предназначенные для создания карт мелкого масштаба (1:10 000 000, 1:50 000 000, 1:110 000 000). Важно, что все данные находятся в свободном доступе — вы можете использовать их без ограничений как в учебных и научных задачах, так и в коммерческих проектах. Посмотрите вкладку About, чтобы узнать больше о Natural Earth. Перейдите на страницу загрузок Natural Earth (https://www.naturalearthdata.com/downloads/). На этой странице перейдите в раздел Cultural, соответствующий самому мелкому масштабу. Скачайте набор данных Admin 0 – Countries. На ваш компьютер будет загружен архив в формате ZIP. Этот формат поддерживается большинством современных программ для архивирования и разархивирования файлов. Распакуйте содержимое архива в папку data, созданную на предыдущем шаге. Сам архив можно удалить. Содержимое архива составляют пространственные данные в виде шейп-файла ESRI, а также несколько сопроводительных файлов Шейп-файлы были базовым форматом ГИС-пакета ArcView и за счёт этого получили очень широкое распространение. Шейп-файлы не такие функциональные, как базы геоданных ESRI (современный базовый формат для продуктов линейки ArcGIS) или GeoPackage, но тем не менее их продолжают активно использовать. Многие особенности шейп-файлов обусловлены спецификой и возможностями компьютеров начала 90-х гг. В частности, геометрия набора данных хранится отдельно (в файле .shp), семантика — отдельно (в формате dBase, .dbf), а для быстрого поиска по пространственным данным используется индекс-файл (.shx). Эти три файла — обязательные компоненты шейп-файла. Помимо них, отдельно могут быть записаны сведения о проекции (.prj), кодировке (.cpg) и многое другое. Основным файлом, тем не менее, считается .shp, а все остальные на компьютерном сленге называются sidecar-файлами. Все файлы в составе шейп-файла имеют одинаковые имена, но разные расширения. Изучите содержимое папки после разархивирования. Удалите файлы, которые не входят в состав шейп-файла. Определите назначение остальных файлов. 2.4 Создание ГИС-проекта и загрузка данных в проект В начало упражнения ⇡ Запустите QGIS. Для запуска можно воспользоваться ярлыком QGIS Desktop &lt;…&gt; или QGIS Desktop &lt;…&gt; with GRASS &lt;…&gt;. Второй ярлык одновременно с QGIS запускает сессию GRASS, что позволяет задействовать инструменты GRASS изнутри QGIS. В этом упражнении вы не будете использовать инструменты GRASS, поэтому можно воспользоваться любым ярлыком для запуска. Сохраните проект в папку с материалами текущего упражнения (в нашем примере — Ex02) под именем Ex02_*Surname* (вместо surname вставьте вашу фамилию в латинской транслитерации). Чтобы сохранить проект, воспользуйтесь опцией «Сохранить» из меню «Проект» или кнопкой на панели инструментов проекта. Проект QGIS версии 3 имеет расширение *.qgz. Для самопроверки: проект QGIS (файл *.qgz) должен располагаться в том же каталоге, что и папка data. Откройте Менеджер источников данных. Это можно сделать из меню «Слой», с помощью кнопки на специальной панели (которая так и называется — панель менеджера источников данных) или нажав комбинацию клавиш Ctlr+L. Откроется окно Менеджера источников данных Если вы впервые пользуетесь QGIS, то окно Менеджера откроется на вкладке «Обозреватель», вид которого аналогичен проводнику файловой системы. Если Менеджер источников данных открылся на другой вкладке, перейдите на вкладку «Обозреватель» Найдите в списке папок «Размещение по умолчанию для проекта» и раскройте его. «Размещение по умолчанию для проекта» — это каталог, в котором находится ваш файл проекта. Если бы мы не сохранили проект на предыдущем шаге, этого пункта в проводнике не было бы. Размещение по умолчанию облегчает доступ к файлам проекта, если вы поддерживаете структуру ГИС-проекта в порядке. Разверните содержимое папки data. Сколько наборов пространственных данных находится в этой папке? Добавьте набор ne_110m_admin_0_countries.shp в проект. Для этого дважды щёлкните по его названию левой клавишей мыши или воспользуйтесь опцией «Добавить слой в проект» из контекстного меню. Закройте Менеджер источников данных. Окно QGIS примет вид, аналогичный представленному ниже. Сохраните проект QGIS. Снимок экрана №1. Окно QGIS после загрузки набора данных 2.5 Настройка системы координат проекта В начало упражнения ⇡ В правом нижнем углу окна QGIS вы видите надпись . Нажмите на эту надпись, чтобы открыть интерфейс выбора системы координат проекта. Примечание: в тот же интерфейс можно попасть, выбрав «Проект» — «Свойства», и в открывшемся окне перейдя на вкладку «Система координат». В открывшемся окне вы видите более подробную информацию об используемой системе координат. Код EPSG:4326 соответствует системе географических координат WGS 84. Термин «географическая система координат» (geographic coordinate systems) в ГИС означает, что координаты объектов и линейные параметры растров хранятся в виде широты и долготы. Альтернативный подход — проецированные системы координат (projected coordinate systems), где плановые координаты измеряются в метрических единицах. Система координат проекта была импортирована из первого (в нашем случае — пока единственного) загруженного источника пространственных данных. Система координат WGS 84, как правило, не используется для картографирования, поэтому мы изменим систему координат проекта. Поскольку проект предназначен для создания карты мира, мы выберем систему координат, использующую подходящую проекцию — например, проекцию Робинсона В строке «Фильтр» в верхней части интерфейса выбора системы координат проекта начните вводить robinson, чтобы отфильтровать доступные системы координат по названию. Ниже, в блоке «Предустановленные системы координат», будет выведен список систем координат, в название которых входит введённая совокупность символов. Выберите ту из систем координат, где в качестве вспомогательной поверхности используется эллипсоид вращения Примечание: на карте общемирового охвата различия между системами координат, использующих одну проекцию, но разные геодезические даты (датумов), несущестенно. Но в общем случае использование разных геодезических дат (датумов) может приводить к изменению положений контуров на сотни метров. Примените изменения и закройте окно свойств проекта Сейчас ваша карта выглядит приблизительно так, как показано на иллюстрации ниже: Это изображение уже больше похоже на «приличную» карту мира, но у него есть ряд заметных недостатков. Главный из них — разрыв вдоль 180-го меридиана, из-за которого Чукотка оказывается «оторванной» от основной территории Российской Федерации и переносится в северо-западный угол карты. Чтобы избавиться от этого эффекта, мы изменим один из параметров системы координат — центральный меридиан проекции. Изменение центрального меридиана приведёт к тому, что картографическое изображение «сдвинется», как лента конвейера. В результате Чукотка окажется в восточной части карты и не будет оторвана от Евразии. Но сначала нам нужно определить, на какую величину нужно сдвинуть центральный меридиан. Верните проекту исходную систему координат (WGS 84) и увеличьте изображение Берингова пролива. Обратите внимание, что воображаемые линии меридианов в некотором диапазоне не пересекают сушу Подводя курсор узлам полигонов, ближайшим к «разрыву», определите диапазон долгот более точно, до десятых долей градуса. В найденном диапазоне выберите меридиан, долгота которого будет кратна 0,5° Теперь вычислите разность между 180° и найденной долготой. Это и будет искомое смещение центрального меридиана проекции. Запомните или запишите его. Вернитесь в интерфейс выбора системы координат и снова выберите систему координат с проекцией Робинсона. В блоке определений системы координат скопируйте описание системы координат в формате WKT. Копируйте строки, показанные ниже: Для удобства можете сохранить скопированные строки в отдельный текстовый файл Закройте интерфейс выбора системы координат. Откройте меню настройки новых систем координат («Установки» — «Пользовательские проекции…»). Нажмите зелёную клавишу с изображением знака «+», чтобы начать добавление новой системы координат. В строке «Параметр» введите имя для вашей новой системы координат. Для удобства дальнейшей работы имя должно быть коротким и информативным, например Robinson_shift. Можно также вписать в имя конкретное значение параметра, которое вы собираетесь изменить. Убедитесь, что опция «Формат» установлена в значение WKT (Recommended). Вы скопировали параметры системы координат в формате WKT, поэтому данная опция вам подходит. В блок «Параметры» вставьте определение системы координат, скопированный ранее на шаге 9. Измените параметры системы координат следующим образом: Параметр Longitude of natural origin: вместо 0 установите значение, найденное на шаге 7. В качестве разделителя целой и дробной части используйте точку! Параметр ID в самом конце списка: удалите запись ID[\"ESRI\",54030], а также запятую, которая находится перед ней в строке выше. Обратите внимание, что удалить нужно только одну квадратную скобку — вторая относится к более крупному блоку описания! Если вы всё сделали правильно, описание системы координат будет оканчиваться тремя квадратными скобками. Нажмите кнопку «Validate», чтобы проверить синтаксическую корректность введённого определения координат. Если система выдаст сообщеине «The WKT projection definition is valid», то вы всё сделали правильно. В противном случае вернитесь на шаг 15. Если определение успешно прошло валидацию, нажмите ОК, чтобы сохранить введённые параметры. На этом этапе система также может выдать ошибку, если введённые параметры совпадают с определением, которое уже есть в базе. В этом случае вернитесь на шаг 16. Теперь снова откройте окно выбора системы координат. Задайте проекту систему координат, которую вы только что ввели. Увеличьте изображение так, чтобы видеть северо-восточную оконечность Евразии. Ваше изображение должно выглядеть аналогично показанному ниже: Также обратите внимание на изображение Антарктиды. Из-за смещения центрального меридиана этот континет отрисовывается с ошибками, но в рамках данного упражнения мы их проигнорируем. Отобразите набор данных в полном охвате (Ctrl+Shift+F или кнопка на панели навигации) и сделайте снимок экрана. Снимок экрана №2. Окно QGIS после настройки системы координат Вы настроили систему координат проекта (проекцию для будущей карты). Теперь вы начнёте работать с визуализацией слоя государств. 2.6 Окраска стран в разные цвета В начало упражнения ⇡ Переименуйте слой ne_110m_admin_0_countries. Назовите его Страны. Откройте таблицу атрибутов слоя Страны. Для этого нажмите правой кнопкой мыши на название слоя в таблице слоёв и выберите пункт «Открыть таблицу атрибутов». Таблица атрибутов является представлением базы данных, сопоставленной набору пространственных данных. Каждый объект на карте имеет массу семантической (атрибутивной) информации. Например, в том наборе, который вы сейчас используете, есть названия стран на различных языках, текстовые характеристики уровня экономического развития и многое другое. Но сейчас нас интересуют столбцы с названием MAPCOLOR. Изучите столбец MAPCOLOR7. Сколько различных уникальных значений присвоено объектам в полях этого столбца? В настоящий момент все страны обозначены в окне проекта при помощи одного и того же условного знака. На политических картах различные территории обычно отображаются различными цветами, причём цвета могут повторяться. Столбец MAPCOLOR7 (и соседние с ним столбцы) специально созданы разработчиками Natural Earth, чтобы закодировать отображение стран разными цветами. При этом цифры в столбце не означают какой-то конкретный цвет — это просто условные «коды», которыми ГИС-специалист может пользоваться для присвоения различных условных знаков. Мы изменим способ визуализации слоя таким образом, чтобы каждому уникальному значению поля MAPCOLOR7 соответствовал свой цвет. Но сначала подберём нужную палитру цветов. Перейдите на сайт ColorBrewer. Выясните, для чего он предназначен, каким функционалом обладает. Примечание: ColorBrewer — это палитры цветов, широко применяемые в картографии и смежных задачах. Палитры ColorBrewer интегрированы в различное популярное программное обеспечение, в том числе в QGIS. Сайт ColorBrewer предоставляет удобный интерфейс для выбора нужной палитры. Подберите палитру, исходя из следующих соображений: Число цветов: по числу уникальных значений в поле MAPCOLOR7; Тип данных, к которым применяется палитра: качественные (qualitative); Из доступных вариантов выберите палитру мягких, так называемых «пастельных» цветов. Запомните или запишите название выбранной палитры. Сделайте снимок экрана. Снимок экрана №3. Окно браузера с выбранной палитрой ColorBrewer Вернитесь в QGIS. Откройте окно свойств слоя Страны. Для этого дважды щёлкните левой кнопкой мыши по названию слоя или нажмите на него правой кнопкой мыши, а в контекстном меню выберите «Свойства…» Основная вкладка для настройки визуализации слоя — это вкладка «Оформление». Как видите, сейчас для слоя применён стиль «Обычный знак». Это значит, что все объекты слоя изображаются на карте при помощи одного и того же условного знака. Измените способ визуализации с «Обычный знак» на «Уникальные значения». Внешний вид окна сильно изменится. Ниже, в поле «Значение», выберите из выпадающего списка поле MAPCOLOR7. Мы возьмём значения из этого поля и каждому из них присвоим свой условный знак. Найдите кнопку «Классифицировать» в нижней части окна и нажмите на неё. QGIS автоматически выберет все уникальные значения из столбца и присвоит им случайные цвета. Окно настройки примет вид, аналогичный этому: Обратите внимание, что в таблице значений больше записей, чем уникальных значений в поле MAPCOLOR7. QGIS автоматически добавляет строку «все другие значения» на случай, если после редактирования слоя в столбец добавляют новые, не встречавшиеся ранее значения. Без специального знака «все другие значения» объекты с новыми значениями прост не будут отображаться на карте. Примените изменения, закройте окно свойств слоя, сохраните проект и сделайте снимок экрана. Снимок экрана №4. Окно QGIS с визуализацией стран с помощью случайно заданных цветов. Вновь откройте окно свойст слоя на вкладке «Оформление». В таблице значений удалите запись «все другие значения». Мы не будем редактировать слой, а значит, можем быть уверены, что никаких новых значений не появится. Измените палитру цветов. Для этого щёлкните правой кнопкой мыши на выпадающем меню «Градиент» и выберите пункт «Создать новый градиент» В открывшемся окне выберите тип градиента: «Каталог: ColorBrewer» и нажмите OK. В новом открывшемся окне введите два параметра: Имя схемы: название палитры, которое вы запомнили на шаге 4; Цвета: необходимое число цветов Выбранные настройки палитры будут автоматически применены к слою. Картографическое изображение примет вид, аналогичный представленному ниже: Последний штрих к изображению стран — удаление обводки. На следующих шагах мы добавим другие слои, с помощью которых изобразим береговую линию и границы государств, поэтому обводка полигонов слоя государств будет нам только мешать. Чтобы удалить обводку, вернитесь в свойства слоя на вкладку «Оформление», нажмите на поле «Знак», выберите слой Simple Fill в перечне слоёв знака и установите для параметра «Стиль обводки» значение «Без обводки». Снимок экрана №5. Окно QGIS с визуализацией стран с помощью специально заданной палитры. 2.7 Добавление других слоёв на карту В начало упражнения ⇡ Загрузите с сайта Natural Earth следующие наборы данных, соответствующие детальности вашей карты: береговую линию (Coastline) сухопутные границы (Boundary Lines) Населённые пункты (Populated Places) Распакуйте содержимое архивов в ту же директорию, где находится шейп-файл государств. Удалите лишние файлы. Добавьте загруженные наборы данных в ваш проект QGIS. Переименуйте их следующим образом: «Береговая линия», «Границы», «Населённые пункты». Расставьте слои в следующем порядке: Населённые пункты Береговая линия Границы Страны Примените следующие настройки визуализации слоёв линейной геометрии Береговая линия: линии синего цвета толщиной 0,26 мм Границы государств: линии серого цвета толщиной 0,26 мм Самостоятельно изучите интерфейс настройки цвета в QGIS Примените следующие настройки для слоя населённых пунктов: условный знак city из библиотеки QGIS, размер 1,2 мм. Помимо добавленных слоёв, нам необходим слой для изображения океанов. К сожалению, из-за несовершенства QGIS вы не можете воспользоваться для этой цели набором данных с Natural Earth. Загрузите шейп-файл океанов по этой ссылке. Распакуйте шейп-файл в папку с другими шей-файлами и добавьте его в проект. Переименуйте добавленный слой в «Океан» и расположите его в самом низу таблицы слоёв. Задайте для слоя «Океан» условный знак в виде заливки светло-голубого цвета без обводки. Сохраните проект и сделайте снимок экрана. Снимок экрана №6. Окно QGIS с оформленным картографическим изображением. 2.8 Создание компоновки карты В начало упражнения ⇡ Изображение, которое вы создали — ещё не карта. Нужно создать компоновку карты — разместить картографическое изображение на листе бумаги, добавить название, масштабную линейку и другие элементы зарамочного оформления. Создайте новый макет (Ctrl+P или «Проект» — «Создать макет…»). В небольшом диалоговом окне, появляющемся при создании макета, введите его название — свою фамилию на русском языке. Нажмите ОК. На экране откроется отдельное окно настройки компоновки. В центре его — белый прямоугольник, имитирующий лист бумаги. Панели по краям экрана предназначены для добавления и настройки элементов макета. Найдите и активируйте инструмент добавления карты к макету . Продумайте, как будет расположена карта на вашем листе. Обязательно запланируйте отступ 2–2,5 см от края листа с каждой стороны. Переместите курсор на лист в положение, соответствующее планируемому положению северо-западного угла карты. Зажав левую кнопку мыши, ведите курсор к планируемому положению юго-восточного угла карты. Пока элемент карты выбран, в правой части окна компоновки отображается панель свойств элемента. Найдите в нём раздел «Положение и размер» и установите размер карты равным 260×130 мм В той же панели задайте знаменатель масштаба картографического изображения равным 130 000 000. Пользуясь инструментом перемещения содержимого элемента (), измените положение изображения карты так, чтобы вписать её в рамки Добавьте к макету текст и напишите в нём название карты. Подберите форму и размер шрифта. Расположите название над картой. Добавьте к карте масштабную линейку. Добавьте к карте текст и укажите в нём автора карты. Экспортируйте изображение в формат PNG "],["map-design-quaternary.html", "Упражнение 3 Создание карты четвертичных отложений 3.1 Введение 3.2 Начало работы 3.3 Добавление данных в проект 3.4 Применение готового стиля к слою 3.5 Создание набора пространственных данных из таблицы с координатами 3.6 Оформление карты", " Упражнение 3 Создание карты четвертичных отложений Архив с исходными данными Контрольный лист 3.1 Введение Цель задания — закрепление навыков загрузки и визуализации данных в QGIS. Необходимая теоретическая подготовка: модели пространственных данных, модели пространственных объектов, базы пространственных объектов, картографические проекции. Необходимая практическая подготовка: в объёме упражнения 1. Исходные данные: база геоданных ESRI на территорию Сатинского учебного полигона, Калужская область. Ожидаемый результат: карта четвертичных отложений Сатинского полигона М 1:30 000 3.1.1 Контольный лист Добавить на карту источники пространственных данных Импортировать символику Настроить подписи объектов Создать набор пространственных данных из текстового файла Создать компоновку карты и легенду Экспортировать результат в графический файл 3.2 Начало работы В начало упражнения ⇡ Скачайте архив с исходными данными для упражнения и распакуйте его в свою рабочую директорию. В вашей рабочей директории появилась «папка» Satino.gdb. Зайдя в неё с помощью проводника или Finder’a, вы увидите множество файлов с различными расширениями (.spx, .gdbtable, *.gdbtablx и др.). Ничего не редактируйте в этой «папке». Запустите QGIS и сразу сохраните проект в своей рабочей директории, на одном иерархическом уровне с Satino.gdb. Назовите его по шаблону Ex02_%Фамилия.qgz%. Примечание: не забывайте периодически сохранять проект QGIS! Откройте Менеджер источников данных и разверните содержимое базы Satino.gdb Вы видите список наборов пространственных данных, хранящихся в базе Satino.gdb. Это векторные наборы различной геометрии (точечной, линейной и полигональной). База геоданных ESRI (*.gdb) — основной формат, используемый линейкой программных продуктов ArcGIS. В базах геоданных могут храниться как векторные, так и растровые данные. Кроме того, базы геоданных поддерживают специальные возможности (подтипы, доменты) и структуры данных (топологические и сетевые наборы). QGIS способен получать доступ к базам геоданных ESRI в режиме чтения, но не в режиме редактирования. И даже эти возможности ограничены: QGIS «видит» векторные наборы пространственных данных, но «не считывает» структуру базы (классы и наборы пространственных объектов), растровые наборы, топологию и другие элементы, специфические для ArcGIS. В частности, набор DEM, который отображается в браузере как векторный полигональный набор данных, на самом деле является растровым набором. 3.3 Добавление данных в проект В начало упражнения ⇡ Добавьте на карту наборы WaterLine, WaterPolygon и QDeposit. Вопрос 1: какая система координат присвоена для каждого набора данных? Какая проекция используется для этой системы координат? К какому виду относится эта проекция по характеру искажений? Для чего она применяется? Вопрос 2: какая система координат присвоена проекту QGIS после добавления набора данных? Настройте визуализацию слоёв WaterLine и WaterPolygon, используя условные знаки из библиотеки QGIS. Окно QGIS должно принять вид, аналогичный рисунку ниже: Откройте таблицу атрибутов слоя QDeposit и изучите её. Вы видите индексы и текстовые описания четвертичных отложений. Далее вы визуализируете слой QDeposit таким образом, что каждому типу отложений (Deposit) будет сопоставлен уникальный условный знак. 3.4 Применение готового стиля к слою В начало упражнения ⇡ Откройте свойства слоя QDeposit. На вкладке «Стиль» измените тип отображения на Уникальные значения и настройте классификацию по полю Index c использованием случайных цветов (Random colors). Закройте свойства слоя и оцените результат. Скриншот 1: результат классификации — отображение каждого типа отложений уникальным цветом. Изображение стало более «пёстрым», но не стало более читаемым. Человеческому глазу трудно распознать два десятка уникальных оттенков цвета. Кроме того, исходя из географической логики, родственным категориям должны быть присвоены схожие цвета. Разработка цветовых решений для сложных, комплексных карт является отдельной научной задачей. В этом упражнении вы будете использовать готовые наборы стилей. В левом нижнем углу вкладки «Стиль» найдите кнопку «Стиль». Нажмите на неё и выберите опцию «Загрузить стиль». В открывшемся окне в строчке «Файл» найдите стилевой файл QDeposit.qml. Загрузите из этого файла всю доступную символику. QGIS, как и другое геоинформационное ПО, позволяет сохранять настройки отображения слоя в отдельный стилевой файл. Поддерживаются два формата: QGIS Layer Style File (.qml) и Styled Layer Descriptor (.sld). В проприетарном ПО (ArcGIS, MapInfo) используются другие форматы описания стилей. Как правило, они несовместимы друг с другом. Скриншот 2: изображение готового слоя после импорта символики Изучите условные знаки, применённые для слоя, и ответьте на вопросы: Вопрос 3: чем отличается условный знак, применённый для биогенных отложений, от всех прочих условных знаков? Каким образом это осуществлено? Вопрос 4: как соотносятся записи в таблице атрибутов (поле Deposit) и записи в поле «Легенда» в настройках стиля условных знаков? Настройте подписи для слоя. Для подписывания используйте поле Index. Настройки подписей определите самостоятельно. 3.5 Создание набора пространственных данных из таблицы с координатами В начало упражнения ⇡ Найдите в проводнике файл geol_points.csv и откройте его с помощью простого текстового редактора (Блокнот или аналогичный). Изучите содержимое файла. Comma-Separated Values (CSV) — простой текстовый формат, предназначенный для хранения табличных данных. Каждая строка представляет строку таблицы, а ячейки, соответствующие столбцам, разделяются специальными символами. В качестве такого символа может быть использована запятая, точка с запятой, знак табуляции или сочетание из нескольких символов. В представленном файле вы видите два столбца — X и Y. Это представление координат точек. Система координат, которая использовалась при создании файла, совпадает с системой координат вашего проекта. На следующих шагах вы загрузите эту таблицу в QGIS как набор пространственных данных. Откройте панель менеджера источников данных и перейдите на вкладку Delimited Text. Поскольку текстовый файл не содержит сведений, необходимых для корректного импорта и визуализации, мы будем настраивать параметры импорта вручную. Нажмите значок с символом ... справа от первого поля и в окне Проводника откройте файл geol_points.csv. Не меняйте имя слоя и кодировку. Примечание: в дальнейшем в вашей практике будут встречаться CSV-файлы, созданные в различных кодировках. В таких случаях нужно будет выбрать (или подобрать) правильную кодировку. Проверить себя можно по образцу загружаемой таблицы, который отображается в нижней части интерфейса загрузчика. В первом блоке настроек («Формат файла») установите корректный разделитель столбцов. Во втором блоке настроек («Настройки полей и записей») установите нужные параметры самостоятельно. В третьем блоке настроек («Геометрия») определите, какие поля содержат координаты точек, и установите целевую систему координат — такую же, как система координат проекта. В блоке «Настройки слоя» не меняйте значения, определённые по умолчанию. Проверьте себя, посмотрев блок «Примеры данных». Если настройки заданы правильно, в этом блоке будут корректно отображены первые 20 строк таблицы (не считая заголовков). Скриншот 3: Окно настроек импорта CSV-файла Нажмите кнопку «Добавить», чтобы добавить слой на карту. Настройте условные знаки для добавленного слоя. Отобразите все разрезы чёрными кругами диаметром 1,4 мм без обводки. 3.6 Оформление карты В начало упражнения ⇡ Создайте макет карты в портретной ориентировке и добавьте на него картографическое изображение. Установите следующие параметры элемента карты: ширина 170 мм, высота 140 мм, масштаб картографического изображения 1:30 000. Разместите элемент карты в верхней половине листа Настройте сетку прямоугольных координат для карты в виде перекрестий. Подсказка: используйте для сетки ту же систему координат, которая применена для проекта QGIS в целом Добавьте зарамочное оформление: название карты, легенду, масштабную линейку. Экспортируйте карту в формат PNG и вставьте её в отчётный документ. Подсказка: используйте опцию «Обрезать по содержимому», чтобы сохранить размеры изображения в отчётном документе "],["map-design-population.html", "Упражнение 4 Создание социально-экономической карты 4.1 Введение 4.2 Начало работы 4.3 Изменение системы координат проекта 4.4 Создание картограмм 4.5 Создание шкалы значков 4.6 Добавление подписей значков 4.7 Настройка условных знаков географической основы 4.8 Создание макета карты", " Упражнение 4 Создание социально-экономической карты Архив с исходными данными Контрольный лист 4.1 Введение Цель задания — закрепление навыков загрузки и визуализации данных в QGIS. Необходимая теоретическая подготовка: модели пространственных данных, модели пространственных объектов, базы пространственных объектов, картографические проекции. Необходимая практическая подготовка: в объёме упражнения 1. Исходные данные: база пространственных данных на территорию Российской Федерации Ожидаемый результат: тематическая карта «Население России» масштаба 1:35 000 000 В этом упражнении вы закрепите базовые навыки визуализации с использованием программных средств ГИС, составив карту населения Российской Федерации в разрезе субъектов фередации и крупных населённых пунктов. На картах населения, как правило, изображается людность городов (способом значков) и плотность населения (способом количественного фона). В рамках упражнения мы не будем пытаться выполнить «объективное» районирование территории по естественным градациям плотности населения; вместо этого воспользуемся обобщённой статистикой по плотности населения субъектов РФ. 4.1.1 Контольный лист Добавить на карту источники пространственных данных Импортировать символику Настроить подписи объектов Создать набор пространственных данных из текстового файла Создать компоновку карты и легенду Экспортировать результат в графический файл 4.2 Начало работы В начало упражнения ⇡ Скачайте архив с исходными данными для упражнения и распакуйте его в свою рабочую директорию. Запустите QGIS. Нажмите кнопку Сохранить и сохраните проект QGIS (файл формата .qgz) в распакованную папку (Ex03_PopulationMap) под именем Ex03_%Фамилия%. Папка Ex03_PopulationMap теперь является расположением по умолчанию для проекта. Откройте Менеджер источников данных, на вкладке Браузер найдите и разверните Размещение по умолчанию для проекта. Вы видите там файл проекта, который вы только что сохранили, и базу данных RussiaPopulationMap.gpkg. Разверните содержимое базы RussiaPopulationMap.gpkg. Файл формата GeoPackage (*.gpkg) представляет собой базу данных SQLite, внутри которой содержатся таблицы с данными и таблицы с метаданными. В отличие от шейп-файлов, GeoPackage хранит всю необходимую информацию в одном файле. Это позиционируется как одно из главных преимуществ формата. Один файл формата GeoPackage может хранить один или несколько наборов пространственных данных. В терминологии разработчиков формата разные наборы данных внутри базы называются слоями (layers) или таблицами данных (data tables). В браузере менеджера источников данных они отображаются с использованием разных значков в зависимости от типа геометрии: точки; линии; полигоны. Как и в случае с шейп-файлами, один набор данных может содержать объекты только одного типа геометрии. Добавьте на карту все наборы из базы RussiaPopulationMap.gpkg. Для добавления набора дважды щёлкните по его названию левой кнопкой мыши. В панели Слои основного окна QGIS расположите слои в следующем порядке: cities (города) coastline (береговая линия) boundaries (государственные границы) lakes (озера) regions (регионы РФ) neighbouring countries (соседние страны) Используя кнопку Полный охват или комбинацию клавиш Ctrl+Shift+F, измените охват изображения, чтобы во фрейме карты отобразились все объекты из добавленных слоёв. Как видите, изображение выглядит немного странно и мало похоже на карту России. Поскольку Чукотский автономный округ расположен одновременно в западном и восточном полушариях, его изображение разрывается, если в проекте используется географическая система координат (что соответствует цилиндрической равнопромежуточной по меридианам проекции). Для карт России обычно применяются конические проекции, причём многих из них нет в международных базах данных. На следующем шаге мы выберем для карты подходящую проекцию и систему координат. 4.3 Изменение системы координат проекта В начало упражнения ⇡ Откройте Свойства проекта, а в них — вкладку Система координат Это можно сделать одним из следующих способов: из меню Проект — Свойства…, при помощи сочетания клавиш Ctrl+Shift+P или нажатием на надпись EPSG:4326 в правом нижнем углу окна QGIS. Рекомендуем пользоваться последним способом, поскольку он сразу открывает нужную вкладку. В строке поиска введите Asia_North, чтобы отфильтровать список доступных систем координат. Теперь в списке предустановленных систем координат (Predefined coordinate systems) отображаются только системы координат, название которых включает символы Asia_North. Выберите из списка систему координат в конической равновеликой проекции (Equal Area Conic). Нажмите ОК. Установите масштаб карты равным 1:35 000 000. Снимок экрана №1. Окно QGIS после изменения системы координат проекта Сохраните проект QGIS. Запишите файл проекта (*.qgz) в папку с исходными данными и назовите его по шаблону Ex03_%Фамилия%. Примечание: в дальнейшем мы не будем напоминать вам о необходимости сохранять 4.4 Создание картограмм В начало упражнения ⇡ Для отображения относительных показателей по единицам административно-территориального деления используется способ изображения, который в русской картографической традиции называется картограммой. Картограмму очень просто сделать в ГИС, если у вас есть набор пространственных данных, пригодный для картографирования. Откройте таблицу атрибутов слоя regions. Найдите в этой таблице поле population_density. Это поле таблицы хранит значения плотности населения по субъектам РФ. Закройте таблицу атрибутов. Откройте свойства слоя regions и перейдите на вкладку Стиль. В верхней части окна выберите из выпадающего списка метод визуализации Градуированный знак Во втором поле выберите столбец таблицы атрибутов, значения которого будут использованы для создания визуализации. Вам нужно выбрать из выпадающего списка поле, хранящее информцию о значениях плотности населения. Значения, взятые из выбранного поля, будут классифицированы, то есть разделены на диапазоны, с использованием одного из доступных в QGIS метода классификации. Каждому диапазону сопоставляется уникальный условный знак. Все пространственные объекты, значения выбранного атрибута которых попадают в один и тот же диапазон, будут изображены на карте с использованием этого условного знака. Метод визуализации Градуированный знак предполагает, что условные знаки будут отличаться цветом фона, и эти цвета определяются на основе заданного градиента цветов. Нажмите правой кнопкой мыши на содержимое параметра Градиент. В открывшемся меню перейдите к пункту Все градиенты и выберите градиент Oranges После всех применённых настроек блок классов (Classes) остаётся пустым. Чтобы классифицировать имеющееся множество значений, нажмите кнопку Классифицировать. Классификация будет выполнена с использованием метода естественных разрывов (Natural Breaks), который используется в QGIS по умолчанию. Нажмите ОК, чтобы применить изменения и закрыть окно свойств слоя. Изображение должно принять вид, аналогичный рисунку ниже. Существует множество методов классификаций: равных интервалов, квантилей, стандартных отклонений и т.д. По умолчанию в большинстве геоинформационных продуктов используется метод естественных интервалов: считается, что он в среднем неплохо отражает особенности распределения. Следует знать, однако, что этот метод классификации плохо справляется с распределениями, обладающими значительной асимметрией и эксцессом (heavy-tail distribution). Кроме того, интервалы, генерируемые этим методом, не обладают свойством наглядности. На следующем шаге мы отредактируем применяемую классификацию. Снова откройте окно свойств слоя на вкладке Стиль. Проверьте, что опция Связать границы классов (ниже кнопки Классифицировать) включена. Используя поле ввода в правой части окна, измените число классов на 7. Теперь мы отредактируем вручную границы классов. Дважды щёлкните левой кнопкой мыши по значениям первого класса в списке. Откроется окно редактирования границ классов Введение следующие параметры: нижнее значение: 0 верхнее значение: 1 Нажмите ОК в окне редактирования границ классов. Вы выделили в отдельный класс регионы РФ со средней плотностью менее 1 человека на квадратный километр. Обратите внимание, что нижняя граница следующего класса тоже изменилась. Это произошло потому, что исполььзуется опция Связать границы классов. Это ускорит для вас процесс редактирования границ других классов Измените границы следующих классов в соответствии со следующим списком: 1 – 5; 5 – 10; 10 – 20; 20 – 50; 50 – 100; 100 – 5000 Нажмите OK, чтобы применить новые настройки и закрыть окно свойств слоя. Снимок экрана №2. Окно QGIS после настройки визуализации слоя регионов РФ Вы настроили визуализацию слоя, но прежде чем переходить к другим слоям, необходимо сделать ряд косметических изменений. Начните с переименования слоя. В таблице слоёв щёлкните правой кнопкой мыши по названию слоя regions, выберите пункт меню Переименовать и введите для слоя новое название: Плотность населения, чел/км². Теперь измените отображение некоторых классов в легенде. Снова откройте свойства слоя на вкладке Стиль. В таблице классов в колонке Легенда отображаются названия классов в таком виде, в котором они будут показаны в легенде. Дважды щёлкните на подписи легенды класса «0 – 1». Введите вручную новую подпись для легенды: менее 1. Аналогичным образом измените запись в легенде для класса «100 – 5000»: более 100. Примените изменения и закройте окно свойств слоя. Зажимая левой кнопкой мыши и перетаскивая записи в таблице, измените их порядок так, чтобы они были отсортированы по убыванию: Вы закончили настраивать отображение слоя картограммы и можете перейти к настройке следующего слоя. 4.5 Создание шкалы значков В начало упражнения ⇡ Плотность населения на картах обычно отображается с помощью шкалы значков. Вы создадите такую шкалу, используя положения населённых пунктов и данные из таблицы атрибутов соответствующего набора данных. Откройте таблицу атрибутов слоя cities. Найдите в этой таблице поле population_2020. Это поле таблицы хранит значения численности населения по городам РФ (в тысячах человек). Закройте таблицу атрибутов. Откройте свойства слоя cities и перейдите на вкладку Стиль. В верхней части окна выберите из выпадающего списка метод визуализации Градуированный знак Во втором поле выберите столбец таблицы атрибутов, значения которого будут использованы для создания визуализации. Вам нужно выбрать из выпадающего списка поле, хранящее информцию о значениях численности населения. Нажмите на кнопку Значок. В открывшемся меню выберите новый символ для значка — Dot Purple В поле Метод поменяйте вариант Цвет на вариант Размер. Для отображения различных классов будут использоваться значки разных размеров. Настройки поля Размер (Size from … to …) служат для изменения размера значков. Оставьте значения, предложенные QGIS по умолчанию. Нажмите кнопку Классифицировать. В списке классов появится пять записей. Измените границы классов в соответствии со следующим списком: 100 – 200; 200 – 500; 500 – 1000; 1000 – 5000; 5000 – 15000; Переименуйте элемент легенды, соответствующей классу с самыми большими значениями. Установите новую подпись более 5000 Измените порядок строк в таблице таким образом, чтобы значения располагались по убыванию (аналогично тому, как вы делали для легенды картограммы) Примените изменения и закройте окно свойств слоя. Переименуйте слой cities. Задайте этому слою имя Людность городов, тыс. чел. Результат будет выглядеть приблизительно так, как показано на рисунке: Снимок экрана №3. Окно QGIS после настройки визуализации слоя населённых пунктов РФ 4.6 Добавление подписей значков В начало упражнения ⇡ Откройте свойства слоя cities, вкладку Подписи. Эта вкладка используется для настройки подписей и содержит ряд вложенных вкладок, позволяющих настраивать параметры размещения и отображения подписей. Прямо сейчас все вложенные опции отключены, поскольку используется режим Не показывать подписи (No labels). В выпадающем списке в верхней части окна измените No labels (Не показывать подписи) на Single labels (Подписи по значениям одного поля). Сразу после изменения этой настройки на вкладке откроется множество других параметров. В опции Значение выберите поле, из которого будут взяты тексты подписей. Это поле name_map На вкладке Текст измените размер на 7. «Размер текста» в QGIS — это кегль, или высота шрифта. Традиционно она измеряется в типографских пунктах (пт, pt), так же, как в текстовых редакторах типа Microsoft Word. Перейдите на вкладку «Буфер». Включите опцию Показывать текстовый буфер (Draw text buffer). Установите для буфера размер 0,6 миллиметра. На вкладке Размещение установите способ размещения значков Картографический (Cartographic) и расстояние 0,1 миллиметра от границ символа (From Symbol Bounds) Примените изменения и закройте окно свойств слоя. Результат будет выглядеть приблизительно так, как показано на рисунке ниже. Заметьте, что QGIS отрисовывает не все подписи, доступные в таблице атрибутов — например, с высокой вероятностью не показывается подпись Москвы. Опции размещения подписей можно настраивать более детально, но это не входит в задачи этого упражнения. Снимок экрана №4. Окно QGIS после добавления подписей 4.7 Настройка условных знаков географической основы В начало упражнения ⇡ Мы задали оформление слоям, отвечающим за тематическую нагрузку создаваемой карты. Теперь нам необходимо задать символику для всех остальных слоёв и расположить их в правильном порядке. Переименуйте оставшиеся слои: boundaries: государственные границы coastline: береговая линия lakes: озёра neighbouring_countries: соседние страны Расположите слои в следующем порядке: Людность городов береговая линия государственные границы озёра Плотность населения соседние страны Задайте для слоя береговой линии символ simple blue line и толщину 0,36 Задайте для слоя государственных границ символ Residental road Задайте для слоя озёр символ topo water Задайте для слоя соседних стран символ gray 2 fill Результат обновления символики слоёв будет выглядеть приблизительно так: 4.8 Создание макета карты В начало упражнения ⇡ Макет (Layout) в QGIS – это основной способ создания картографических изображений на основе визуализированных пространственных данных. Вы размещаете картографическое изображение на листе, добавляете зарамочное оформление (название, легенду, подпись масштаба и др.), и в заключение экспортируете результат в виде растровой или векторной графики. Примечание: в одном проекте QGIS может быть создано несколько макетов, использующих разные наборы слоёв. Измените охват картографического изображения в основном окне QGIS так, чтобы территория России умещалась в нём целиком. Создайте новый макет компоновки. Для этого нажмите Ctrl+P, воспользуйтесь пунктом меню Проект — Создать макет или кнопкой Создать макет на главной панели QGIS попросит вас ввести название макета. Никаких ограничений на название не накладывается, вы можете использовать любое имя. Например, %Фамилия%_карта_России Когда вы введёте название макета и нажмёте ОК, откроется новое окно — окно вёрстки макета: Белый прямоугольник, который вы видите в центре окна, обозначает страницу бумаги, на которой вы размещаете ваше изображение. Для добавления и редактирования элементов макета используется Панель инструментов (см. рисунок ниже). Она может быть размещена горизонтально или вертикально. Добавьте картографическое изображение на макет. Нажмите кнопку Добавить Карта на Панели инструментов или выберите аналогичную опцию из меню Добавить объект. Затем установите курсор на то место страницы, где вы хотите поместить северо-западный (верхний левый) угол карты. Зажмите левую кнопку мыши и ведите курсор к месту, где должен располагаться юго-восточный (нижний правый) угол карты. Доведя курсор до этого места, отпустите левую кнопку мыши. Результат должен выглядеть приблизительно так, как показано на рисунке ниже: Обратите внимание, что размер картографического изображения меньше размера страницы. Это сделано специально: мы оставляем поля для печати. Несколько позже вы ещё немного уменьшите размер изображения, чтобы разместить на листе название карты, легенду, масштабную линейку и другую необходимую информацию. Примечание: перевод QGIS на русский язык всё ещё оставляет желать лучшего. В некоторых случаях ошибки незначительны (как, например, с названием опции «Добавить Карта»), но иногда неправильный перевод может сбить с толку. Следущие несколько шагов будут посвящены настройке сетки координат для карты. Чтобы начать настройку, найдите панель Свойства элемента, а в ней — вкладку Сетки Разверните вкладку Сетки и нажмите на кнопку Добавить сетку. Обратите внимание, что к одному картографическому изображению можно добавить несколько сеток, присвоив им разные имена. Сейчас мы этого делать не будем, нам достаточно одной сетки географических координат. Нажмите на кнопку Modify Grid…, чтобы перейти к настройкам сетки В открывшейся панели измените значения следующих параметров: Внешний вид: Система координат: установите систему координат WGS 1984 (EPSG:4326) Интервал по X (долготе): 30 Интервал по Y (широте): 15 Стиль линии: используйте существующий стиль, но уменьшите толщину линии до 0,15 мм Рамка: Вид рамки: Exterior ticks (внешние метки) Отображать слева и справа только широту (latitude only) Отображать сверху и снизу только метки долготы (longitude only) Координаты: Включить опцию Draw Coordinates (Показывать координаты) Формат: Decimal with Suffix (десятичные дроби с меткой направления) Показывать слева и справа только подписи широты Показывать снизу и сверху только подписи долготы Точность координат: 0 (эта настройка отвечает за число знаков после запятой) Вернитесь в «Свойства элемента» и найдите настройку «Фон» (англ. Background, неправиильно переведено как «история»). Измените фон картографического изображения на светло-голубой. Таким образом вы сымитируете цветной фон морей и океанов. Результат будет выглядеть приблизительно так, как показано на рисунке ниже: Добавьте легенду на макет. Нажмите кнопку Добавить Легенда, а затем щёлкните левой кнопкой мыши возле северо-восточного угла карты. Нажмите ОК в появившемся окне настройки размера элемента. После добавления легенды макет будет выглядеть примерно так, как показано на рисунке ниже: Выберите элемент легенды и перейдите в «Свойства элемента». Найдите пункт Элементы легенды (Legend Items). Этот пункт позволяет вам настраивать содержимое автоматически собираемой легенды. Отключите опцию Auto Update. Выключая эту опцию, вы «разрываете связь» между основным окном QGIS и легендой. Теперь при любых изменениях в основной карте легенда не будет обновляться автоматически. С другой стороны, это даёт вам возможность редактировать содержимое легенды. Удалите из легенды все элементы, кроме «Людность городов» и «Плотность населения». Измените размер и положение элементов макета таким образом, чтобы и карта, и легенда помещались на листе и не перекрывали друг друга. Результат должен выглядеть приблизительно так, как показано на рисунке ниже: Добавьте масштабную линейку на макет. Нажмите кнопку Добавить Масштабная линейка или воспользуйтесь аналогичной опцией из меню Добавить Объект. Разместите его под основным картографическим изображением. Измените подпись единиц измерения масштабной линейки: вместо варианта «km», который используется по умолчанию, впишите «км» Вставьте текстовые блоки: название карты и информацию об авторстве карты. Если необходимо, измените размеры или взаимное расположение элементов, чтобы все они умещались на листе и не «прилипали» к его краям. Результат должен выглядеть приблизительно так, как показано на рисунке ниже: Экспортируйте изображение в графический файл формата PNG. Для этого используйте кнопку Экспорт в изображение или опцию меню Макет, имеющую такое же название. В настройках экспорта укажите целевое разрешение 300 точек на дюйм (dots per inch, dpi). "],["raster-reference.html", "Упражнение 5 Привязка графических материалов 5.1 Введение 5.2 Привязка растра по меткам координат 5.3 Добавление базовой карты 5.4 Использование координат с базовой карты 5.5 Оценка точности привязки 5.6 Интерактивная привязка растров на основе аффинного преобразования", " Упражнение 5 Привязка графических материалов Архив с исходными данными Контрольный лист Внимание! Ваш преподаватель может предоставить вам другие исходные данные для выполнения этого упражнения: листы топографической карты, спутниковые снимки. При возникновении противоречий следуйте указаниям преподавателя! 5.1 Введение Цель задания — знакомство с привязкой и трансформированием растровых геоизображений. Необходимая теоретическая подготовка: Системы координат и проекции карт, привязка геоизображений, трансформирование геоизображений. Разграфка, номенклатура и проекция топографических карт. Методы трансформации: аффинное, проективное, полиномиальное, метод резинового листа. Необходимая практическая подготовка: Знание основных компонент интерфейса QGIS (менеджер источников данных, панель слоёв, фрейм карты), умение выполнять масштабирование и перемещение по карте, определять координаты курсора. Исходные данные: Растровые изображения листов топографических карт и тематических карт, сканированные космические снимки. Результат: Привязанные и трансформированные растровые изображения, пригодные для непосредственно использования в ГИС. Аннотация: Положение точки в пределах растрового изображения может быть определено во внутренней системе координат растра. В этой системе координаты отсчитываются от верхнего левого угла растра по направлению отсчёта строк и столбцов и измеряются, соответственно, в пикселах. Для работы в геоинформационных системах (ГИС) необходимо установить соответствие между внутренней системой координат растра и внешней (целевой) системой координат, применяемой в ГИС-проекте — иными словами, выполнить привязку растра. С точки зрения пользователя ГИС, привязка заключается в определении для некоторого числа точек двух пар координат: 1) пары координат во внутренней системе координат растра и 2) пары координат в целевой системе координат ГИС-проекта. Но если «внутренние» координаты могут быть легко определены, поскольку они непосредственно связаны непосредственно с растром, то целевые координаты необходимо узнавать отдельно. У некоторых видов растров — например, у топографических карт, — координатные метки с их численными значениями нанесены на само изображение (сетки координат). У других — например, у космических снимков, — эту информацию нужно определять с привлечением дополнительных источников. Точки, используемые для привязки, должны равномерно покрывать всю площадь изображения (или по крайней мере ту его часть, которая будет использоваться в исследовании), а также ни в коем случае не находиться на одной линии. Привязка часто сопровождается трансформацией. В ходе трансформации растр пересчитывается в новую систему координат таким образом, что направления отсчёта строк и столбцов становятся параллельными осям координат целевой системы. 5.1.1 Контрольный лист Определить систему координат для привязки Привязать растровую карту по известным координатам точек Оценить точность привязки карты Привязать изображение путём интерактивного определения положения точек привязки Использовать базовые карты из сети Интернет для привязки 5.2 Привязка растра по меткам координат В начало упражнения ⇡ Скачайте архив с исходными данными и распакуйте его в свою рабочую директорию. Найдите в папке raw_images изображение o38-085.tif, откройте и изучите его в любой программе просмотра изображений. Это отсканированный лист топографической карты масштаба 1:100 000 на город Кинешма и его окрестности. Топографические карты на территорию СССР составлялись в проекции Гаусса-Крюгера. Задание проекции позволяет ввести систему плоских прямоугольных координат — соответствующая сетка наносится на лист карты. Когда вы работаете с листом карты в бумажном виде, вы можете определить координаты любой точки, проведя несложные измерения относительно линий сетки, измерить расстояния, углы и площади. Использование ГИС значительно упрощает рутинные операции, поскольку все объекты в ГИС-проекте помещены в некоторую систему координат. Но простые растровые изображения таким функционалом не обладают. Чтобы использовать растр в геоинформационной среде, необходимо выполнить его привязку — то есть задать соотношение между внутренней системой координат растра (связанной с его строками и столбцами) и «внешней» проецированной системой координат. Для выполнения привязки нам нужно определить целевую систему координат, в которой следует привязать (соориентировать) исходный растр, а затем выбрать несколько пар точек, для которых известны и внутренние координаты (в системе координат растра), и целевые координаты (в целевой системе координат). Точки пересечения линий сетки прямоугольных координат хорошо подходят в этом качестве, поскольку их целевые координаты подписаны вдоль рамок карты. 5.2.1 Определение целевой системы координат Привязка растра начинается с определения целевой системы координат. Сейчас мы работаем с топографической картой, изданной в 1990 г. в рамках системы топографического картографирования СССР. Топографические карты СССР составлялись в проекции Гаусса-Крюгера на основе датума СК-42, использующего эллипсоид Красовского, с разграфкой по 6-градусным зонам. Описание целевой системы координат должно включать все эти компоненты. Перейдите на сайт Spatialreference.org Стартовая страница сайта Spatialreference.org В правом верхнем углу в окне поиска введите Pulkovo 1942 / Gauss-Kruger и нажмите Search. Примечание 1: датум СК-42 в англоязычной литературе обозначается как Pulkovo 1942. Примечание 1: в описаниях систем координат орфография немецкого языка традиционно не соблюдается. Поэтому для поиска систем координат проекции Гаусса-Крюгера следует вводить именно Gauss-Kruger, а не Gauss-Krüger или Gauss-Krueger. В открывшемся окне используйте кнопку Next Page, чтобы переходить на следующие страницы и найти системы координат, соответствующие нужной вам зоне. Системы координат Гаусса-Крюгера на основе датума СК-42 на сайте Spatialreference.org Обратите внимание на три важных момента. Первое: для вашего листа карты подходит несколько разных систем координат. Второе: название соответствующей системы координат не обязательно содержит номер зоны. Вместо номера зоны может быть указан средний меридиан зоны (Central Meridian, CM). Центральный меридиан для своего номера зоны вы можете определить самостоятельно. Третье: среди описаний встречаются системы координат 3-градусных зон. Они тоже иногда используются, но ваша карта составлена на основе 6-градусной разграфки. Найдя нужные системы координат, откройте страницу каждой из них в новой вкладке браузера. ## Warning: пакет &#39;htmltools&#39; был собран под R версии 4.3.2 Показать подходящие описания проекций для листа карты o38-085.tif EPSG:2498, EPSG:28408, EPSG:28468 Пример описания системы координат на сайте Spatialreference.org Определите, чем отличаются эти системы координат друг от друга. При необходимости посмотрите описания систем координат в форматах Proj4 или ESRI WKT. Выберите подходящую систему координат для привязки. Прямоугольные координаты, подписываемые вдоль северной и южной рамок топографических карт СССР, формируются следующим образом. Берётся фактическое значение прямоугольной координаты, отсчитанное от среднего меридиана зоны, смещённого к востоку на 500 км (например, 348). Слева к этому номеру приписывается номер зоны (например, 8). Полученные числа (например, 8348) обозначают координаты соответствующих линий сетки в километрах. Они подписываются целиком только в углах карты, а в остальных случаях пишется только последние две цифры числа (например, 48). При описании таких координат в ГИС-среде может использоваться как полная форма записи, включающая номер зоны, так и сокращённая форма записи (англ. truncated), не включающая номер зоны. Отличия между вариантами будут заключаться в единственном параметре: смещении координаты X (x_0 в Proj4, false easting в WKT). На наш взгляд, удобнее пользоваться полной формой записи. Фрагмент рамки карты 5.2.2 Привязка листа топографической карты Запустите QGIS и сохраните проект в вашу рабочую директорию В QGIS запустите инструмент для привязки растров («Слой» — «Привязка растров») Инструмент «Привязка растров…» в меню «Слой» Добавьте файл o38-085.tif в окно инструмента привязки. Можно перетащить файл из проводника или воспользоваться кнопкой на панели инструментов Окно привязки растра с загруженным в него изображением В окне привязки по умолчанию активен инструмент добавления опорных точек . С помощью мыши увеличьте изображение северо-западного угла карты, найдите пересечение линий сетки и определите его координаты. Щёлкните левой кнопкой мыши по пересечению линий сетки, координаты которого вы определили. В появившемся окне введите координаты. Обратите внимание на следующие моменты: В проекции Гаусса-Крюгера ось X считается направленной на север, ось Y — на восток. В QGIS и большинстве других геоинформационных программ ось X направлена на восток, ось Y — на север. Координаты, подписанные вдоль рамки карты, измеряются в километрах. Координаты, которые вам нужно ввести для привязки, должны быть измерены в метрах. Непосредственно под формами ввода координат расположен выпадающий список, позволяющий выбрать систему координат. Убедитесь, что в этом поле выбрана нужная вам система координат. Сверьтесь с изображением ниже, чтобы убедиться, что вы всё делаете правильно: Процесс добавления новой опорной точки Чтобы включить подписи идентификаторов точек, зайдите в «Параметры» — «Настройки привязки растров» Аналогичным образом добавьте ещё четыре опорных точки: три точки в других углах листа карты и одну точку в центре листа карты Окно привязки после расстановки пяти опорных точек Изучите информацию, которая отображается в таблице внизу. «X источника» и «Y источника» — это координаты точек привязки на исходном растре, измеренные в пикселях растра от левого верхнего угла. «X назначения» и «Y назначения» — координаты на местности. В столбцах «dX», «dY» и «Невязка» будут отображаться несхождения в определении координат. Сейчас там отображаются нули, поскольку мы ещё не задали настройки трансформации. Откройте интерфейс настроек трансформации растра, нажав на кнопку . Изучите доступные параметры. Самостоятельно определите значение параметра «Тип трансформации». Параметр «Метод интерполяции» установите в значение «Линейная» Чтобы установить целевую систему координат, нажмите кнопку Окно выбора системы координат Выберите нужную систему координат по её названию или EPSG-коду и закройте окно выбора проекции, нажав OK Теперь, когда вы задали параметры привязки, нужно указать, куда будет сохранён привязанный файл. Это задаётся настройкой «Целевой растр». Укажите, что растр нужно сохранить в папку referenced_images вашей рабочей директории под именем o38-085_modified.tif. Также нужно отметить опции «Сохранить контрольные точки», чтобы сохранить пары координат в отдельный файл, и «Открыть результат в QGIS», чтобы резульат привязки был автоматически прикреплён к открытому проекту. Остальные параметры оставьте по умолчанию. Закройте окно настроек привязки. Привязка не запустится автоматически: чтобы запустить процедуру, нужно нажать кнопку . Но пока не делайте этого. Изучите величины ошибок, которые отображаются в таблице внизу. Величины ошибок отображаются в пикселах исходного растра. Обычно в практике привязки стараются добиться, чтобы ошибка не превышала 0,5 пиксела (с рядом оговорок). В нашем же случае исходный картографический материал отсканирован с невысоким разрешением, и такой точности достичь не получится. Для учебного упражнения достаточно добиться точности порядка 1,5-2 пиксела. Если точность привязки какой-либо из ваших точек значительно превышает это пороговое значение, удалите точку и установите её заново. Когда величины ошибок станут приемлемыми, нажмите кнопку . QGIS выполнит привязку и попытается добавить изображение к карте. Если при этом появится всплывающее окно выбора параметров трансформации, нажмите ОК. Закройте окно привязки растров. Окно QGIS примет вид, аналогичный представленному ниже: Привязанное изображение в основном окне QGIS Примечание: в новых версиях QGIS в момент добавления нового растра в проект может появиться всплывающее окно с запросом выбора параметров трансформации. Оно появляется, если система координат проекта и система координат добавляемого набора данных основаны на разных геодезических датумах (и если этот запрос не отключён в настройках QGIS). Обсуждение точности преобразований датумов выходит за рамки нашего курса. Если вы студент-картограф, обратитесь к преподавателю за более подробными разъяснениями; остальным же достаточночно принять настройки, предагаемые по умолчанию (нажать OK). Предупреждение о преобразовании датумов 5.3 Добавление базовой карты В начало упражнения ⇡ Мы успешно привязали растровое изображение топографической карты, и теперь можем определять координаты, измерять расстояния и площади по карте при помощи простого ГИС-инструментария. Однако наша карта пока «висит в воздухе». Давайте сравним её с изображением какой-нибудь популярной Интернет-карты, например, Google Maps или OpenStreetMap. Базовые карты из сети интернет могут быть загружены в настольный ГИС-пакет с использованием протокола WMS, WFS или аналогичных. На базовом уровне знакомства с ГИС нас не интересуют технические подробности реализации, поэтому мы воспользуемся простым инструментом загрузки — подключаемым модулем (плагином) QuickMapService. Он позволяет добавлять многие карты из сети интернет «в один клик». Модуль QuickMapService не включается в базовую поставку QGIS, его нужно установить отдельно. Для этого откройте меню «Модули» — «Управление и установка модулей…». Дождитесь, пока сведения о модулях загрузятся. Опция «Управление и установка модулей…» в меню «Модули» В открывшемся окне управления модулями начните вводить QuickMap в строке поиска. Модули будут отфильтрованы по названию. Выберите модуль QuickMapServices в списке и нажмите кнопку «Установить» внизу окна. Дождитесь, пока модуль загрузится и установится. Модуль QuickMapServices в окне работы с модулями После установки модуля его инструменты появляются в меню «Интернет» — «QuickMapServices». По умолчанию доступно небольшое число источников, но его можно увеличить. Для этого перейдите в настройки модуля и на вкладке «Загрузить сервисы» нажмите «Получить дополнительные источники данных». Подождите, пока дополнительные источники будут добавлены к модулю, и закройте настройки Включение дополнительных источников данных в модуле QuickMapServices Теперь вы можете добавить какую-нибудь базовую карту из сети Интернет, просто выбрав её в списке. Добавьте карты Google в проект. Включая и отключая изображение топографической карты в панели слоёв, оцените, насколько хорошо она ложится на базовую карту Google. Отображение топографической карты поверх карт Google Для любознательных: обратите внимание на настройки прозрачности слоёв, а также на подключаемый модуль MapSwipe Tool. Удалите из проекта карту Google и загрузите любую другую базовую карту на ваш выбор. Уберите чёрные рамки вокруг привязанного изображения. Чтобы это сделать, можно воспользоваться следующим способом. Откройте настройки слоя привязанного снимка, перейдите на вкладку «Прозрачность» и введите дополнительное значение «нет данных», равное 0. QGIS будет воспринимать пиксели изображения, имеющие нулевую яркость, как «нет данных», и скроет их при визуализации. Сохраните проект и сделайте снимок экрана. Снимок экрана №1. Привязанная топографическая карта на фоне базовой карты из Интернета. Закройте проект QGIS. 5.4 Использование координат с базовой карты В начало упражнения ⇡ Топографические карты — удобный материал для привязки, поскольку нужные системы координат известны, а точные значения координат нанесены непосредственно на карту. Однако в большинстве случаев привязка требуется таким материалам, у которых ни система координат, ни точные их значения не известны заранее — например, архивные аэрофотоснимки и космические снимки. В таком случае придётся не вводить координаты вручную, а считывать их значения из окна карты, используя в качестве опоры какой-либо материал, уже представленный в целевой системе координат. Создайте новый проект QGIS и сохраните его в вашу рабочую директорию. добавьте к новому проекту в качестве базовой карты любое покрытие космических снимков (например, Google Satellite). Обратите внимание, как изменилась система координат проекта. Переместитесь по карте на юг Российской Федерации, в окрестности города Махачкала Окрестности Махачкалы на мозаике космических снимков Google Откройте модуль привязки и загрузите в него изображение DS1023-2087DF131_b_crop.tif. Это фрагмент космического снимка, полученного в середине 1960-х со спутника системы CORONA (программа Keyhole) Примечание 1: подробнее о спутниках CORONA и программе Keyhole вы можете прочитать по этой ссылке. Примечание 2: у отдельных снимков со спутников CORONA нет своей «собственной» системы координат, мы привязываем снимок и одновременно трансформируем его в целевую систему координат, определяемую базовой картой привязки. Изображение на космическом снимке повёрнуто относительно изображения базовой карты. Чтобы облегчить опознавание опорных точек, мы можем повернуть изображение в основном окне QIGS. Для этого найдите в нижней правой части окна QGIS настройку «Угол поворота» и введите значение 30. Повёрнутое изображение в основном окне карты в сравнении с фрагментов спутникового снимка Начните расстановку контрольных точек. Установите первую точку нажатием левой кнопки мыши. Затем, когда появится окно ввода координат, не вводите координаты вручную, а нажмите кнопку «С карты». Окна привязки и ввода координат будут свёрнуты, давая возможность найти соответственную точку на карте. Найдя точку, кликните по ней левой кнопкой мыши. Координаты точки (в системе координат проекта) будут считаны с карты и подставлены в интерфейс ввода. Пример расстановки опорных точек на снимке с использованием базовой карты Введите таким образом координаты 15-20 точек. Следите, чтобы точки были равномерно распределены по площади снимка и не выстраивались в одну линию. Настройте параметры привязки. Используйте полиномиальное преобразование 2-й степени. Такое преобразование иногда используется для космических снимков с сильными искажениями геометрии. Укажите, что изображение должно быть сохранено в папку referenced_images вашей рабочей директории. Проверьте ошибки положения точек. Поскольку исходное изображение характеризуется высокой зашумленностью и «зернитостью», в этом упражнении не нужно добиваться высокой точности привязки. Ошибка порядка 7-10 пикселов может считаться приемлемой. Расставленные опорные точки на базовой крарте и на снимке Запустите привязку. Когда привязанное изображение добавится в проект, сравните его с базовой картой. Привязанное изображение в основном окне QGIS Если привязанное изображение хорошо согласуется с базовой картой, закройте окно привязки. Если вы видите заметные смещения каких-либо элементов на привязанном изображении относительно базовой карты, вернитесь в окно привязки и отредактируйте опорные точки, а затем снова выполните трансформацию изображения. Верните угол поворота окна карты в исходное значение (0°) и увеличьте изображение до охвата космического снимка. Сделайте снимок экрана. Снимок экрана №2. Привязанный космический снимок на фоне базовой карты из Интернета. Закройте проект QGIS При привязке изображения к базовой карте следует соблюдать следующее правило: детальность карты (снимка), используемого в качестве базы, должна быть выше («лучше»), чем детальность (разрешение) привязываемог изображения. В нашем примере разрешение мозаики космических снимков Google в окрестностях Махачкалы составляет примерно 0,4–1 м, а наилучшее разрешение снимков CORONA — 6 футов, или около 1,8 м. Поэтому снимки Google можно использовать в качестве базовой карты для снимков CORONA. Другая ситация может возникнуть в районах, не затронутых хозяйственной деятельностью человека. Мозаики снимков Google для таких районов создаются на основе снимков Landsat и Sentinel, имеющих наилучшее разрешение порядка 10–20 м, что гораздо грубее, чем разрешение снимков CORONA. Выполнять привязку по такой же схеме, как в этом упражнении, будет методически некорректным решением. Следует использовать другие базовые материалы для привязки. 5.5 Оценка точности привязки В начало упражнения ⇡ В реальных задачах бывает необходимо не только привязать растр, но и оценить точность привязки. Для этого часть опорных точек переводятся в класс контрольных. Эти точки не участвуют в вычислении параметров преобразования, поэтому по ним можно проверять абсолютную точность привязки. Откройте проект, в котором вы работали с топографической картой. Откройте окно привязки и снова загрузите в него исходное изображение топографической карты. Загрузите опорные точки, которые вы использовали ранее для привязки этого листа карты (файл с расширением *.points в папке referenced_images). Настройте параметры привязки: алгоритм привязки, алгоритм трансформации, систему координат и т.д. Теперь добавьте ещё четыре опорные точки между «угловыми» и «центральной». Дополнительные опорные точки Когда вы добавите дополнительные точки, отключите их: снимите галочки в таблице возле их названий. Отключённые опорные точки перейдут в разряд контрольных: они не будут использоваться для вычисления параметров преобразования, но разность между теоретическим и фактическим значением координат для них будет рассчитана. Отключение опорных точек: Найдите максимальную ошибку привязки по контрольным точкам. Запишите её с точность до второго знака после запятой в отчётный файл. Обратите внимание, что величина ошибки измеряется в пикселах. Чтобы получить абсолютное значение, нам нужно умножить эту величину на размер пиксела на местности Запустите привязку растра. Добавьте привязанный растр в проект QGIS, если это не произошло автоматически. Откройте свойства добавленного растра и выясните (на вкладке «Информация»), каков размер его пикселя в целевой системе координат Рассчитайте максимальное значение абсолютной ошибки привязки (в метрах) и впишите это значение в отчётный файл. Сохраните контрольные точки в новый файл и закройте проект QGIS. 5.6 Интерактивная привязка растров на основе аффинного преобразования В начало упражнения ⇡ В предыдущих разделах упражнения мы рассматривали привязку при помощи опорных точек. Но есть и другой способ, менее точный, но в ряде случаев более быстрый и удобный — интерактивная привязка (freehand georeferencing). Этот способ годится в следующих случаях: когда необходимо ввести в ГИС-проект эскизные материалы, выполненные с невысокой точностью («традиционная» привязка в этом сценарии практически неприменима), или если нужно привязать современные картографические материалы, для которых заранее известна система координат (например, схемы и планы, составленные на основе изображений из картографических веб-сервисов). В этом упражнении мы рассмотрим второй сценарий. Изучите изображение 20_okrugov_27-04-2020_13-32-09.png. На какой основе оно составлено? Создайте новый проект QGIS и сохраните его в вашу рабочую директорию. Добавьте из набора QuickMapServices ту базовую карту, на основе которой составлено изображение из п. 1 Примечание: по техническим причинам эта базовая карта может быть недоступна через QuickMapServices. Если она не загружается, воспользуйтесь любой другой картой общегеографического содержания (например, 2GIS Map, Bing Map, Google Road и др.) Установите модуль Freehand raster georeferencer. Панель инструментов Freehand raster georeferencer Увеличьте изображение в окне QGIS таким образом, чтобы охват базовой карты, отображающейся в окне QGIS, примерно соответствовал охвату схемы избирательных округов. Целевой охват перед началом интерактивной привязки Нажмите кнопку «Add Raster for Interactive Georeferencing» . В открывшемся диалоговом окне с помощью кнопки «Browse…» укажите путь к файлу 20_okrugov_27-04-2020_13-32-09.png, а затем нажмите «Add New». Полупрозрачное изображнение отобразится поверх базовой карты. . Изучите опции преобразования растра, доступные на панели привязки. Попробуйте двигать, масштабировать и увеличивать/уменьшать изображение. Чтобы отменить последнее действие, нажмите кнопку Undo . Верните растр в исходное положение и активируйте кнопку «Georeference raster with 2 points» на панели инструментов интерактивной привязки. Будет активирован режим интерактивной привязки по двум точкам. Опознайте на привязываемом растре и на основе какую-либо общую точку (например, характерный перекрёсток). Затем подведите курсор к этой точке на привязываемом растре, зажмите левую кнопку мыши и передвиньте курсор к той же точке на основе, как показано на изображении ниже: . Найдите ещё одну аналогичную пару точек и повторите действия, описанные в предыдущем пункте. Если всё сделано правильно, растр должен, насколько это возможно, совпасть с основой. Если этого не произошло, воспользуйтесь кнопкой Undo , а затем попробуйте ещё раз. . Чтобы сохранить результат привязки, нажмите кнопку «Export Raster with World File» . Сохраните результат привязки в папку georeferenced_images Сделайте снимок экрана. Снимок экрана №3. Привязанное изображение схемы избирательных округов.. Ответьте на вопросы в контрольном листе. "],["digitizing-topomap.html", "Упражнение 6 Ручная векторизация растра 6.1 Введение 6.2 Подготовка исходных данных 6.3 Создание точечных объектов 6.4 Создание линейных объектов 6.5 Создание полигональных объектов 6.6 Оформление макета компоновки", " Упражнение 6 Ручная векторизация растра Архив с исходными данными Контрольный лист: не требуется Внимание! Ваш преподаватель может предоставить вам другие исходные данные для выполнения этого упражнения или скорректировать его задачи: листы топографической карты. При возникновении противоречий следуйте указаниям преподавателя. 6.1 Введение Цель задания — освоение навыков создания векторных пространственных объектов разной геометрии путём векторизации растра. Необходимая теоретическая подготовка: Концептуальные модели представления пространственной информации, модели пространственных данных, модели пространственных объектов. Векторная модель пространственных данных. Системы координат и проекции карт, привязка геоизображений, трансформирование геоизображений. Векторизация растра. Необходимая практическая подготовка: Знание основных компонент интерфейса QGIS (менеджер источников данных, панель слоёв, фрейм карты). Добавление источников пространственных данных в проект. Настройка символики и подписей объектов. Привязка растра. Создание макета, добавление карты и зарамочного оформления, экспорт макета. Результат: Набор пространственных данных, созданный на основе фрагмента изображения топографической карты. 6.1.1 Контрольный лист Привязать лист топографической карты Создать наборы пространственных данных, описывающие объекты точечной геометрии Создать наборы пространственных данных, описывающие объекты линейной геометрии Создать наборы пространственных данных, описывающие объекты полигональной геометрии Оформить картографическое изображение, создать макет компоновки 6.2 Подготовка исходных данных В начало упражнения ⇡ Загрузите архив с исходными данными и распакуйте его в вашу рабочую директорию. Создайте новый проект QGIS и сохраните его в ту же директорию, где находятся исходные данные. Привяжите лист топографической карты. Если вы испытываете затруднения с привязкой растра, сверьтесь с упражнением 5 Увеличьте изображение до фрагмента территории к юго-западу от плотины Красноярской ГЭС, как показано на рисунке ниже. Вы будете работать с окрестностями посёлка, обозначенного на карте как «Шумиха» (квадраты 9850, 9852, 0050, 0852) Квадрат на листе топографической карты указывают подписями (номерами) образующих его километровых линий: сначала нижней горизонтальной линии, а затем левой (западной) вертикальной линии. В примере выше топоним «Шумиха» находится в квадрате 9852. 6.3 Создание точечных объектов В начало упражнения ⇡ Чтобы начать создавать новые объекты в геоинформационной среде, необходимо сначала создать набор данных (базу данных), в которой эти объекты будут храниться. QGIS позволяет создавать и редактировать векторные пространственные данные во множестве различных форматов, но в качестве основного формата принят GeoPackage. Файл GeoPackage представляет собой базу данных SQLite с дополнительными функциями для хранения наборов пространственных данных. Вся необходимая информация хранится в единственном файле *.gpkg; в процессе работы создаются временные файлы. В одном файле может быть сохранено несколько наборов пространственных данных (иногда их также называют «таблицами», tables, или «слоями», layers) Мы начнём векторизацию с объектов точечной геометрии. На фрагменте листа их два типа: геодезические пункты и отметки высот. Также есть условный знак отдельно расположенных дворов, не выражающихся в масштабе карты, но его мы проигнорируем. Сначала мы создадим новый файл формата GeoPackage и одновременно новую таблицу в нём для хранения данных о пунктах геодезической сети, затем добавим ещё одну таблицу к уже существующему файлу GeoPackage. Обратитесь к «Условным знакам для топографических карт», чтобы идентифицировать нужные объекты на фрагменте листа карты. Запустите процедуру создания нового набора данных GeoPackage. Для этого нажмите кнопку «Создать слой GeoPackage…» () на панели менеджера источников данных или сочетание клавиш Ctrl+Shift+N. В открывшемся окне введите следующие параметры: База данных: сохраните файл *.gpkg в домашний каталог вашего проекта. Назовите его по образцу Ex06_topo_%Фамилия%.gpkg, где %Фамилия% — ваша фамилия в латинской транслитерации; Имя таблицы: geodetic_points; Тип геометрии: точечная Чекбоксы «Include Z dimension» и «Include M values» оставьте выключенными; Система координат: такая же, как система координат проекта. Окно создания нового файла GeoPackage Помимо геометрии объектов, нам нужно будет хранить семантическую информацию. Для точечных объектов, представляющих пункты геодезической сети, на карте подписываются высоты их центров. Для хранения этой информации создайте новое поле с названием center_elevation типа «Десятичное число» (double), как показано на рисунке ниже. Создание нового поля для набора данных Проверьте правильность заполнения параметров. Если всё заполнено правильно, нажмите ОК. Новый слой будет добавлен в проект. Переименуйте добавленный слой в «Геодезические пункты». Если необходимо, измените условный знак слоя таким образом, чтобы он контрастировал с изображением листа топографической карты. Теперь мы готовы начинать векторизацию объектов. Для начала векторизации выберите слой «Геодезические пункты» в таблице слоёв, а затем нажмите кнопку «Режим редактирования» () на панели инструментов редактирования. Альтернативный вариант: можно запустить режим редактирвоания из контекстного меню слоя. Нажмите на панели редактирования кнопку «Добавить точечный объект» (). Курсор примет вид мишени. Переместите курсор на любой из геодезических пунктов и нажмите левую кнопку мыши, чтобы установить новую точку в этом месте. Новая точка будет установлена, также будет открыто окно ввода атрибутов. Введите высоту знака, подписанную на топографической карте, и нажмите ОК. Повторите процедуру для всех оставшихся геодезических пунктов на карте. Векторизация геодезических пунктов По окончании ввода точек нажмите кнопку «Сохранить изменения» () на панели редактирования, а затем отключите режим редактирования. Обратите внимание: сохранение изменений в наборах пространственных данных делается независимо от сохранения проекта! Вы должны самостоятельно сохранять правки в слоях после каждого серьёзного изменения. Если выйти из режима редактирования без сохранения изменений, система предложит сохранить их во всплывающем окне. Измените условный знак слоя геодезических пунктов таким образом, чтобы он максимально походил на условный знак, принятый на топографических картах. Настройте подписи для слоя геодезических пунктов. Теперь вы векторизуете отметки высот. Для этого вы создадите новую таблицу в уже существующем файле GeoPackage. В панели браузера раскройте содержимое папки «Домашний каталог проекта» и вызовите контекстное меню файла GeoPackage, созданного ранее. В контекстном меню выберите опцию «Новая таблица…» Создание новой таблицы в файле GeoPackage GeoPackage Будет открыт интерфейс создания новой таблицы в существующем файле GeoPackage. Он визуально отличается от того, что вы использовали на первом шаге, но содержимое его точно такое же. Настройте параметры следующим образом Имя таблицы: elevation_points; Тип геометрии: точечная Имя поля геометрии: оставьте значение geom, предлагаемое по умолчанию Чекбоксы «Include Z dimension» и «Include M values» оставьте выключенными; Система координат: такая же, как система координат проекта. Добавьте поле elevation типа «Десятичное число» (Real) для записи отметок высот. Сверьтесь с изображением ниже, чтобы убедиться, что вы всё сделали правильно. Настройки новой таблицы Нажмите OK, чтобы завершить процесс создания новой таблицы. Новая таблица не добавляется в проект автоматически. Чтобы добавить новую таблицу в проект вручную, дважды щёлкните по её названию в панели браузера. Переименуйте добавленный слой в «Отметки высот» Векторизуйте отметки высот, находящиеся в пределах ваших квадратов. По окончании векторизации сохраните правки и измените стиль слоя таким образом, чтобы он максимально походил на изображение, принятое на топографических картах. 6.4 Создание линейных объектов В начало упражнения ⇡ Мы закончили векторизацию объектов точечной геометрии и можем переходить к более сложным объектам линейной геометрии. На нашем листе карты представлены следущие линейные объекты: Береговая линия; Реки и ручьи шириной менее 10 м (изображаются на карте «в одну линию»); Автодороги. Контуры растительного покрова и грунтов. Горизонтали Реки и ручьи, а также контуры растительного покрова и грунтов в пределах рассматриваемой территории не имеют значимой семантики. На береговой линии имеется участок, обозначенный знаком обрыва, но в рамках этого упражнения мы его проигнорируем. Автодороги в пределах участка бывают двух типов: автомобильные дороги с усовершенствованным покрытием (оранжевые) и автомобильные дороги без покрытия (белые). Для автодорог с усовершенствованным покрытием подписывается ширина дороги, ширина земляного полотна и материал покрытия, но мы не будем работать с ними в рамках настоящего упражнения. Горизонтали в пределах участка встречаются основные и утолщённые; кроме того, каждой горизонтали должно быть сопоставлено значение высоты. Создайте в файле GeoPackage пять новых таблиц: coastline_lines (береговая линия) rivers_lines (реки и ручьи) vegetation_lines (контуры растительного покрова и грунтов) roads_lines (автодороги) contour_lines (горизонтали) Тип геометрии для всех таблиц — «Линия», система координат — та же, что в проекте. Не создавайте полей таблицы атрибутов для этих объектов, мы добавим их позже. Добавьте в проект таблицу rivers_lines и переименуйте слой в «Реки и ручьи». Измените цвет линии слоя таким образом, чтобы он контрастировал с картографическим изображением. Начните векторизацию с водотоков, находящихся в северной части участка и впадающих непосредственно в водохранилище. Включите режим редактирования и нажмите кнопку «Добавить линейный объект» (). Векторизуйте водотоки по направлению от истока к устью, устанавливая новые узлы с помощью левой кнопки мыши. Чтобы завершить редактирование линии и перейти к следующей, нажмите правую кнопку мыши. Ошибочно установленные узлы можно удалить с помощью кнопки Backspace. Векторизация линий водотоков Теперь перейдите к юго-западной части фрагмента, где несколько водотоков образуют древовидную сеть. Чтобы корректно векторизовать такие водотоки, необходимо использовать прилипание (снеппинг). Прилипание позволяет установить новый узел точно в координаты существующего узла. Включите панель «Инструменты прилипания», если она отключена. Векторизация линий водотоков Нажмите на панели инструментов прилипания кнопку «Разрешить прилипание» (), чтобы активировать режим прилипания. Проверьте, что прилипание осуществляется ко всем слоям (вторая кнопка справа на панели). Укажите, к каким элементам следует осуществлять прилипание (третья кнопка слева на панели). Включите прилипание к вершинам и линиям. Настройки прилипания Векторизуйте систему водотоков, используя прилипание. Начните векторизацию с любого истока и закончите объект на первом по течению слиянии. Затем векторизуйте соседний объект, впадающий в то же место слияния; при установке последней точки убедитесь, что срабатывает прилипание к существующему объекту: целевое положение узла обозначается сиреневым квадратом. Ориентируйтесь на рисунок ниже: Векторизация линий водотоков с использованием прилипания Векторизуйте все водотоки, которые хотя бы частично попадают в целевые квадраты. По окончании векторизации сохраните правки и измените внешний вид слоя таким образом, чтобы он максимально соответствовал изображению на топографической карте. Добавьте в проект таблицу coastline_lines. Переименуйте новый слой в «Береговая линия» и настройте для него контрастный условный знак. Начните векторизацию береговой линии. В ходе векторизации используйте прилипание, чтобы береговая линия точно стыковалась с реками и ручьями. Не пытайтесь векторизовать всю линию целиком: периодически завершайте объект, сохраняйте правки и начинайте создание нового объекта от последней установленной точки. Примечание: положение узлов уже созданного объекта можно изменять с помощью инструмента редактирования вершин в текущем слое () Теперь, когда вся береговая линия векторизована, нужно объединить её в один объект. Для этого нам потребуются инструменты с панели выбора объектов, а также с панели дополнительных инструментов оцифровки. Убедитесь, что обе эти панели включены Панель выбора объектов Панель дополнительных инструментов оцифровки Используя инструмент «Выбрать объекты в прямоугольнике или точке» (), обведите рамкой все объекты в слое «Береговая линия». Сами линии будут выделены жёлтым цветом, а их вершины — красными крестиками. Выбор объектов в слое Нажмите кнопку «Объединить выделенные объекты» () на панели дополнительных инструментов оцифровки. В открывшемся окне будет предложено определить, что делать с атрибутами объектов. Оставьте все значения по умолчанию и нажмите OK. Все объекты в слое береговой линии будут объединены в один. Сохраните правки в слое «Береговая линия» и измените символику слоя так, чтобы результат максимально походил на изображение топографической карты. Добавьте на карту таблицу границ растительного покрова и грунтов, переименуйте слой в «Границы растительности» и векторизуйте объекты, попадающие на выбранные вами квадраты. Примечание: границы растительности могут образовывать замкнутые контура. Чтобы векторизовать такой контур, необходимо включить опцию самоприлипания () После окончания векторизации линий границ измените символику слоя, чтобы она походила на изобравжение топографической карты. Добавьте в проект таблицу автодорог и переименуйте слой в «Автодороги». Как мы помним, для этого набора данных необходим дополнительный столбец таблицы атрибутов, который не был создан в момент создания самой таблицы. Мы добавим его на следующем шаге. Откройте таблицу атрибутов слоя автодорог и запустите редактирование этого слоя. В панели инструментов таблицы атрибутов нажмите кнопку «Новое поле» () или комбинацию клавиш Ctrl+W на клавиатуре. Будет открыто окно добавления нового поля. Примечание: создание и удаление полей таблицы атрибутов — это изменение структуры базы данных. В большинстве программных средств ГИС эти операции делаются при выключенном режиме редактирования. QGIS представляет собой исключение из общего правила. Создайте поле road_type текстового типа. Размер (длину) поля можно не устанавливать. Закройте таблицу атрибутов и перейдите в основное окно QGIS. Векторизуйте участок дороги с усовершенствованным покрытием в северной части территории. По окончании векторизации введите необходимое значение атрибута. Векторизуйте дорогу без покрытия в населённом пункте, обозначенном как «Шумиха». Сохраните правки и измените стилистику слоя. Задайте разные условные знаки для дорог разного типа. Чтобы создать знак, похожий на изображение топографической карты, воспользуйтесь многослойными символами: верхний слой символа должен представлять собой линию оранжевого (или белого) цвета, нижний слой — более широкую линию чёрного цвета. Пример изображён на рисунке ниже: Настройка стиля линий для автодорог После окончания векторизации автодорог отключите исходный растр и проверьте, как выглядит изображение слоёв вашего проекта. Для справки сверьтесь с изображением ниже: Слои проекта после настройки Добавьте на карту таблицу горизонталей, переименуйте слой в «Горизонтали» и добавьте необходимые столбцы таблицы атрибутов (contour_type для типа горизонтали, contour_elevation для высоты). Отключите прилипание, затем в панели инструментов оцифровки переключитесь на опцию «Оцифровка в потоковом режиме» или нажмите клавишу R на клавиатуре. Включение оцифровки в потоковом режиме Векторизуйте горизонтали в пределах любого одного выбранного квадрата в потоковом режиме. Для этого установите курсор в стартовую точку, а затем медленно ведите курсор вдоль линии. Векторизация линий водотоков с использованием прилипания Если трассировка покажется вам неудобной, переключитесь обратно в режим векторизации по сегментам. После окончания векторизации горизонталей настройте их внешний вид аналогично изображению топографических карт, за исключением подписей. 6.5 Создание полигональных объектов В начало упражнения ⇡ На нашем листе карты представлены следущие объекты полигональной геометрии: Площадные объекты гидрографии (водохранилище) Контура растительного покрова (леса) Здания и сооружения. В ходе выполнения упражнения мы проигнорируем условные знаки травяной и кустарниковой растительности. Создайте в файле GeoPackage три новых таблицы: water_polygons (водохранилище) vegetation_polygons (лесные массивы) building_polygons (застройка населённых пунктов) Для таблиц water_polygons и vegetation_polygons установите тип геометрии «Полигональная» («Площадная»), для building_polygons — «Мультиполигон». Для водохранилища и населённых пунктов предусмотрите поле строкового (текстового) типа для хранения названия. Не используйте name в качестве названия этого поля, поскольку это зарезервированая системная переменная. Лучше назвать поле water_name и buildings_name соответственно. Добавьте таблицу векторных объектов гидрографии в проект и переименуйте слой в «Водохранилища». Начните векторизацию водохранилища. На предыдущих шагах мы уже векторизовали береговую линию, поэтому сейчас при создании полигонального объекта нам нужно будет точно повторить существующий контур. Для решения этой задачи существует специальная функция трассировки (tracing), она включается с помощью кнопки «Включить трассировку» на панели инструментов прилипания (). Включив трассировку, установите первый узел создаваемого объекта водохранилища на береговой линии за пределами целевых квадратов. Затем проведите курсором вдоль береговой линии и установите новый узел на некотором удалении от первого. Если трассировка включена, все промежуточные узлы будут расставлены автоматически. Повторите эту операцию столько раз, сколько нужно для векторизации контура водохранилизща вдоль имеющейся береговой линии. Последний узел создаваемого полигона установите в акватории за пределами векторизуемых квадратов. Посмотрите изображение ниже, чтобы увидеть, как это делается: Трассировка контура водохранилища вдоль береговой линии Сохраните правки в слое водохранилищ и измените символы слоя на максимально близкие к изображению топографической карты. Как и для горизонталей, не включайте подписи. Добавьте в проект таблицу с контурами растительности. Переименуйте слой в «Растительность и грунты». Используя уже известный вам инструмент трассировки, векторизуйте границы лесных массивов. При этом пока не обращайте внимания на «дырки» внутри контуров леса — мы будем работать с ними на следующем шаге. В результате векторизации ваш проект должен принять вид, аналогичный показанному ниже: Контура лесных массивов без «дыр» Теперь мы удалим незалесённые фрагменты из полигонов лесных массивов, ориентируясь на границы растительности, оцифрованные ранее. Найдите на панели дополнительных инструментов оцифровки и включите инструмент «Добавить кольцо» (). Используя этот инструмент и включённую трассировку, очертите контур любой из «дыр» на участке, как показано на рисунке ниже: Создание «дыр» в полигонах Повторите операцию для всех аналогичных контуров. Сохраните правки в слое растительности и измените символы слоя на максимально близкие к изображению топографической карты. Отключите все слои, кроме исходного растра листа топографической карты. Добавьте в проект таблицу со зданиями. Переименуйте слой в «Здания и сооружения» Включите режим редактирования для слоя зданий и сооружений и отключите прилипание. Векторизуйте самую крупную группу зданий в населённом пункте, подписанном как «Шумиха». Теперь мы векторизуем другие группы зданий в том же населённом пункте, но сделаем это так, чтобы новые контура не образовывали новые объекты, а добавлялись к предыдущему (используем мультиполигональную геометрию). Для этого выберите созданное здание с помощью инструмента выборки (), а затем создайте новый фрагмент объекта с помощью инструмента «Добавить часть» () с панели дополнительных инструментов оцифровки. Векторизуйте таким образом все здания в этом населённом пункте. Повторите аналогичные операции для других групп зданий в пределах векторизуемых квадратов. Каждая группа зданий должна быть самостоятельным объектом, все отдельные здания в пределах группы должны быть частями этого объекта. Сохраните правки в слое зданий и сооружений и измените символы слоя на максимально близкие к изображению топографической карты. Настройте подписи объектов. 6.6 Оформление макета компоновки В начало упражнения ⇡ Убедитесь, что режим редактирования выключен для всех векторных слоёв проекта. Отключите сканированное изображение топографической карты и включите все остальные слои Расположите слои в порядке, соответствующем отрисовке объектов на топографической карте. Если необходимо, ещё раз проверьте и скорректируйте настройки визуализации для слоёв. Ваше изображение должно выглядеть примерно так, как показано на рисунке ниже: Результаты векторизации фрагмента топографической карты Создайте макет компоновки и оформите картографическое изображение в пределах векторизованных вами квадратов листа топографической карты. Добавьте на макет название, легенду, масштабную линейку и сведения об авторстве. Экспортируйте макет в графический файл. "],["digitizing-districts.html", "Упражнение 7 Пространственные и атрибутивные запросы 7.1 Введение 7.2 Подготовка исходных данных 7.3 Создание набора пространственных данных 7.4 Векторизация районов 7.5 Пространственные и атрибутивные запросы 7.6 Визуализация слоя при помощи картодиаграмм 7.7 Создание и экспорт макета компоновки", " Упражнение 7 Пространственные и атрибутивные запросы Архив с исходными данными Контрольный лист 7.1 Введение Цель задания — знакомство с редактированием векторных пространственных данных, элементами базовых технологий ГИС (оверлей, пространственный запрос, атрибутивный запрос). Необходимая теоретическая подготовка: Системы координат и проекции карт, привязка геоизображений, трансформирование геоизображений. Пространственные запросы, атрибутивные запросы, оверлей. Необходимая практическая подготовка: Знание основных компонент интерфейса QGIS (менеджер источников данных, панель слоёв, фрейм карты). Добавление источников пространственных данных в проект. Настройка символики и подписей объектов. Привязка растра. Создание макета, добавление карты и зарамочного оформления, экспорт макета. Исходные данные: Схема районов города с сайта НЕАГЕНТ по состоянию на 2021 г.; набор пространственных данных о зданиях и сооружениях, созданный на основе базы OpenStreetMap Результат: Набор пространственных данных с вернакулярными районами г. Новосибирск и статистикой по застройке в пределах районов. Картодиаграммы по количеству домов и степени застроенности. Картографическое изображение. 7.1.1 Контрольный лист Привязать растровую схему районов города Создать набор пространственных данных о районах путем цифрования растровой карты Добавить семантическую информацию о районах Выполнить серию пространственных и атрибутивных запросов для определения структуры застройки в пределах районов Построить картодиаграммы по полученным значениям Подготовить проект карты с компоновкой 7.2 Подготовка исходных данных В начало упражнения ⇡ Загрузите архив с исходными данными и распакуйте его в вашу рабочую директорию. Создайте новый проект QGIS и загрузите любую картографическую основу с веб-сервиса. Сохраните проект в ту же директорию, где находятся исходные данные. Привяжите схему районов. Если вы не знаете, как привязать схему, сверьтесь с упражнением 5 Снимок экрана №1. Окно QGIS с привязанным растровым изображением. 7.3 Создание набора пространственных данных В начало упражнения ⇡ На этом этапе мы создадим новый векторный набор пространственных данных, в котором будут храниться контура районов. QGIS поддерживает множество форматов пространственных данных, выбор конкретного формата в каждом случае определяется задачами, требованиями и ограничениями проекта. В качестве формата по умолчанию в QGIS 3 используется GeoPackage. Файл GeoPackage представляет собой базу данных SQLite с дополнительными функциями для хранения наборов пространственных данных. Вся необходимая информация хранится в единственном файле *.gpkg; в процессе работы создаются временные файлы. В одном файле может быть сохранено несколько наборов пространственных данных (иногда их также называют «таблицами», tables, или «слоями», layers) Запустите процедуру создания нового набора данных GeoPackage. Для этого нажмите кнопку на панели менеджера источников данных или сочетание клавиш Ctrl+Shift+N. В открывшемся окне введите следующие параметры: База данных: сохраните файл *.gpkg в директорию вашего проекта. Назовите его по шаблону Districts_%Фамилия%.gpkg; Имя таблицы: примите значение, предлагаемое по умолчанию после указания пути к базе; Тип геометрии: полигон (площадная) Чекбоксы «Include Z dimension» и «Include M values» оставьте выключенными; Система координат: такая же, как система координат проекта. Помимо геометрии объектов, нам нужно будет хранить семантическую информацию — номера районов. Создайте новое поле целочисленного типа с названием district_id, как показано на рисунке ниже. Проверьте правильность заполнения параметров. Если всё заполнено правильно, нажмите ОК. Новый слой будет добавлен в проект. 7.4 Векторизация районов В начало упражнения ⇡ Измените стиль слоя на pattern dot blue. Эта символика будет удобна для цифрования, поскольку позволит не «скрывать» растровый слой под создаваемыми объектами и в то же время будет контрастно выделяться на их фоне. Теперь всё готово к редактированию слоя. Режим редактирования запускается при помощи кнопки или из контекстного меню слоя. Запустите режим редактирования. Когда режим редактирования запущен, нажмите кнопку , чтобы начать добавление нового объекта Увеличьте изображение до района, обозначенного цифрой «1». Вы начнёте векторизацию с него. По нажатию левой кнопки мыши устанавливается положение первого узла создаваемого контура. «Обходите» контур по часовой стрелке или против часовой стрелки, устанавливая новые узлы нажатием левой кнопки мыши, как показано на изображении ниже Чтобы завершить редактирование объекта, нажмите правую кнопку мыши. Когда вы завершаете создание объекта в QGIS, появляется окно ввода значений атрибутов. Введите номер района, как показано ниже Когда вы создаёте пространственные объекты в ГИС, важно соблюдать топологию объектов. Координаты узлов соседних объектов должны совпадать, между объектами не должно быть пробелов и перекрытий. Чтобы добиться такого соответствия, вам необходимо активировать опцию прилипания (снеппинга). Найдите панель инструментов прилипания Включите режим прилипания, нажав на иконку с изображением магнита Нажимая на соседние иконки в панели, включите прилипание к объектам во всех слоях, но только к вершинам объектов Установите порог прилипания равным 12 пикселей экрана. Теперь, если вы будете подводить курсор к существующим объектам, его положение будет автоматически «притягиваться» к ближайшим узлам Прилипание позволяет реализовать создание новых объектов путём трассировки по существующим объектам. Включите режим трассировки, нажав на кнопку Оцифруйте соседний объект с помощью трассировки. Для этого подведите курсор к углу существующего объекта и установите первый узел. Затем переместите курсор вдоль общей границы и установите следующий узел. Промежуточные узлы будут добавлены автоматически. После оцифровки общей границы продолжайте векторизацию обычным способом. После добавления нового объекта не забудьте внести его атрибуты во всплывающем окне. Используя полученные навыки, оцифруйте все районы города. Важно! Время от времени сохраняйте ваши правки при помощи кнопки на панели редактирования. В QGIS, как и во всех ГИС-пакетах, сохранение правок в данных выполняется отдельно от сохранения проекта. Несколько советов по редактированию данных: Чтобы отменить последний установленный узел, нажмите Backspace; Чтобы полностью удалить последнюю оцифрованную фигуру, нажмите Ctrl+Z. Чтобы изменить положение отдельного узла уже созданного объекта, можно воспользоваться инструментом редактирования узлов . Трассировка в QGIS работает только тогда, когда весь путь трассировки отображается на экране. Если часть сегмента вылезла за пределы фрейма, трассировка не сработает. Изучите панель «Дополнительные инструменты оцифровки» — она может вам пригодиться Плавные кривые линии (берега, реки и т.п.) при цифровании обычно аппроксимируются ломаными линиями с относительно большим числом узлов — так, чтобы отличия не были визуально заметны. Хотя многие форматы данных позволяют создавать криволинейные объекты, этот подход не являются общепринятым. По окончании цифрования объектов отключите растровый слой и отобразите данные в полном охвате. Сделайте снимок экрана. Снимок экрана №2. Окно QGIS с оцифрованными границами районов. 7.5 Пространственные и атрибутивные запросы В начало упражнения ⇡ В этой части работы вы оцените число жилых домов, оцифрованных пользователями ресурса OpenStreetMap, в пределах вычерченных вами районов. Волонтёрская географическая информация, к которой относится и OpenStreetMap, является важным источником данных для географических исследований благодаря своей детальности и относительной оперативности обновления, однако имеет ряд недостатков: неравномерное покрытие территории данными, низкая согласованность, структурированность и надёжность данных. Для подсчёта числа зданий вы воспользуетесь следующим алгоритмом: Выбрать район на карте Выбрать здания, попадающие в его пределы (пространственный запрос). Из полученной выборки оставить только здания, принадлежащие к определённому типу (атрибутивный запрос). Записать число отобранных зданий в соответствующий атрибут текущего района. Операции повторяются для каждого района. Добавьте на карту набор данных о зданиях, который вы загрузили в начале занятия. Откройте таблицу атрибутов слоя зданий. Для этого нажмите правой кнопкой мыши на слой в панели слоёв и выберите опцию «Открыть таблицу атрибутов» в контекстном меню. Таблица атрибутов — это представление базы данных в виде таблицы. В большинстве случаев работа с семантической информацией в ГИС выполняется через таблицу атрибутов. Определите, какие атрибуты есть у набора пространственных данных о зданиях. Установите, какие значения атрибутов могут соответствовать жилым домам. Закройте таблицу атрибутов слоя зданий и откройте таблицу атрибутов слоя районов. Убедитесь, что для слоя районов включён режим редактирования. В окне таблицы атрибутов слоя районов нажмите кнопку или Ctrl+W, чтобы добавить новое поле, в которое будет записано число жилых домов для каждого района. Добавьте поле с именем number_of_houses целочисленного типа. На этом подготовительные операции закончены, мы переходим к запросам. Выберите любой из районов: выделите строку в таблице атрибутов или воспользуйтесь инструментом выборки в окне карты . Выделенный объект будет подсвечен жёлтым цветом на карте и синим цветом в таблице атрибутов. Теперь выберите те объекты из слоя зданий, которые находятся внутри выбранного района. Для этого запустите инструмент «Вектор» — «Выбор» — «Выбрать по расположению…». Используйте условие «находятся внутри» (are within). Включите опцию «Использовать только выделенные объекты» для выбирающего слоя. Нажмите «Выполнить», чтобы выбрать объекты в слое зданий. Имея выборку в слое зданий и не закрывая окно пространственного запроса («Выбрать по расположению…»), осуществите выборку по атрибутам. Для этого выберите в таблице слоёв слой зданий и нажмите кнопку «Выделить объекты, удовлетворяющие условию» (или нажмите Ctrl+F3. Откроется форма ввода атрибутивного запроса. Атрибутивные запросы в ГИС, как правило, создаются с использованием диалектов языка SQL. Само выражение представляет собой только условие (where clause) и часто использует значения атрибутов. В QGIS можно выполнить запрос и без составления выражения на языке SQL, но поскольку SQL более функционален, мы призываем вас сразу начать пользоваться им. Форма ввода атрибутивного запроса состоит из трёх частей. В левой части конструируется собственно запрос, средняя содержит список доступных переменных и функций, в правой отображается справочная и служебная информация. Сейчас вам нужно будет составить атрибутивный запрос, который позволит выбрать здания, являющиеся (с некоторой вероятностью) жилыми домами. Атрибутивный запрос представляет собой логическое выражение, которое применяется к кортежу базы данных (строке таблицы). Результатом вычисления логического выражения является либо логическая 1 (ИСТИНА), либо логический 0 (ЛОЖЬ). В выборку попадают объекты, для которых при вычислении выражения получено значение 1. В простейшем случае выражение состоит из проверки равенства. Например, выражение \"type\" = 'house' будет истинным для всех объектов, у которых в поле type записано значение house. Можно конструировать более сложные логические выражения с использованием операторов AND (И), OR (ИЛИ) и других. Например, выражение \"type\" = 'apartments' AND \"name\" IS NOT NULL будет истинным для объектов, у которых в поле type записано значение apartments (т.е. многоэтажные жилые дома) и одновременно в поле name записано какое-либо значение, отличное от пустого (NULL) (т.е. имеющие название). А запрос \"type\" = 'garage' OR \"type\" = 'garages' выберет из слоя зданий объекты, у которых в поле type записано либо значение garage, либо значение garages. Примечание 1: в интерфейсе атрибутивного запроса и во всех остальных инструментах QGIS, использующих тот же интерфейс, названия полей обрамляются двойными кавычками (“), а строковые переменные — одинарными кавычками (’) Примечание 2: в QGIS и в большинстве систем управления базами данных (СУБД) для работы с пустыми значениями (NULL) используются отдельные операторы. Например, выражение \"type\" = NULL будет воспринято как некорректное, вместо него следует писать \"type\" IS NULL Составьте выражение, реализующее следующее условие: Выбрать объекты, у которых атрибуту type присвоено значение apartments или house Вводить выражение можно, пользуясь списком функций и полей в правой части окна. Двойной клик по полю или функции добавляет соответствующую запись в окно выражения Мы сформулировали условие для выборки, однако нам нужно выбрать объекты не просто из слоя, а из уже существующей выборки. Для этого откройте выпадающий список кнопки «Выбрать объекты» и выберите функцию «Фильтровать текущее выделение»: После применения фильтра появится всплывающее сообщение с числом выбранных объектов. Эта информация будет продублирована внизу окна QGIS: Введите полученную цифру в таблицу атрибутов слоя районов в строке, соответствующей выбранному объекту (подсвечена синим). Теперь, не закрывая окна пространственного и атрибутивного запроса, выбирайте по очереди каждый следующий объект в слое границ районов и повторяйте для них шаги 3-13. Таким образом вы заполните весь столбец number_of_houses в таблице атрибутов. В процессе выполнения не забывайте периодически сохранять правки. Скопируйте таблицу атрибутов в любой табличный процессор (Microsoft Excel, Google Sheets, LibreOffice Calc). Для этого при помощи сочетания клавиш Ctrl+A выделите все записи в таблице, скопируйте при помощи Ctrl+C и вставьте записи без форматирования в табличный процессор при помощи Ctrl+Shift+V. Удалите столбец wkt_geometry, если он есть в вашей таблице. Скопируйте остальные столбцы и вставьте их в отчётный файл. Таблица №1. Таблица атрибутов слоя районов. Завершите редактирование слоя районов. Отключите отображение слоя зданий. 7.6 Визуализация слоя при помощи картодиаграмм В начало упражнения ⇡ Как вы уже знаете из курса картографии, не существует прямого взаимно-однозначного соответствия между способами изображения, принятыми в картографии, и способами визуализации данных в ГИС. Чтобы отобразить абсолютную величину в пределах единиц статистического учёта (или аналогичных контуров), в картографии применяют способ картодиаграмм. Для создания условных знаков, соответствующих способу картодиаграмм, в QGIS применяется вкладка «Диаграммы» в свойствах слоя. Откройте свойства слоя районов и перейдите на вкладку «Диаграммы». По умолчанию отображение диаграмм отключено. Включите отображение круговых диаграмм, выбрав опцию Pie Chart из выпадающего списка вверху. В настройках диаграмм перейдите на вкладку «Атрибуты». Добавьте атрибут number_of_houses к диаграмме. Задайте для него мягкий оттенок оранжевого или жёлтого цвета. Примечание: вкладка «Атрибуты» нужна для настройки секторов круговых диаграмм. Если вы добавляете несколько атрибутов к диаграмме, программа автоматически рассчитывает размеры секторов для каждого объекта. Сейчас перед нами не стоит такая задача, так что, фактически, можно было не добавлять атрибуты или добавить любой другой. На вкладке «Отрисовка» («Рендеринг») установите для диаграмм настройку прозрачности (70 %) На вкладке «Размер» измените способ задания размера с фиксированного на изменяющийся («масштабируемый»). Изменение размера диаграмм в QGIS работает следующим образом. Пользователь задаёт максимальное значение показателя, который будет управлять размером диаграммы, и соответствующий ему максимальный диаметр диаграммы. Размер круга масштабируется пропорционально величине показателя. Из картографических соображений следует всегда выбирать масштабирование площади (в новых версиях QGIS некорректно переведено как «к поверхности»), а не линейного размера (диаметра). В выпадающем списке «Атрибут» выберите нужный атрибут и нажмите кнопку «Найти, чтобы отобразить его максимальное значение. Оно будет отражено во вкладке «Макс. значение». Округлите полученное максимальное значение в большую сторону до величины, кратной 100. Установите максимальный размер диаграмм равным 14 (мм). Диаграмма такого диаметра будет соответстовать объекту с указанным максимальным значением атрибута. В QGIS есть ещё одна полезная опция — увеличение размера диаграмм. Она применяется, если при масштабировании некоторые диаграммы становятся слишком малы. В таком случае их размер увеличивается до минимального (задаваемого пользователем) порогового значения. В этом упражнении она нам не требуется Перейдите на вкладку «Размещение» и проверьте, что для ваших диаграмм указана опция размещения над центроидом. Перейдите на вкладку «Легенда». Здесь вы настроите комбинацию условных знаков для отображения в легенде. Нажмите кнопку «Условные обозначения для размеров диаграмм» (Show Legend Entries for Diagram Size). Настройте отображение значков следующим образом: «Коллапсируйте» значки легенды; В качестве символа используйте белый маркер круглой формы с тёмно-серой обводкой; Задайте заголовок («Число домов»); Интерфейс настройки диаграммы должен принять приблизительно следующий вид: Важное замечание: такой набор значков не является картографически корректным для легенды к абсолютной непрерывной шкале значков. По состоянию на февраль 2022 г. ни один широко используемый ГИС-пакет не может сделать легенду к размерам кругов картодиаграммы согласно принятым картографическим правилам. Легенды к таким картам следует составлять или исправлять вручную. По окончании настройки символов окно QGIS будет выглядеть следующим образом: Самостоятельно измените настройки отображения слоёв так, чтобы базовая карта не «доминировала» над тематическим содержанием, и сделайте снимок экрана. Снимок экрана №3. Окно QGIS с настроенной символикой. 7.7 Создание и экспорт макета компоновки В начало упражнения ⇡ Изображение, которое вы видите во фрейме данных, можно экспортировать «как есть» (с помощью опции «Проекты» — «Импорт/экспорт» — «Экспортировать карту как изображение…»). Однако для картографических целей, как правило, формируется компоновка карты. На листе заданного формата размещается картографическое изображение, добавляется название, легенда, масштабная линейка и элементы зарамочного оформления. Сейчас мы создадим макет компоновки с расчётом на то, что итоговая карта-схема будет вставлена в отчёт. Создайте новый макет компоновки («Проект» — «Создать Макет…») или Ctrl+P. В качестве названия макета введите свою фамилию. В отличие от проектов QGIS и наборов пространственных данных, на названия макетов компоновки в QGIS не накладывается ограничений. После ввода названия откроется окно компоновки (Layout) Layout Измените ориентацию страницы с альбомной, предлагаемой по умолчанию, на портретную, соответствующую ориентации страниц отчёта. На изображении ниже показано, как это сделать. Layout Добавьте картографическое изображение (фрейм карты) на макет Add map Измените положение и размер фрейма карты таким образом, чтобы на листе оставались поля: левое: 3 см, правое: 1,5 см. Изменяя высоту фрейма, масштаб изображения, а также перемещая картографическое изображение внутри фрейма при помощи кнопки «Переместить содержимое элемента» , добейтесь вида фрейма, аналогичного рисунку ниже: Map layout Не закрывая окно макета, вернитесь в основное окно QGIS и переименуйте слой районов. Назовите его «Районы Новосибирска». Добавьте на макет легенду с помощью кнопки . Поместите легенду в наиболее свободное место в пределах карты. Отключите автообновление легенды и удалите ненужные записи, как показано на рисунке ниже: В свойствах элемента легенды найдите вкладку отступ и удалите (установите равным нулю) отступ под заголовком легенды. Добавьте масштабную линейку с помощью кнопки . Разместите масштабную линейку в юго-западном углу изображения. При необходимости измените обозначение единиц измерения. Добавьте название карты (текстовый элемент) с помощью кнопки . Самостоятельно выберите оптимальное место для размещения названия. Экспортируйте карту-схему («Макет» — «Экспорт в Изображение» или кнопка ) с разрешением 96 точек на дюйм (dpi). Используйте опцию «Кадрировать по содержимому» (Crop to Content). Примечание: разрешение 96 точек на дюйм считается довольно низким для картографических целей. Изображения с таким разрешением не годятся для печати, но иногда могут быть пригодны для размещения в Интернете. ВЫ снижаете разрешение для того, чтобы сохранить читаемость базовой карты. Вставьте полученное изображение в отчётный файл. Итоговое картографическое изобаржение Ответьте на контрольные вопросы в конце отчётного файла "],["geometry.html", "Упражнение 8 Геометрические операции с векторными объектами 8.1 Введение 8.2 Объединение контуров схемы четвертичных отложений 8.3 Построение буферных зон 8.4 Сохранение выборки в новую таблицу 8.5 Нахождение геометрической разности объектов 8.6 Расчёт зональной статистики", " Упражнение 8 Геометрические операции с векторными объектами Архив с исходными данными Контрольный лист 8.1 Введение Цель задания — определить территории, пригодные для нового капитального строительства, используя операции векторного анализа и оверлея. Необходимая теоретическая подготовка: Буферные зоны, слияние (объединение по признаку), векторный оверлей. Необходимая практическая подготовка: Знание основных компонент интерфейса QGIS (менеджер источников данных, таблица слоёв, фрейм карты, менеджер компоновок). Работа с векторными источниками пространственных данных. Настройка символики и подписей объектов. Владение базовыми ГИС-технологиями. Исходные данные: База пространственных данных на территорию части Ленинградской области. Результат: Карта-схема участков Ленинградской области, пригодных для сооружения нового промышленного объекта. 8.1.1 Контрольный лист Объединить контура карты четвертичных отложений Выбрать участки с грунтами, пригодными для строительства Построить буферные зоны вокруг объектов гидрографической сети Построить буферные зоны вокруг объектов дорожной сети Построить буферные зоны вокруг особо охраняемых природных территорий Получить контура застройки путём выбора объектов кадастрового деления Последовательно исключить из участков, пригодных для строительства, контура, образованные лимитирующими условиями 8.1.2 Аннотация Задание посвящено знакомству с пространственным анализом на основе векторных данных. Векторная модель представляет объекты в виде отдельных геометрических фигур с набором атрибутов. Она является объектно-ориентированной и удобна для анализа формы, размеров объектов, их взаимной конфигурации в пространстве. Используя векторное представление, можно рассчитывать длины и площади объектов, строить вокруг них буферные зоны, объединять объекты, имеющие одинаковые значения атрибутов. В этом задании вы изучите работу некоторых инструментов векторного анализа на примере задачи определения территорий, доступных для ведения нового капитального строительства. В рамках задания предполагается, что такое строительство может вестись только на территориях с грунтами, подходящими по литологическому составу, и не может производиться на территориях с теми или иными ограничениями: на землях особо охраняемых природных территорий и в их охранных зонах, в водоохранных зонах рек и озёр, а также на землях, уже занятых жилой застройкой. Следует отметить, что набор критериев, применяемых для решения этой задачи в реальной практике, значительно более обширен и детализирован, однако мы считаем сделанные упрощения допустимыми в методическом отношении. 8.2 Объединение контуров схемы четвертичных отложений В начало упражнения ⇡ Создайте проект QGIS и сохраните его в своей рабочей директории. Добавьте в проект таблицу q_deposit_polygon из базы данных LenObl.gpkg. Изображение слоя четвертичных отложений Переименуйте слой в «Четвертичные отложения» и изучите таблицу атрибутов добавленного слоя. Таблица атрибутов набора данных о четвертичных отложениях Вы можете заметить, что каждый контур схемы четвертичных отложений содержит разнообразную информацию, включая индекс с исходной карты, характеристику механического состава грунта и (для некоторых контуров) генезис рельефа. Для решения задачи нам достаточно знать только механический состав грунта. Мы можем объединить контура, имеющие одинаковый механический состав грунта («стереть границы») между ними, с помощью процедуры слияния (объединения по признаку). Запустите инструмент слияния («Вектор» — «Геоообработка» — «Объединение по признаку…»). Расположение инструмента слияния в меню QGIS Настройте параметры инструмента слияния следующим образом: Исходный слой: Четвертичные отложения Поля классификации: выберите поле (столбец таблицы атрибутов), которое содержит информацию о механическом составе грунта Опцию Сохранять несовпадающие элементы раздельно оставьте выключенной Объединённый слой: в выпадающем меню кнопки справа выберите вариант «Сохранить как GeoPackage…». Сохраните новый GeoPackage в вашу рабочую директорию под именем Ex08_*Фамилия*, где Фамилия — ваша фамилия. После указания имени GeoPackage появится всплывающее окно, где нужно будет указать имя созаваемой таблицы внутри нового GeoPackage. Введите имя ground и нажмите OK Параметры инструмента слияния Примечание: сейчас мы фактически создаём новую базу данных, в которую будем записывать все результаты геоинформационного анализа, получаемые в ходе этого упражнения. В дальнейшем она будет часто упоминаться в упражнении под названием «созданная база данных». Запустите инструмент и дождитесь, когда результат работы будет добавлен в проект. Переименуйте новый слой в «Типы грунта». Результат слияния Изобразите результат слияния способом качественного фона (символизация по уникальным значениям). Исходный слой четвертичных отложений отобразите при помощи тонкой обводки чёрного цвета без заливки. Расположите слой четвертичных отложений над слоем типов грунта и сделайте снимок экрана. Снимок экрана №1. Результат слияния (объединения по признаку) Вопрос №1: как был изменён исходный набор данных в ходе слияния? 8.3 Построение буферных зон В начало упражнения ⇡ По условию задания необходимо исключить из рассмотрения территории, находящиеся в водоохранных зонах. Согласно п. 4 статьи 65 Водного кодекса Российской Федерации, ширина водоохранной зоны для рек или ручьёв различается в зависимости от их протяжённости от истока до устья, а согласно п. 6 той же статьи ширина водоохранной зоны для водоёмов небольшой площади составляет 50 м. Мы определим положение искомых территорий с помощью построения буферных зон. 8.3.1 Буферные зоны постоянной ширины Добавьте в проект таблицы hydrography_line и hydrography_polygon из исходного набора данных. Переименуйте слои в «Водотоки» и «Водоёмы» соответственно. Измените стили слоёв, чтобы сделать изображение похожим на изображение гидрографической сети на общегеографических картах. Слои четвертичных отложений и грунтов пока отключите. Гидрографическая сеть изучаемой территории Постройте буферные зоны радиусом 50 м вокруг водоёмов. Для этого запустите инструмент построения буферных зон («Вектор» — «Геообработка» — «Буфер…»). Расположение инструмента построения буферных зон в меню QGIS В окне инструмента введите следующие параметры: Исходный слой: Водоёмы Расстояние: 50 м Результат буферизации сохраните в тот же GeoPackage, который вы создали на предыдущем шаге, под именем hydrography_polygon_buffer_50m. Для остальных параметров сохраните значения по умолчанию Параметры инструмента построения буферных зон Запустите инструмент и дождитесь, когда результат геообработки добавится в проект. Результат построения буферных зон постоянной ширины 8.3.2 Построение буферных зон переменной ширины Ширина водоохранной зоны для рек зависит от их протяжённости. Для рек протяжённостью до 10 км ширина составляет 50 м, от 10 до 50 км – 100 м, свыше 50 км — 200 м. Мы рассчитаем протяжённость каждой реки и запишем её в таблицу атрибутов, а затем используем калькулятор полей, чтобы задать для каждого объекта собственный размер буферной зоны. Добавьте атрибуты геометрии в таблицу атрибутов слоя «Водотоки». Для этого используйте инструмент «Добавить атрибуты геометрии…» («Вектор» — «Обработка геометрии» — «Добавить атрибуты геометрии…»). Этот инструмент создаёт новый набор данных, дополняя таблицу атрибутов характеристиками геометрии объектов. Сохраните новый набор данных в созданный ранее GeoPackage под именем hydrography_line. Расположение инструмента добавления информации о геометрии в меню QGIS Когда результат обработки будет добавлен в проект QGIS, удалите «старый» слой водотоков, а «новый» переименуйте в «Водотоки» и настройте его символику. Откройте таблицу атрибутов слоя водотоков. Найдите поле length и определите, в каких единицах измеряется и в каких пределах изменяется длина водотоков. Теперь нам необходимо создать новое поле, в котором будет записан целевой радиус буферной зоны. Для этого мы воспользуемся калькулятором полей. Его можно вызвать комбинацией клавиш Ctrl+I или нажатием на кнопку в панели инструментов или в таблице атрибутов. Калькулятор полей используется для вычисления новых значений атрибутов объектов на основе имеющихся пространственных и семантических характеристик. Его интерфейс аналогичен интерфейсу атрибутивного запроса. Окно Калькулятора полей В верхней части окна калькулятора полей задаётся целевое поле для записи вычисленных значений. Это может быть как новое поле, так и уже существующее поле. Если вам необходимо создать новое поле, то следует ввести его название и указать тип данных. Название поля должно быть записано латиницей, не включать пробелы и специальные символы, а также не должно начинаться с цифры. Поскольку вам предстоит рассчитать целевой радиус буферной зоны, назовите поле buffer_radius. Тип поля укажите самостоятельно. Основная часть окна калькулятора полей разделена на три формы. Левая форма служит непосредственно для ввода выражения. В центральной форме собраны все доступные функции, а также поля таблицы атрибутов. В правой форме отображается справка по функциям и вспомогательные формы для полей. Вам необходимо ввести выражение, которое будет выдавать разный результат в зависимости от значения в поле length. Для этого используется функция CASE из раздела «Условные». Разверните группу функций «Условные» в средней форме и дважды щёлкните по названию функции CASE. В конструктор формул добавится следующая строка: CASE WHEN condition THEN result END Это образец синтаксиса функции. Вместо condition подставляется условие, вместо result — результат вычисления. Инструкция CASE открывает блок условия, инструкция END закрывает его. Можно вынести эти инструкции в отдельные строки, а промежуточную часть скопировать и вставить несколько раз. CASE WHEN condition THEN result WHEN condition THEN result WHEN condition THEN result END Теперь будем заполнять выражение нужными значениями. Например, если длина водотока меньше 10 км (10 000 м), то радиус буферной зоны должен быть равен 50. Длина водотока записана в поле length, поэтому блок условия будет выглядеть так: WHEN \"length\" &lt;=10000 THEN 50 Введите это условие, а затем все остальные необходимые условия по образцу. Если необходимо, вы также можете воспользоваться оператором ELSE, который обрабатывает все значения, не покрытые основным набором условий. Окно Калькулятора полей после ввода необходимых условий Нажмите ОК, чтобы выполнить расчёт. По окончании расчёта сохраните изменения в наборе и выключите режим редактирования. Посмотрите, что изменилось в таблице атрибутов. Теперь мы используем рассчитанные значения радиусов непосредственно для построения буферных зон. Запустите инструмент создания буферных зон и задайте слой водотоков в качестве исходного набора данных. Чтобы задать радиус поиска из поля, нажмите кнопку справа от поля «Расстояние» и выберите нужное поле в контекстном меню, как показано на рисунке ниже: Определение радиуса буфера на основе значения в поле таблицы атрибутов Укажите, что выходные буферные зоны должны быть сохранены в созданный ранее GeoPackage под именем hydrography_line_buffer_variable и запустите расчёт буферных зон. Результат расчёта будет добавлен в проект. Результат построения буферных зон переменной ширины 8.3.3 Буферные зоны других объектов Добавьте в проект таблицы автодорог (roads_line) и особо охраняемых природных территорий (reserves_polygon) Создайте вокруг автодорог буферные зоны шириной 50 м и сохраните их в созданный вами GeoPackage под именем roads_buffer_50m. Создайте вокруг особо охраняемых природных территорий буферные зоны шириной 1 км и сохраните их в созданный вами GeoPackage под именем reserves_buffer_1km. Отключите все слои, кроме буферных зон, и сделайте снимок экрана. Снимок экрана №2. Результат построения буферных зон Вопрос №2: что такое буферная зона? Для каких типов геометрии может применяться построение буферных зон? Какой тип геометрии может иметь результат построения буферной зоны в QGIS? Объедините все построенные буферы в один набор пространственных данных. Для этого воспользуйтесь инструментом «Объединить векторные слои…» («Вектор» — «Управление данными»). Систему координат не задавайте, целевой слой назовите buffer_merge. Расположение инструмента объединения векторных слоёв в QGIS Параметры инструмента объединения векторных слоёв Удалите буферные зоны отдельных объектов из проекта, сохраните только объединённый слой буферных зон. Переименуйте этот слой в «Буферные зоны». Изучите таблицу атрибутов полученного слоя. 8.4 Сохранение выборки в новую таблицу В начало упражнения ⇡ В рамках задания мы должны исключить территории, уже занятые застройкой или предназначенные для застройки. Информацию о существующей застройке можно взять из разных источников. В этом упражнении мы воспользуемся кадастровой информацией. Отключите слой буферных зон и добавьте в проект информацию о кадастровом делении (cadastre_polygon). Переименуйте новый слой в «Кадастр» Выберите в слое кадастрового деления объекты, обозначенные как ГКН_УЧАСТКИ и ГКН_ГРАНИЦЫ. Эти объекты ограничивают земли населённых пунктов. Примечание: если вы не помните, как сделать выборку объектов по значениям атрибутов, обратитесь к упражнению 7 Результат выборки в слое кадастра Сохраните выборку как новую таблицу пространственных данных. Для этого вызовите контекстное меню слоя «Кадастр» и найдите в нём опцию «Экспорт» — «Сохранить выбранные объекты как…» Опция сохранения выборки в отдельный слой в контекстном меню В верхней части окна параметров сохранения укажите целевой формат (GeoPackage) и целевой файл (тот же файл, в который вы сохраняли все предыдущие результаты). В качестве имени слоя (таблицы) введите settlements. Настройки параметров экспорта После того, как новый слой будет добавлен в проект, переименуйте его в «Населённые пункты». Удалите слой «Кадастр» из проекта. Слой населённых пунктов в окне проекта QGIS Примечание: фактически ваш новый слой содержит информацию не только о землях населённых пунктов, но мелкими контурами в рамках задания можно пренебречь. 8.5 Нахождение геометрической разности объектов В начало упражнения ⇡ Мы создали геометрические объекты, описывающие территории, непригодные для возведения нового здания (в условиях задачи). Теперь мы воспользуемся векторным оверлеем, чтобы исключить из контуров с пригодными грунтами те части, которые пересекаются с созданными объектами. Это реализуется с помощью операции геометрической разности (difference). Мы применим инструмент нахождения разности последовательно несколько раз, чтобы исключить все неподходящие территории. При этом мы не будем сохранять результат в явном виде на каждом шаге, а вместо этого воспользуемся временными слоями. &gt;Примечание: в различном геоинформационном ПО необходимый инструмент может иметь разные названия. Например, в QGIS он называется «Разность» (*Difference*), а в ArcGIS — «Стирание» (*Erase*) Включите слой «Типы грунта» Выберите в слое «Типы грунта» контура, механический состав которых представлен суглинками и глинами. Запустите инструмент «Разность…» из группы инструментов геообработки. Расположение инструмента вычитания в меню QGIS В качестве исходного слоя («уменьшаемого») выберите «Типы грунта». Обязательно включите опцию «Только выделенные объекты». В качестве оверлейного слоя («вычитаемого») задайте «Населённые пункты». Проверьте, что результат будет сохранён во временный слой. Параметры инструмента разности Важно: на этом шаге инструмент может не сработать из-за некорректной геометрии одного из входных объектов. Если инструмент выдаст сообщение об ошибке, закройте его и в основном окне QGIS откройте окно параметров. На вкладке «Анализ» в разделе «Общие» найдите опцию «Фильтрация ошибочных объектов» и выберите параметр «Пропустить (игнорировать) объекты с ошибочными геометриями». После выполнения упражнения верните изначальное значение этой опции. Параметр игнорирования ошибок геометрии После завершения работы инструмента в проект будет добавлен слой «Разность». Изучите геометрию объектов добавленного слоя, после этого отключите все остальные слои. Результат вычитания слоёв Теперь вычтите из полученной разности слой буферных зон. Новый слой разности тоже будет иметь название «Разность». Не перепутайте эти слои! Результат второго вычитания слоёв Обратите внимание, что все объекты разностей наследуют геометрию от первого оверлейного слоя («уменьшаемого»). В нашем случае это приводит к тому, что в результирующем слое содержится небольшое число мультиполигонов (всего три). Мы бы хотели разделить эти объекты на простые полигоны. Для этого используется инструмент «Разбить составную геометрию». Расположение инструмента преобразования мультигеометрии в QGIS Преобразуйте мультиполигоны в обычные полигоны с помощью инструмента «Разбить составную геометрию». Результат сохраните в ваш GeoPackage под именем available_area. Когда новый слой будет добавлен в проект, переименуйте его в «Доступные территории». Отключите остальные слои и сделайте снимок экрана. Снимок экрана №3. Территории, пригодные для сооружения новых объектов Вопрос №3: что такое оверлей? Какие функции векторного оверлея вы знаете? Как работает функция разности векторных объектов? 8.6 Расчёт зональной статистики В начало упражнения ⇡ На заключительном шаге упражнения мы рассчитаем средние значения высот в пределах полученных контуров. Для этого мы воспользуемся фрагментом глобальной цифровой модели рельефа SRTM (исходное разрешение 3″) и инструментом расчёта зональной статистики Добавьте в проект фрагмент цифровой модели рельефа (файл srtm_fragment_project_crop.tif). Переименуйте новый слой в «Цифровая модель рельефа». ЦМР добавлена в проект Включите панель инструментов анализа, если она отключена. Это можно сделать с помощью кнопки или сочетания клавиш Ctrl+Alt+T. В панели инструментов анализа с помощью строки поиска найдите инструмент «Зональная статистика» Нахождение инструмента «Зональная статистика» в QGIS Задайте в качестве исходного слоя «Доступные территории», а в качестве растрового слоя — цифровую модель рельефа. Введите префикс поля вывода elevation_ (обратите внимание на нижнее подчёркивание). В списке статистик для расчёта укажите среднее, медиану, минимум, максимум и диапазон. Результат сохраните в ваш GeoPackage под именем available_area_zonal_statistics_elevation. Настройки инструмента «Зональная статистика» Когда результат обработки будет добавлен в проект, переименуйте слой в «Доступные территории (зональная статистика)». Изучите таблицу атрибутов этого слоя. Составьте схему территорий, доступных для строительства. Используйте слои, которые сочтёте необходимыми. Подпишите средние высоты в пределах крупных участков. Итоговое картографическое изображение: Территории, пригодные для сооружения новых объектов Вопрос №4: почти каждый шаг этого упражнения можно было выполнить другим путём или в другой последовательности. Напишите, какие шаги (этапы) работы вы могли бы сделать иначе (или в другом порядке) и получить тот же результат. "],["overlay.html", "Упражнение 9 Анализ пространственных взаимосвязей 9.1 Введение 9.2 Визуальный анализ векторных слоев 9.3 Оверлей слоев методом пересечения 9.4 Слияние результатов пересечения с целью получения показателя пространственной связи 9.5 Объединение подтипов почв для подсчёта суммарной площади 9.6 Расчёт площадей объектов 9.7 Соединение таблиц по названию подтипа почв 9.8 Вычисление результирующих значений показателя связи", " Упражнение 9 Анализ пространственных взаимосвязей Архив с исходными данными Контрольный лист 9.1 Введение Цель задания — научиться определять пространственную приуроченность двух явлений на основе процента взаимного покрытия их площадей (методом оверлея). Необходимая теоретическая подготовка: Оверлей пространственных объектов, геометрическое определение вероятности как отношения мер (площадей), соединение таблиц в реляционных базах данных, внешний и внутренний ключ соединения. Необходимая практическая подготовка: Знание основных компонент интерфейса QGIS (менеджер источников данных, таблица слоёв, фрейм карты, менеджер компоновок). Работа с различными форматами источников пространственных данных . Настройка символики и подписей объектов. Владение базовыми ГИС-технологиями. Исходные данные: База данных ГИС «Сатино». Результат: Таблица взаимного покрытия площадей типов рельефа и подтипов почв. 9.1.1 Контрольный лист Добавить на карту слои типов почв и рельефа, оформить их Произвести оверлей слоев Произвести слияние данных и соединение таблиц Подсчитать процент покрытия площадей 9.1.2 Аннотация Задание посвящено знакомству с пространственным анализом на основе векторных данных. Векторная модель представляет объекты в виде отдельных геометрических фигур с набором атрибутов. Она является объектно-ориентированной и удобна для анализа формы, размеров объектов, их взаимной конфигурации в пространстве. Одним из широко используемых методов анализа на основе векторных данных является оверлей. При оверлее происходит наложение двух или более слоев, в результате чего образуется их графическая композиция. Полученные участки наследуют атрибуты от каждого слоя. Эта операция базируется на стандартных отношениях множеств, таких как пересечение, объединение и симметрическая разность. С помощью оверлея можно, например, установить, к каким генетическим типам рельефа приурочены различные типы и подтипы почв. В общем случае оверлей позволяет установить, какие комбинации объектов встречаются в пространстве. В задании предлагается исследовать методом оверлея взаимосвязь типов рельефа и типов и подтипов почв. 9.2 Визуальный анализ векторных слоев В начало упражнения ⇡ В первую очередь при анализе данных следует провести их визуальную оценку, которая может натолкнуть на отыскание закономерностей во взаимном расположении объектов. Распакуйте архив с материалами упражнения в свою рабочую директорию. Создайте проект QGIS в папке с распакованными материалами. Добавьте на карту слой RelTypes из базы геоданных Satino.gdb. Примените к нему стиль из файла RelTypes.qml. Добавьте на карту слой SoilTypes из той же базы. Изобразите его в виде полигонов без заливки с обводкой красного цвета. Выберите инструмент идентификации и щелкните в пределах карты на любом полигоне. Откроется форма идентификации (отображения) атрибутов объекта По умолчанию QGIS идентифицирует объекты либо из самого верхнего слоя (Сверху вниз, до первого найденного, в порядке перечисления в панели слоёв), либо из того слоя, который выбран в панели слоёв (Текущий слой). Можно настроить инструмент идентификации таким образом, чтобы отображать атрибуты объектов из всех доступных слоёв. Для этого в нижней части панели идентификации нужно установить режим Сверху вниз. Пользуясь инструментом идентификации, проанализируйте совмещенное изображение границ типов почв и рельефа. Вопрос 1: Есть ли какие-то совпадения или подобия рисунков контуров типов рельефа и подтипов почв в пределах речных долин, междуречий, малых эрозионных форм? Когда данные исследованы визуально и путем идентификации, можно перейти к их анализу с помощью оверлея. 9.3 Оверлей слоев методом пересечения В начало упражнения ⇡ Инструменты векторного оверлея, а также некоторые родственные им инструменты в QGIS размещаются в меню «Вектор — Геообработка». Также эти инструменты доступны из панели инструментов анализа. Изучите, как работают инструменты геообработки. Для этого сохраните и закройте свой проект QGIS, затем создайте новый проект, а в нём — два временных полигональных слоя. Временный слой в QGIS хранится в выделенной директории среди системных файлов. Если не сохранять временные файлы, они будут удалены после закрытия окна QGIS. Чтобы создать временный слой, нажмите кнопку Новый временный слой в панели менеджера источников данных. Используйте для создаваемых слоёв проецированную систему координат! поочерёдно примените к вашим слоям следующие инструменты геообработки: Обрезать (Clip), Разность (Erase), пересечение (Intersect), Симметрическая разность (Symmetrical Difference), Объединение (Union) и ответьте на вопросы: Вопрос 2: опишите словесно, как будет выглядеть результат применения каждого из инструментов геообработки к произвольной паре наборов данных? Вопрос 3: какие из изученных инструментов геообработки будут выдавать одинаковый результат независимо от порядка исходных слоёв, а для каких этот результат будет различен? Учитывайте не только геометрические, но и атрибутивные свойства результата. Вопрос 4: чем отличаются результаты обработки с помощью инструментов Обрезать (Clip) и Пересечение (Intersect)? Вернитесь в основной рабочий проект. Запустите инструмент Пересечение (Intersect). Настройте параметры следующим образом: Используйте слой SoilTypes в качестве исходного и слой RelTypes в качестве оверлейного. Сохраните выходной набор данных как GeoPackage в вашу рабочую директорию. Назовите выходной файл %фамилия%_geoprocessing.gpkg, а в открывшемся окне задания имени слоя введите Soil_Relief_Intersect. Нажмите «Выполнить», чтобы запустить вычисления. Результат вычислений добавится на карту и в таблицу слоёв под именем Пересечение. Переименуйте добавленный слой в Комбинации почвы-рельеф. Поместите полученный оверлеем слой между слоями типов почв и рельефа, и настройте его отображение в виде полигона без заливки с черной обводкой. Там, где границы совпадают с контурами типов рельефа, они будут черного цвета, а там где они совпадают с контурами типов почв, будет красная линия с черной обводкой. Раскройте атрибутивную таблицу слоя Комбинации почвы-рельеф. Вопрос 5: Какие поля содержатся в атрибутивной таблице полученного слоя? 9.4 Слияние результатов пересечения с целью получения показателя пространственной связи В начало упражнения ⇡ Поскольку каждый полигон в оверлейном слое содержит значение типа/подтипа почвы и типа рельефа, появляется возможность установить приуроченность типов и подтипов почв к определенным типам рельефа. Чтобы подсчитать долю каждого типа рельефа в площади каждого подтипа почв, необходимо просуммировать площади каждой их уникальной комбинации. Например, дерново-карбонатные выщелоченные почвы (Д-в-к) на крутых эрозионных склонах встречаются в пределах Сатинского полигона в виде 6 разрозненных участков, имеющих некоторую суммарную площадь. Эта площадь, деленная на суммарную площадь почв подтипа Д-в-к даст вероятностный критерий приуроченности почв Д-в-к к крутым эрозионным склонам. То же самое касается остальных комбинаций подтипов почв и типов рельефа. С точки зрения рабочих процессов ГИС, операцию следует разбить на 5 шагов: подсчет суммарной площади каждой комбинации подтипа почв и типа рельефа; подсчет суммарной площади каждого подтипа почв; добавление поля, в которое будет записана процентная доля; соединение таблиц комбинаций и подтипов почв по названию подтипа почв; деление площади комбинации на площадь подтипа почв и запись результата в соответствующее поле. Объединение разрозненных объектов, обладающих одинаковым набором атрибутов, осуществляется с помощью операции объединения по признаку (Dissolve). Причем, если объекты примыкают друг к другу, граница между ними будет стерта, а если объекты разнесены в пространстве, на выходе получится составной объект (Multipart feature), состоящий из нескольких полигонов. Объединение по признаку — это один из методов генерализации, он очень часто используется в геоинформационном анализе и картографировании. Откройте инструмент геообработки «Объединение по признаку». Выберите в качестве исходного слоя Комбинации почвы-рельеф. Нажмите на кнопку с изображением многоточия в строке Dissolve fields (optional), чтобы задать поля, по которым будет производиться слияние. В открывшемся списке отметьте поля SoilType, SoilSubtype и RelType. Тем самым можно будет найти все уникальные комбинации подтипов почв и типов рельефа. Поле SoilType необходимо отметить для того, чтобы в таблице результирующего слоя сохранилась информация о типах почв. Это не повлияет на сам результат, поскольку количество комбинаций типа и подтипа почв равно количеству самих подтипов. Укажите путь для сохранения результата объединения по признаку. Сохраните результат в тот же GeoPackage, что и результат пересечения, а слой назовите Soil_Relief_Intersect_Dissolve. Запустите выполнение инструмента. После того, как результат появится в таблице содержания, закройте окно инструмента. Переименуйте полученный слой в Слияние комбинаций почвы-рельеф. Отключите этот слой в таблице содержания. 9.5 Объединение подтипов почв для подсчёта суммарной площади В начало упражнения ⇡ Запустите инструмент объединения по признаку еще раз. Выберите в качестве входных данных слой SoilTypes. В списке полей для объединения выберите поля SoilType и SoilSubtype. Выходной набор данных сохраните в тот же GeoPackage с именем слоя SoilTypes_Dissolve. Остальные параметры оставьте по умолчанию и запустите инструмент. Назовите полученный слой Слияние подтипов почв. В данном слое в результате операции слияния каждый подтип почв будет представлен единственным объектом. Отключите этот слой в таблице содержания. 9.6 Расчёт площадей объектов В начало упражнения ⇡ В отличие от ArcGIS, QGIS не умеет автоматически пересчитывать площади объектов при изменении их геометрии. А изменения, которые мы произвели в процессе объединения по признаку, достаточно велики. Далее мы рассчитаем площади каждого объекта в «объединённых» слоях, затем выполним соединение атрибутивных таблиц и рассчитаем показатель связи на основе соотношения площадей. Откройте таблицу атрибутов слоя Слияние комбинаций почвы-рельеф. В заголовке таблицы найдите Открыть калькулятор полей () или нажмите Ctrl+I. В QGIS, в отличие от ArcGIS и многих СУБД, не требуется отдельно создавать новое поле перед выполнением расчёта. Мы создадим новое поле, в котором будет записана площадь объекта в гектарах, и одновременно заполним его значениями с помощью калькулятора полей. Введите имя поля AREA_HA_INTERSECT и установите тип данных «Десятичное число (real)». Введите выражение $area / 10000 в поле «Выражение». Пояснение: area() — системная функция QGIS, возвращающая площадь объекта. Значок $ означает, что функция будет применена к текущему объекту. Площадь вычисляется в единицах измерения площади, предусмотренных для системы координат источника данных. Для проецированных систем координат это, как правило, метры (реже футы). Назначение выражения / 10000 постарайтесь определить самостоятельно. Нажмите ОК. Слой перейдёт в режим редактирования, а в таблице атрибутов появится новый столбец. Сохраните правки и выключите режим редактирования для слоя Слияние комбинаций почвы-рельеф. Кнопка включения/выключения режима редактирования доступна не только в панели редактирования, но и в окне таблицы атрибутов. Проделайте аналогичную операцию для слоя Слияние подтипов почв. Важно: используйте другое имя для поля площади, например, AREA_HA_SOILS, чтобы избежать ошибки на следующем шаге. 9.7 Соединение таблиц по названию подтипа почв В начало упражнения ⇡ Для расчета пространственной взаимосвязи необходимо поделить площадь каждой комбинации на площадь соответствующего подтипа почв. Эти площади находятся сейчас в разных таблицах — Слияние подтипов почв и Слияние комбинаций почвы-рельеф. Их можно соединить по полю подтипа почв. Соединение таблиц (table join) — операция, в результате которой к одной таблице временно добавляются столбцы из другой таблицы. Чтобы установить соответствие между строками исходной и присоединяемой таблицы, необходимо иметь в каждой таблице поле с общими для них значениями. Например, это может быть числовой код объекта или, как в нашем случае, подтип почв (строковый тип данных). Откройте свойства слоя Слияние комбинаций почвы-рельеф и перейдите на вкладку Связи. Нажмите на кнопку с изображением знака «+» внизу, чтобы добавить новую связь. Настройте параметры соединения, как показано на рисунке ниже: Вопрос 6: Что такое «поле для объединения» и «целевое поле» в QGIS? К каким слоям относится каждое из них? Примените изменения, закройте свойства слоя и откройте таблицу атрибутов. Вопрос 7: Что изменилось в таблице атрибутов после создания связи? 9.8 Вычисление результирующих значений показателя связи В начало упражнения ⇡ Откройте таблицу атрибутов слоя Слияние комбинаций почвы-рельеф, а затем вызовите калькулятор полей. Укажите, что результат вычисления будет сохраняться в новое поле вещественного (real) типа, имя поля — Percent В окне ввода выражения составьте следующее выражение: Площадь сочетания подтипа почв и типа рельефа / Площадь подтипа почв × 100 Подсказка: чтобы использовать значения полей в выражении, найдите в средней панели группу «Поля и значения». Добавляйте поля в выражение, кликая по их названиям дважды левой кнопкой мыши. Запустите расчёт. После окончания расчёта посмотрите получившиеся значения в поле Percent. Удалите соединение таблиц через свойства слоя Слияние комбинаций почвы-рельеф (вкладка «Связи», кнопка с изображением знака «минус» внизу). Отсортируйте таблицу атрибутов по значению поля Percent по убыванию. Выберите объекты, значение показателя связи для которых превышает 75 %. Скройте все столбцы, кроме типа почв, подтипа почв, типа рельефа и поля Percent.. Для того, чтобы скрыть столбец в таблице атрибутов, нажмите на его название правой кнопкой мыши и выберите опцию Hide column. Скомпонуйте окно приложения так, чтобы было видно целиком карту, а также выделенные в таблице строки, а также столбцы, перечисленные в предыдущем пункте. Скриншот 1: окно карты и результирующая таблица Примечание: если размер вашего экрана не позволяет скомпоновать окно QGIS в запрошенном виде, сделайте два скриншота: отдельно основное окно QGIS, отдельно таблицу атрибутов. Сохраните документ карты. "],["spatrelations.html", "Упражнение 10 Анализ пространственных соотношений 10.1 Введение 10.2 Визуальный анализ векторных слоев 10.3 Расчёт площадей и оверлей 10.4 Соединение таблиц по ключевому полю 10.5 Расчёт площадей, не покрытых объектами 10.6 Настройка символики", " Упражнение 10 Анализ пространственных соотношений Архив с исходными данными Контрольный лист 10.1 Введение Цель задания — научиться рассчитывать соотношение различных явлений на регулярной сетке с использованием векторного оверлея. Необходимая теоретическая подготовка: Оверлей пространственных объектов, геометрическое определение вероятности как отношения мер (площадей), соединение таблиц в реляционных базах данных, внешний и внутренний ключ соединения. Необходимая практическая подготовка: Знание основных компонент интерфейса QGIS (менеджер источников данных, таблица слоёв, фрейм карты, менеджер компоновок). Работа с различными форматами источников пространственных данных . Настройка символики и подписей объектов. Владение базовыми ГИС-технологиями. Исходные данные: Векторные контура типов земельного покрова, полученные на основе данных OpenStreetMap. Результат: карта соотношения различных типов земельного покрова. 10.1.1 Контрольный лист Добавить на карту слои типов объектов и регулярную сетку, оформить их Произвести оверлей и слияние объектов в пределах ячеек Рассчитать площадь объектов Присоединить поля площади к таблице регулярной сетки и рассчитать площадь оставшихся объектов Визуализировать результат 10.1.2 Аннотация Задание посвящено знакомству с пространственным анализом на основе векторных данных. Векторная модель представляет объекты в виде отдельных геометрических фигур с набором атрибутов. Она является объектно-ориентированной и удобна для анализа формы, размеров объектов, их взаимной конфигурации в пространстве. Одним из широко используемых методов анализа на основе векторных данных является оверлей. При оверлее происходит наложение двух или более слоев, в результате чего образуется их геометрическая (пространственная) композиция. Полученные участки наследуют атрибуты от каждого слоя. Эта операция базируется на стандартных отношениях множеств, таких как пересечение, объединение и симметрическая разность. С помощью оверлея можно, например, установить, как соотносятся площади объектов разных типов в пределах ячеек регулярной сетки. Это может быть важно при моделировании, например, локальных климатических зон или анализе экологической ситуации. 10.2 Визуальный анализ векторных слоев В начало упражнения ⇡ В первую очередь при анализе данных следует провести их визуальную оценку, которая может натолкнуть на отыскание закономерностей во взаимном расположении объектов. Распакуйте архив с материалами упражнения в свою рабочую директорию. Создайте проект QGIS в папке с распакованными материалами. Добавьте на карту слои Industrial, Hydro, Green, Buildings из базы данных LandCover.gpkg. Присвойте этим слоям разные цвета для лучшего восприятия данных. Создайте регулярную сетку квадратов с помощью инструмента Вектор – Анализ – Создать сетку…. В открывшемся окне параметров инструмента выберите прямоугольный тип сетки, укажите вертикальный и горизонтальный шаг сетки в 1000 м, а в качестве экстента (охвата) слоя укажите существующий слой проекта Buildings. Сохраните сетку в отдельный файл Geopackage в вашей рабочей директории. Измените стиль слоя сетки таким образом, чтобы отображались только границы полигонов. Установите толщину линии границы равной 0,26 мм. Переместите слой на верх таблицы слоёв. Сделайте снимок экрана. Снимок экрана 1: Визуализация исходных данных 10.3 Расчёт площадей и оверлей В начало упражнения ⇡ Для расчёта доли площади каждого типа объекта в пределах ячейки необходимо знать площадь самой ячейки. Для этого выберите слой в таблице слоёв, а затем нажмите кнопку Калькулятор полей . Эту кнопку можно найти на панели атрибутов либо непосредственно в таблице атрибутов. В интерфейсе калькулятора полей укажите, что вы создаёте новое поле, введите имя поля CellArea и выберите подходящий тип поля. Введите в форму выражения функцию $area и выполните расчёт. Примечание: area() — системная функция QGIS, возвращающая площадь объекта. Значок $ означает, что функция будет применена к текущему объекту. Площадь вычисляется в единицах измерения площади, предусмотренных для системы координат источника данных. Для проецированных систем координат это, как правило, метры, реже – футы. Вопрос 1: Почему площади разных ячеек различаются? Почему рассчитанная площадь не равна 1 000 000? При использовании Калькулятора полей автоматически включается режим редактирования. После расчёта площади сохраните изменения и выключите режим редактирования. Для того чтобы рассчитать площади каждого типа объекта в пределах ячеек регулярной сетки, необходимо выполнить операцию пересечения (оверлея) слоев. Для этого воспользуйтесь инструментом Вектор — Геообработка — Пересечение. В качестве входного набора данных (Input layer) укажите регулярную сетку, а в качестве пересекающего набора данных (Overlay layer) — слой с растительностью. Результат сохраните во временный слой. Временный слой в QGIS хранится в выделенной директории среди системных файлов. Если не сохранять временные файлы, они будут удалены после закрытия окна QGIS. Временные слои обозначаются значком справа от названия в таблице слоёв. Результирующий слой будет называться Пересечение или Intersect. Переименуйте его так, чтобы было понятно, в результате пересечения каких именно слоев он получился. Вопрос 2: Чем отличается (визуально) полученный слой от исходного слоя растительности? Вопрос 3: Чем отличается (по структуре таблицы атрибутов) полученный слой от исходного слоя растительности? Повторите аналогичную операцию для оставшихся трёх слоёв. Обратите внимание, что в полученных слоях в пределах каждой ячейки мы видим, как правило, не один объект, а несколько. Мы можем рассчитать площадь каждого из них, но нам нужна суммарная площадь всех объектов. Для получения общей площади можно объединить все объекты в пределах ячейки в один объект. Этого можно добиться с помощью операциии объединения по признаку (англ. Dissolve). Суть этой операции состоит в объединении объектов, имеющих совпадающие значения какого-либо атрибута (или нескольких атрибутов). После оверлея полигонов у каждого объекта растительности появился уникальный идентификатор ячейки регулярной сетки (id), его можно использовать для объединения по признаку. Запустите инструмент Вектор – Геообработка – Объединение по признаку…. В качестве параметров инструмента необходимо указать исходный слой (возьмите пересечение сетки и растительности), а также столбец (или столбцы) таблицы атрибутов, по которому будет осуществляться слияние («поле классификации»). Результат сохраните в тот же файл GeoPackage, в который записана регулярная сетка; задайте имя таблицы green_intersect_dissolve Результирующий временный слой будет называться Объединенный слой или Dissolved – переименуйте его так, чтобы было понятно, о каком типе объектов идёт речь. Повторите аналогичную операцию для оставшихся трёх слоёв. Подсказка: можно не закрывать интерфейс инструмента объединения по признаку, а просто менять необходимые параметры и нажимать «Выполнить» Примечание: из-за ошибок в коде QGIS в некоторых случаях объединение по признаку может срабатывать некорректно: в целевой набор не записываются объекты, и таблица атрибутов не содержит записей. Если вы столкнётесь с такой проблемой, сохраните объединенный слой в новый файл GeoPackage или во временный слой. Рассчитайте площади всех объектов в каждом объединённом слое с помощью калькулятора полей. Используйте осмысленные имена полей, различные для разных наборов данных (например, buildings_area). 10.4 Соединение таблиц по ключевому полю В начало упражнения ⇡ На данном этапе у вас должны быть 4 слоя с известными площадями объектов в ячейках и собственно слой ячеек, для которых рассчитана площадь. Для дальнейшего анализа нам необходимо соединить атрибутивные таблицы всех этих слоёв. Соединение таблиц (table join) — операция, в результате которой к одной таблице временно добавляются столбцы из другой таблицы. Чтобы установить соответствие между строками исходной и присоединяемой таблицы, необходимо иметь в каждой таблице поле с общими для них значениями. Например, это может быть числовой код объекта. Откройте свойства слоя регулярной сетки. Перейдите на вкладку Связи (Joins). Чтобы добавить новое соединение, нужно нажать кнопку «+» внизу. Откроется окно, в котором нужно выбрать слой, атрибутивную таблицу которого мы хотим присоединить, а также ключевые поля, хранящие общие значения – в нашем случае это поля id. Установите галочку напротив опции Присоединенные поля (Joined fields), чтобы выбрать поля, которые нужно присоединить. Нам нужна только площадь объектов. Кроме того, можно включить Пользовательский префикс имени поля и удалить все символы из формы. Проделайте аналогичную операцию для остальных трёх слоёв. 10.5 Расчёт площадей, не покрытых объектами В начало упражнения ⇡ Четыре типа объектов покрывают далеко не всю территорию, поскольку есть и иные объекты, которые в нашем случае не берутся в расчёт. Для корректного анализа и визуализации необходимо рассчитать оставшуюся площадь для каждой ячейки. Это можно сделать, отняв из площади ячейки площади всех объектов каждого типа. Проще всего для такой задачи воспользоваться калькулятором поля. Однако здесь возникает проблема: в атрибутивной таблице встречаются пустые значения (NULL) в полях площадей, которые обозначают отсутствие данных. Такое значение получается в случае, если в ячейке регулярной сетки отсутствует соответствующий тип объектов. Со значением NULL мы не сможем корректно рассчитать оставшуюся площадь, поэтому необходимо заменить его на \\(0\\). Для этого воспользуемся запросами к атрибутивной таблице и калькулятором полей. Сохраните слой регулярной сетки с присоединенными полями как новый набор объектов (GeoPackage), щёлкнув правой кнопкой мыши по нему и выбрав соответствующий пункт меню. Это нужно, чтобы вы могли редактировать присоединённые столбцы и при этом не изменяли данные в исходных слоях. Запустите калькулятор полей для вновь созданного слоя. В открывшемся окне укажите, что нужно не создавать новое поле, а обновить существующее. Выберите одно из полей, содержащих сведения о площади покрытий (зданиями, растительностью и др.) В калькуляторе полей разверните блок Условные и найдите функцию if. Изучите справку к этой функции. Составьте выражение, которое будет выдавать значение 0, если исходное значение поля — NULL, и исходное значение во всех остальных случаях. Важно: вы не можете использовать оператор = вместе со значением NULL, вместо = используйте оператор IS. Чтобы использовать названия полей в выражении, найдите в средней панели группу «Поля и значения». Добавляйте поля в выражение, кликая по их названиям дважды левой кнопкой мыши. Если выражение составлено корректно, значения NULL будут заменены на 0 Проделайте аналогичную последовательность действий с выборкой и калькулятором полей для оставшихся трёх типов объектов. Теперь используйте калькулятор полей, чтобы рассчитать площадь ячейки, не покрытую ни одним из типов объектов. Составьте выражение самостоятельно аналогично представленному на скриншоте ниже. 10.6 Настройка символики В начало упражнения ⇡ Визуализируйте доли покрытий с помощью картодиаграмм. Оформите фрагмент вашего набора данных в виде картографического изображения. Вставьте полученную карту в отчётный файл. Снимок экрана 2: Визуализация результата Сохраните документ карты. Ответьте на контрольные вопросы в отчётном файле. "],["weighted-overlay.html", "Упражнение 11 Оптимизация местоположения 11.1 Введение 11.2 Добавление исходных данных 11.3 Расчет углов наклона 11.4 Расчет расстояний 11.5 Переклассификация наборов данных 11.6 Нахождение мест с наилучшей комбинацией факторов с помощью взвешенного оверлея 11.7 Окончательный выбор участка", " Упражнение 11 Оптимизация местоположения Архив с исходными данными Контрольный лист 11.1 Введение Цель задания — овладеть основами растрового анализа в ГИС на примере решения задачи поиска оптимального местоположения для размещения объектов. Необходимая теоретическая подготовка: Растровая модель пространственных данных, вычисление евклидова расстояния на плоскости, методы классификации числовых рядов, оверлей с весовыми коэффициентами (взвешенный оверлей). Необходимая практическая подготовка: Знание основных компонент интерфейса QGIS (менеджер источников данных, таблица слоёв, фрейм карты, менеджер компоновок). Работа с различными форматами источников пространственных данных. Настройка символики и подписей объектов. Владение базовыми ГИС-технологиями. Исходные данные: База данных ГИС «Сатино», цифровая модель рельефа Сатинского полигона Результат: Набор пространственных данных, содержащий участок, оптимальный по совокупности критериев для размещения объектов. 11.1.1 Контрольный лист Конвертировать слой землепользования в растровое представление Построить и классифицировать растр углов наклона рельефа Построить и классифицировать растры расстояний до водотоков и домов Осуществить взвешенный оверлей полученных растров Конвертировать класс с максимальной суммой баллов в векторное представление и выбрать участок, удовлетворяющий критерию минимальной площади. 11.1.2 Аннотация В предыдущих заданиях вы познакомились с редактированием векторных данных. Для ряда практических задач более удобным оказывается растровое представление. Оно хорошо подходит для анализа географического пространства, которое обладает постоянно меняющимися характеристиками среды. Растровая модель топологически неразрывна, что позволяет моделировать различные поля и перенос вещества в пространстве из одной ячейки в другую. В силу своей регулярности растровая модель проста в обработке, поскольку все операции можно унифицировать, ориентируясь на матрицу ячеек. В частности, к растровым слоям удобно применять операции алгебры карт, такие как сложение, вычитание, суммирование — что и используется данном задании. Вам предстоит решить задачу выбора оптимального местоположения участка для строительства производственного объекта. Критерии выбора следующие: участок должен располагаться на горизонтальном участке или участе с небольшим уклоном. Площадки с крутизной склона более 18° запрещены для строительства; участок должен располагаться вблизи автомобильных дорог; участок должен располагаться вблизи крупных водотоков, поскольку требуется водоснабжение; оптимальные зоны для размещения — открытые пространства, такие как выгоны, пустыри, луга, вырубки и т.д; необходимая площадь участка — не менее 2,5 га. 11.1.3 Прежде чем начать… Инструкция по выполнению этого упражнения предполагает использование инструментов GDAL, интегрированных в сборку QGIS. GDAL печально известен трудоёмкостью установки и нестабильной работой при малейших отклонений от «правильных» условий. Поэтому, если инструменты GDAL выдают ошибку при попытке запуска, попробуйте следующие решения: Обновите QGIS до последней стабильной версии; Воспользуйтесь альтернативными инструментами GRASS и SAGA, интегрированными в QGIS. Для каждого инструмента GDAL в инструкции указаны альтернативные инструменты GRASS и SAGA. 11.2 Добавление исходных данных В начало упражнения ⇡ Скопируйте папку с исходными данными в вашу рабочую директорию и создайте в ней новый проект QGIS. Создайте в этой же папке вложенную папку processing. Вы будете использовать её для хранения промежуточных результатов. Добавьте в проект цифровую модель рельефа (ЦМР, файл DEM.tif). Откройте свойства слоя ЦМР и перейдите на вкладку «Информация». Изучите характеристики файла ЦМР. Для описания геометрии растрового набора данных обязательно задаются следующие характеристики: число строк, число столбцов, шаг сетки (размер ячейки), начальные координаты. Некоторые форматы хранения растровых данных (в том числе GeoTIFF) поддерживают многоканальность; в этом случае указывается также число каналов. В разном программном обеспечении эти параметры могут называться немного по-разному. Вопрос 1: впишите в отчётный файл основные характеристики ЦМР. 11.3 Расчет углов наклона В начало упражнения ⇡ В QGIS имеется ряд инструментов для создания и анализа поверхностей, представленных в растровой форме. Изучите список доступных инструментов в меню «Растр» — «Анализ». Создание, анализ и визуализация поверхностей (в том числе поверхности рельефа) — большая область исследований на стыке геоинформатики, физической географии и ряда других наук. В зарубежной традиции её принято называть геоморфометрией (англ. geomorphometry). Создание и использование алгоритмов расчёта морфометрических характеристик поверхности, таких как крутизна и экспозиция склона — одна из многих задач, решаемых геоморфометрией. Откройте интерфейс инструмента «Крутизна…» из группы «Растр» — «Анализ». Задайте DEM в качестве исходного слоя, все остальные параметры сохраните по умолчанию. Сверните блок «Дополнительные параметры» — в этом упражнении они не требуются. Укажите путь к выходному файлу. По умолчанию QGIS предлагает вам сохранять результат во временный файл, но мы запишем результат явно. Для этого нажмите на многоточие ... справа от поля «Крутизна» в нижней части формы и выберите опцию «Сохранить в файл». Укажите, что файл следует сохранить в папку processing под именем slope.tif. В итоге интерфейс настройки инструмента «Крутизна…» будет выглядеть, как показано на рисунке ниже: Убедитесь, что опция «Открыть выходной файл после исполнения алгоритма» включена. Запустите инструмент. Дождитесь, пока результат расчёта добавится в проект. Присвойте добавленному слою имя «Крутизна», слой цифровой модели рельефа отключите. Если инструмент GDAL не сработал, альтернативные инструменты для расчёта углов наклона можно найти в Панели инструментов: Slope, Aspect, Curvature (SAGA), r.slope.aspect (GRASS). В обоих случаях нужно снять отметки «Открыть выходной файл после исполнения алгоритма» для всех результатов, кроме крутизны склона (Slope). Остальные настройки задаются по аналогии или сохраняются по умолчанию. Скриншот 1: рассчитанный растр крутизны склона Изучите свойства рассчитанного набора данных. Обратите внимание, что геометрия полученного растра (число строк и столбцов, размер ячейки) полностью совпадает с геометрией исходной ЦМР. Для любознательных: если вы увеличите изображение до края полученного растра и одновременно включите обратно слой ЦМР, вам может показаться, что растр ЦМР «шире», чем растр крутизны. Это на самом деле не так: просто краевым ячейкам растра крутизны присвоены значения «нет данных». При желании можно этого избежать, включив опцию «Обрабатывать краевые ячейки» в настройках инструмента расчёта крутизны. Далее мы получим ещё несколько растровых наборов данных, но уже не на основе ЦМР. Однако нам придётся следить, чтобы все растры имели одинаковую геометрию. В некоторых программных продуктах (GRASS, SAGA) это требование соблюдается автоматически, в других (ArcGIS) можно заранее задать необходимые настройки. QGIS в настоящее время не поддерживает такие опции на уровне проекта, поэтому геометрию растра придётся задавать каждый раз заново. Закройте свойства слоя «Крутизна». 11.4 Расчет расстояний В начало упражнения ⇡ Чтобы определить участки, наиболее подходящие с точки зрения транспортной доступности, можно построить растр, в каждой ячейке которого будет содержится расстояние (евклидово) от центра этой ячейки до ближайшей дороги. Такое представление имитирует непрерывное поле расстояний. 11.4.1 Расстояния до дорог Добавьте на карту слой дорог Roads из базы геоданных Satino. Изучите таблицу атрибутов слоя. Вопрос 2: как соотносятся записи в поле Type и поле Description? Какие значения поля Type имеют асфальтированные и просёлочные дороги? Для того, чтобы построить растр расстояний, мы сначала конвертируем данные о дорогах в растровое представление Конвертируйте слой дорог в растр. Для этого запустите инструмент «Растр» — «Преобразование» — «Растеризация (вектор в растр)…». Настройте параметры инструмента, как описано ниже: Исходный набор данных: Roads; Поле, содержащее значение для затемнения: Type. Название опции некорректно переведено на русский язык — на самом деле здесь задаётся столбец таблицы атрибутов, значения из которого будут записаны в результирующий растр. Большинство растровых форматов не поддерживают запись строковых переменных в ячейки растра, поэтому система позволяет использовать только атрибуты «числовых» типов. Единицы измерения выходного растра: единицы, используемые при геопривязке; Ширина/горизонтальное разрешение: 5; Высота/вертикальное разрешение: 5; Целевой охват: нажмите на многоточие справа, выберите опцию «Использовать охват слоя…» и используйте охват слоя DEM; Целевой растр: сохраните растр под названием roads.tif в папку processing; Интерфейс настройки инструмента примет вид, как показано на рисунке ниже Важное замечание: настройки c — f в списке выше отвечают за геометрию растра. Мы задали их таким образом, чтобы конфигурация создаваемого растра соответствовала тем растрам, которые уже есть в проекте. Результат работы инструмента растеризации: Альтернативный инструмент: Rasterize (SAGA). Нужно установить целочисленный тип выходных данных. Перед запуском инструмента рекомендуется сделать выборку в исходном векторном слое, для этого изучите следующий пункт инструкции. Рассчитайте евклидово расстояние до дорог. Для этого запустите инструмент «Растр» — «Анализ» — «Близость (расстояния в растре)…». Настройте инструмент следующим образом: Исходный слой: растровый слой дорог; Список значений пикселов в исходном изображении…: перечислите через запятую те значения, которые соответствуют асфальтированным и просёлочным дорогам. Единицы расстояния: координаты геопривязки Остальные параметры оставьте по умолчанию. Сохраните результат в папку processing под именем distance_to_roads.tif. Убедитесь, что включена настройка добавления результата в проект после окончания расчёта. Альтернативный инструмент: Proximity (SAGA), r.grow.distance (GRASS). Эти инструменты не умеют применять условие для выборки значений из исходного растра, поэтому вернитесь на предыдущий шаг и осуществите выборку в векторном слое перед его растеризацией. Когда слой добавится в проект, переименуйте его в «Расстояние до дорог». Измените символику слоя: Стиль: одноканальное псевдоцветное» Минимальное значение: 0 Максимальное значение: 2500 Тип интерполяции: дискретная Градиент: Magma (после установки градиента нажмите на него правой кнопкой мыши и используйте опцию «Инвертировать градиент») Мода: «равные интервалы» Число классов: 25 В некоторых версиях QGIS может потребоваться нажать кнопку «Классифицировать», чтобы применить заданные настройки. Итоговый результат должен выглядеть как послойная окраска изолиний. В случае затруднений с настройкой символики обратитесь к преподавателю. Разместите растровый слой дорог над слоем расстояний до дорог. Сделайте скриншот окна QGIS. Скриншот 2: рассчитанный растр расстояний до дорог 11.4.2 Водотоки Отключите все слои. Добавьте на карту слой «площадных» объектов гидрографии WaterPolygon из базы геоданных Satino. Выберите (любым способом) объекты, соответствующие р. Протве и р. Исьме. Растеризуйте выбранные объекты. Самостоятельно установите настройки инструмента растеризации таким образом, чтобы использовать только выделенные объекты. Ячейкам растра, соответствующим объектам гидрографии, должно быть присвоено фиксированное значение 1 (атрибутивные поля не используются). Кроме того, геометрия получаемого растра должна быть аналогична всем остальным растрам в проекте. Сохраните растр в папку processing под именем water.tif. Примечание: в некоторых версиях QGIS после активации опции «Только выделенные объекты» выдаётся сообщение об ошибке, как на рисунке ниже. Сообщение об ошибке можно игнорировать. Результат будет выглядеть, как показано на рисунке: Рассчитайте евклидово расстояние до водотоков аналогично тому, как вы рассчитывали евклидово расстояние до дорог. Назовите выходной файл distance_to_water.tif. Когда новый слой добавится в проект, переименуйте его в «Расстояние до водотоков». Скопируйте символику из слоя «Расстояние до дорог» (контекстное меню слоя — «Стили» — «Копировать стиль») в слой «Расстояние до водотоков» (контекстное меню слоя — «Стили» — «Вставить стиль»). Расположите векторный слой объектов гидрографии над растром расстояния до водотоков и отключите все остальные слои. Сделайте скриншот окна QGIS Скриншот 3: рассчитанный растр расстояний до водотоков 11.5 Переклассификация наборов данных В начало упражнения ⇡ Мы подготовили три набора данных, характеризующих различные критерии пригодности участков для строительства. Два их них измеряются в метрах, ещё один — в градусах. Для того, чтобы иметь возможность сопоставлять величины, измеренные в разных единицах, можно использовать нормирование или перейти от точных значений к баллам благоприятности. В последнем случае говорят о переклассификации числового ряда. Мы определим балльную оценку на основе имеющихся значений растров. В большинстве программных средств ГИС существуют специальные инструменты для переклассификации значений растров. Они называются Reclass, Reclassify или другим аналогичным образом. Есть такой инструмент и в QGIS, однако сейчас мы воспользуемся не им, а Калькулятором растров. Это инструмент, который позволяет применять алгебраические выражения к значениям исходных растров и получать производные растры с рассчитанными значениями. 11.5.1 Переклассификация растров расстояний Для переклассификации растров расстояний до дорог и расстояний до водотоков мы воспользуемся функцией Калькулятора растров. Калькулятор растров позволяет применять к ячейкам растра алгебраические выражения и простые условные операторы; результат вычислений записывается в новый растр. В QGIS доступно несколько инструментов, выполняющих функцию калькулятора растров. Один из них разработан непосредственно в рамках QGIS, остальные заимствуются из другого программного обеспечения (GDAL, GRASS, SAGA). Мы воспользуемся калькулятором растров GDAL. Откройте панель инструментов анализа, если она не открыта. Это можно сделать при помощи комбинации клавиш Ctrl+Alt+T, из контекстного меню панелей инструментов или через меню «Анализ данных» — «Панели инструментов» В панели инструментов найдите группу инструментов GDAL, а в ней — подгруппу Raster Miscellaneous. Запустите инструмент «Калькулятор растров» из этой группы. Выберите в качестве исходного слоя A «Расстояние до дорог». Исходные слои B, C, D, E, F не задавайте. В поле «Вычисление…» введите формулу: 10 - A/100 Здесь A — значение в ячейке растра. 10 — максимальное количество баллов, при удалении от дорог на каждые 100 м число баллов будет уменьшаться на 1. В поле «Тип целевого растра» установите значение Byte. Это округлит результат расчёта до целых чисел. Примечание: «байтовый» тип выходных данных означает, что одно значение ячейки записывается одним байтом. Следовательно, область допустимых значений для такого растра составляет [0, 255]. Укажите, что целевой растр должен быть сохранён в папку processing под именем distance_to_roads_classes.tif Дождитесь, пока созданный файл добавится в проект. Переименуйте его в «Расстояния до дорог (классы). В качестве альтернативного инструмента на этом этапе следует воспользоваться Raster Calculator (SAGA). Введите формулу ifelse((10 - g1 / 100) &gt; 0, (10 - g1 / 100), 0) и установите тип данных беззнаковый целочисленный 2-байтовый (Unsigned 2 byte integer). Аналогичным образом переклассифицируйте расстояния до водотоков. Назовите выходной файл distance_to_water_classes.tif, а слой в QGIS — «Расстояния до водотоков (классы)». 11.5.2 Переклассификация растра крутизны Для оценки пригодности мы заменим точные значения крутизны склона (в градусах) на баллы благоприятности по 10-балльной шкале, где 10 — наивысшая благоприятность, 0 — минимальная благоприятность. Старые значения, ° Новые значения 0-3 9 3-6 10 6-9 8 9-18 6 &gt;18 NoData Примечание: при значениях крутизны больше 18° строительство, как правило, сопряжено с решением нетривиальных инженерных задач. При переклассификации мы не будем определять новых значений для ячеек с крутизной более 18°. Впоследствии, при суммировании балльных оценок, это приведёт к тому, что соответствующие ячейки получат значение NoData независимо от того, какие значения будут записаны в других слагаемых. Для переклассификации крутизны склона мы воспользуемся инструментом QGIS, который называется Reclassify by Table. Это основной инструмент для переклассификации растров, хотя по функционалу он уступает аналогам из проприетарного ПО. Найдите этот инструмент в панели инструментов через поиск или в группе «Растр» — «Анализ» Запустите инструмент Reclassify by Table. Установите растр крутизны в качестве исходного набора данных Нажмите на многоточие в опции Reclassification table (таблица переклассификации). В открывшейся таблице нажмите Add Row четыре раза, чтобы добавить четыре строчки. Введите значения из таблицы выше для каждого ранга, кроме NoData. Результат должен получиться таким же, как на рисунке ниже: Примечание 1: значение -9999 в последней строчке — это зарезервированное значение, маркирующее отсутствие данных (NoData) в целочисленных растрах. Задайте для выходного слоя имя slope_classes.tif. Когда слой добавится в проект, переименуйте его в «Крутизна (классы)» Измените стиль отображения слоя на Paletted/Unique values (отображение по уникальным значениям) и задайте шкалу RdYlGr. Нажмите «Классифицровать, чтобы добавить значения растра в таблицу уникальных значений, и «ОК», чтобы закрыть свойства слоя, применив изменения. Скриншот 4: классифицированный растр углов наклона Вопрос 3: почему на получившемся растре есть «белые пятна»? Какие значения присвоены этим ячейкам? 11.5.3 Преобразование слоя типов землепользования в растровое представление В начало упражнения ⇡ Мы успешно создали балльные оценки для следующих факторов: рельефа, транспортной доступности, доступности водных объектов. Ещё один фактор, влияющий на выбор места под строительство — существующий режим землепользования. Сведения о землепользовании имеются в базе данных ГИС «Сатино» в виде векторного полигонального набора данных, содержащего качественную классификацию типов землепользования. Мы создадим балльную оценку на основе этой классификации, а затем конвертируем вектор в растр. Отключите все слои. Добавьте в проект набор данных о землепользовании (LandUse) из базы данных Satino.gdb. Изучите таблицу атрибутов добавленного слоя. Информация о землепользовании записана в поле Land_Type. Информация о типах землепользования представлена в виде качественной характеристики («леса», «пашни», «фермерские хозяйства» и т.п.). Для анализа нам необходимо создать балльную оценку на основе этой характеристики. Небольшая техническая сложность заключается в том, что исходный набор данных записан в базу геоданных ESRI, а QGIS не умеет редактировать такие наборы данных, он способен только читать их. Мы воспользуемся функцией «виртуального поля» в QGIS, чтобы присвоить балльную оценку, а затем конвертировать вектор в растр. Виртуально поле в QGIS — это динамическая структура данных, создаваемая на основе выражения калькулятора полей. Виртуальное поле не помещается в таблицу атрибутов и хранится на уровне проекта QGIS. При удалении проекта виртуальные поля слоя будут потеряны. В таблице атрибутов слоя LandUse откройте калькулятор полей. Задайте для нового слоя имя LT_rank, тип — целочисленный (Integer). Нам предстоит переклассифицировать значения из поля Land_Type в баллы. Для этого мы воспользуемся функцией CASE, которая позволяет присваивать новые значения в соответствии с условиями, причём условий может быть множество. Разверните группу функций «Условные» в средней форме и дважды щёлкните по названию функции CASE. В конструктор формул добавится следующая строка: CASE WHEN condition THEN result END Это образец синтаксиса функции. Вместо condition подставляется условие, вместо result — результат вычисления. Инструкция CASE открывает блок условия, инструкция END закрывает его. Можно вынести эти инструкции в отдельные строки, а промежуточную часть скопировать и вставить несколько раз. CASE WHEN condition THEN result WHEN condition THEN result WHEN condition THEN result WHEN condition THEN result WHEN condition THEN result END Теперь будем заполнять выражение нужными значениями. Самым благоприятным типом участка с точки зрения землепользования являются выгоны. Меняем первую строчку с условием по следующему образцу: WHEN \"Land_Type\" = 'Выгоны' THEN 10 Леса и территории населённых пунктов относительно малопригодны для размещения новой строительной площадки, им будет присвоен балл 3. WHEN \"Land_Type\" = 'Леса' OR \"Land_Type\" = 'Территории населенных пунктов' THEN 3 По такому же принципу создайте условия для переклассификации остальных значений в соответствии с таблицей ниже: Тип землепользования Баллы благоприятности Вырубки 2 Гидрологические объекты 0 Дороги и тропы 1 Заболоченные земли 0 Лесные поляны 5 Луга 8 Нет данных 0 Пашни 4 Сады 2 Фермерские хозяйства 2 Примечание: для типов с нулевыми баллами можно не делать отдельные условия. Вместо этого в качестве предпоследней инструкции, перед END, можно вписать ELSE 0. Она означает, что во всех остальных случаях, не покрываемых перечисленными ранее условиями, полю будет присвоено значение 0. Запустите расчёт. Изучите таблицу атрибутов после окончания расчёта — в ней должен появиться новый столбец. К сожалению, инструменты растеризации, доступные в QGIS, не умеют работать с виртуальными полями, поэтому мы сохраним полученный набор данных в более простой формат — шейп-файл Закройте таблицу атрибутов. В панели слоёв щёлкните правой кнопкой мыши на слое LandUse и выберите опцию «Экспорт» — «Сохранить объекты как…». Сохраните слой в формате ESRI Shapefile под именем Land_Type_Rank в папку processing. Когда новый набор добавится в проект, старый слой можно будет удалить. Преобразуйте векторный набор данных в растровый так же, как вы делали это ранее в этом упражнении. Укажите, что в результирующий растр должны быть записаны значения поля LT_Rank. Проследите также, чтобы значение NODATA, присвоенное результирующему слою, было равно 0 — это позволит нам исключить из рассмотрения участки, имеющие нулевой балл благоприятности по землепользованию (аналогично тому, как мы поступили с крутыми склонами). Вопрос 4: какие настройки геометрии растра вы введёте для преобразования векторного представления типов землепользования в растровое? Почему? Сохраните целевой файл под именем landuse_classes.tif. Когда он добавится в проект, переименуйте слой в «Землепользование (классы)». Обратите внимание, что из-под полученного растра «просвечивает» исходный векторный набор данных. Те контура, значение балла благоприятности для которых было равно нулю, на результирующем растре интерпретированы как пустые ячейки («нет данных»). 11.6 Нахождение мест с наилучшей комбинацией факторов с помощью взвешенного оверлея В начало упражнения ⇡ Наилучшие участки соответствуют территориям, где сумма баллов по всем факторам максимальна. Соединение значений (в том числе и сложение) по нескольким слоям, располагающимся друг над другом, осуществляется с помощью растрового оверлея. Растровый оверлей реализуется с помощью различных инструментов. Мы воспользуемся калькулятором растров GDAL, которым вы уже пользовались ранее в этом упражнении. Запустите Калькулятор растров из наборов инструментов GDAL Задайте исходные растры: A: Классы крутизны B: Классы расстояний до дорог C: Классы расстояний до водотоков D: Классы благоприятности по землепользованию Для каждого растра укажите канал, из которого будут браться значения для расчёта. Во всех случаях это первый канал (Gray). Задайте формулу для выполнения взвешенного оверлея. Формула будет иметь вид \\[\\sum_{i=1}^n A_i \\cdot w_i,\\] где \\(A_i\\) — фактор, а \\(w_i\\) — весовой коэффициент. В качестве факторов используются значения классифицированных растров. Веса задаются таким образом, чтобы их сумма была равна \\(1\\). Задайте веса в соответствии с таблицей: Фактор Вес Крутизна склона 0,15 Расстояние до дорог 0,35 Расстояние до водотоков 0,20 Землепользование 0,30 Вопрос 5: скопируйте получившуюся формулу и вставьте её в отчётный файл. Задайте байтовый тип выходного растра. Это приведёт к округлению результирующих значений до целых чисел. Укажите, что растр следует сохранять в папку processing под именем overlay, и запустите расчёт. Когда результирующий растр будет добавлен в таблицу слоёв, назовите его «Комбинация факторов». Изучите полученный растр. Если необходимо, измените настройки его визуализации. Вопрос 6: какие значения могут принимать ячейки полученного растра? Каково происхождение «белых пятен» на этом растре? 11.7 Окончательный выбор участка В начало упражнения ⇡ В качестве потенциальных мест на размещение площадки следует выбрать 10-балльные участки. При этом необходимо выбрать участки, площадь которых превышает 2,5 га. Для применения этого критерия удобнее представить результат взвешенного оверлея в виде векторного полигонального набора данных. Преобразуйте растр комбинации факторов в векторное представление. Для этого используйте инструмент «Растр» — «Преобразование» — «Создание полигонов (растр в вектор)…». Этот инструмент объединит смежные ячейки растра с одинаковыми значениями в единый полигон. Значение растра будет сохранено в поле с названием, которое вы указываете в инструмента. Запишите векторный набор данных в новый GeoPackage, назвав файл по шаблону %Фамилия%_%№упражнения%.gpkg, а слой в нём — parcels. Рассчитайте площади полученных полигонов. Выберите на карте все участки с благоприятностью 10 баллов и площадью более 2,5 га. Поздравляем! Выбранные участки являются результатом вашего анализа. Сохраните выбранные участки в отдельный слой того же GeoPackage. Представьте результат анализа в виде схемы. Для этого воспользуйтесь возможностями подключаемого модуля QuickMapServices (см. упражнение 3). Используйте любую из карт на основе OpenStreetMap в качестве географической основы. Самостоятельно выберите условные знаки, скомпонуйте и экспортируйте макет карты. Размер итогового изображения должен быть таким, чтобы его можно было вставить в отчётный документ без искажений. Вставьте экспортированное изображение в отчётный файл. Дополнительный вопрос для картографов. Это упражнение основано на аналогичном упражнении для ArcGIS. Сравните обе инструкции и ответьте, какие возможности обработки и анализа растровых данных отсутствуют в QGIS по сравнению с ArcGIS. "],["hydrodem.html", "Упражнение 12 Гидрологическое моделирование на основе ЦМР 12.1 Введение 12.2 Получение и подготовка исходных данных 12.3 Гидрологическая коррекция ЦМР 12.4 Расчёт водосборной площади 12.5 Создание растра водотоков на основе модели водосборной площади 12.6 Определение границ бассейна р. Оскол 12.7 Картографическое представление результата", " Упражнение 12 Гидрологическое моделирование на основе ЦМР Архив с исходными данными Контрольный лист 12.1 Введение Цель задания — научиться на основе цифровой модели рельефа выделять водотоки и их водосборные бассейны в автоматическом режиме. Осуществлять расчет статистики по высотам в рамках выделенных бассейнов Необходимая теоретическая подготовка: Растровая модель пространственных данных, цифровые модели рельефа (ЦМР) и их типы, построение ЦМР, построение производных поверхностей (углы наклона, водосборная площадь), гидрологическое моделирование с использованием ЦМР и его принципы. Необходимая практическая подготовка: Знание основных компонент интерфейса QGIS (менеджер источников данных, таблица слоёв, фрейм карты, менеджер компоновок). Работа с различными форматами источников пространственных данных. Настройка символики и подписей объектов. Владение базовыми ГИС-технологиями. Создание компоновки карты: название, легенда, масштаб, градусная сетка. Исходные данные: приблизительный контур бассейна Северского Донца, тайлы глобальной ЦММ SRTM (загружаются в процессе выполнения упражнения) Результат: Карта водотоков и их водосборных бассейнов, построенная по ЦМР, с указанием морфометрических параметров бассейнов. 12.1.1 Контрольный лист Получить тайлы SRTM с ресурса EarthExplorer Создать виртуальный растр Выполнить перепроецирование ЦМР Рассчитать направления стока Рассчитать водосборную площадь Построить границы бассейна Визуализировать результаты расчёта 12.1.2 Аннотация Цифровые модели рельефа играют важную роль в гидрологическом и геоморфологическом анализе. Одно из основных приложений ЦМР, позволивших значительно упростить анализ речных систем, — это автоматизированное построение водосборов и расчет их морфометрических характеристик. Большинство современных программных средств ГИС включают те или иные реализации инструментов гидрологического моделирования на основе ЦМР. QGIS в этом смысле является исключением: у него нет собственных инструментов анализа такого рода, но есть возможность использовать наработки других программных продуктов — например, GRASS и SAGA. В этом упражнении вы используете инструменты SAGA посредством интерфейса QGIS, чтобы выполнить гидрологический анализ цифровой модели рельефа, а затем визуализируете полученный результат в виде блок-диаграммы (3D-изображения). 12.2 Получение и подготовка исходных данных В начало упражнения ⇡ Зарегистрируйтесь на ресурсе EarthExplorer Геологической службы США. Этот ресурс предоставляет доступ к массиву данных дистанционного зондирования и наборов данных, созданных на их основе. В левой части окна на вкладке Search Critera откройте вкладку KML/Shapefile upload и используйте файл oskol.kml из архива с исходными данными, чтобы указать область поиска материалов. Или самостоятельно установите рамку поиска аналогично изображению на рисунке ниже Перейдите на вкладку Data Sets и выберите набор Digital Elevation – SRTM – SRTM 1-arc second global Перейдите на вкладку Results и дождитесь, пока система выполнит запрос по заданным вами условиям. В результате запроса должно быть выдано 6 результатов — тайлов SRTM. Поочерёдно нажимая на кнопку «Скачать» каждой записи, загрузите все 6 необходимых тайлов в формате GeoTIFF. Создайте в своей рабочей директории папку input_data и поместите загруженные тайлы в неё. Также создайте в рабочей директории папку processing, чтобы в дальнейшем сохранять в неё промежуточные наборы данных. Примечание: при загрузке отдельных файлов EarthExplorer может ограничить число скачиваемых файлов и/или скорость загрузки. Если это происходит, дождитесь загрузки тех файлов, которые уже скачиваются, а затем повторите попытку. Запустите QGIS и сохраните проект в вашу рабочую директорию. Чтобы работать с цифровой моделью рельефа, необходимо объединить все тайлы в единую мозаику, а затем перепроецировать её из географической системы координат в проецированную. Создание мозаики, перепроектирование, а также обрезка по маске, которую мы применим чуть позже — типичные процедуры подготовки растровых тайлов к геоинформационному анализу. Хранить каждый промежуточный результат в виде отдельного файла, как правило, нет необходимости, а при больших объёмах данных и малых объёмах свободного места на диске — нет и возможности. На помощь здесь приходит виртуальный растр (VRT) — структура, хранящая ссылки на исходные данные и необходимые операции их преобразования. Соберите мозаику растровых тайлов. Для этого воспользуйтесь инструментом «Создать виртуальный растр» («Растр» — «Прочее»). Добавьте тайлы SRTM в качестве исходных данных Если установлена опция Place each input file into a separate band, отключите её. Укажите, что виртуальный растр должен быть сохранён в папку processing под именем srtm_mosaic Результат будет автоматически добавлен в проект Измените проекцию документа карты на UTM, датум WGS-84. Самостоятельно определите номер зоны и выберите нужную систему координат (СК). Вопрос 1: укажите EPSG-код выбранной системы координат Скриншот 1: окно QGIS после изменения системы координат Из упражнения 1 мы помним, что QGIS умеет перепроецировать наборы данных на лету. Однако для целей морфометрического анализа ЦМР нам необходимо, чтобы набор данных был «физически» сохранён с использованием проецированной системы координат. Используйте инструмент «Деформация (перепроецирование…)» («Растр» — «Проекции»), чтобы конвертировать вашу мозаику в новый набор данных. Укажите исходную и целевую систему координат (целевая СК должна совпадать с СК проекта), установите кубический метод интерполяции и значение «нет данных», равное \\(-9999\\). Сохраните перепроецированный растр под именем DEM (от англ. Digital Elevation Model) в папку processing, формат файла — GeoTIFF. Когда перепроецированный растр добавится в проект, удалите из него «старую» мозаику. 12.3 Гидрологическая коррекция ЦМР В начало упражнения ⇡ Гидрологическое моделирование с использованием ЦМР основывается на следующей идее: моделируемая вода стекает из ячейки с большей высотой в соседнюю ячейку с меньшей высотой. Трассируя поток вниз по склону, можно связывать ячейки ЦМР в так называемые “сети потока” (drainage networks) и определять водосборные площади и границы бассейнов. Если на модели есть замкнутые локальные понижения, то они выступают как препятствие для распространения стока. Распространённая практика — удалять замкнутые локальные понижения с ЦМР перед началом собственно гидрологического моделирования. Удалить повышения можно путём увеличения высот внутри них — таким образом понижение либо исчезает, либо перестаёт быть замкнутым. Найдите инструмент Fill Sinks XXL (Wang &amp; Liu) через поиск в панели инструментов. Этот инструмент преобразует ЦМР таким образом, что на месте замкнутых понижений будет сформирована наклонная поверхность. Угол наклона задаётся пользователем. Примените этот инструмент к набору DEM с углом наклона 0,01°. Результат сохраните в рабочую директорию под именем DEM_filled, расширение оставьте таким, какое предлагается по умолчанию (*.sdat). SAGA GRID — нативный растровый формат SAGA. Он состоит как минимум из двух файлов: заголовка (*.sgrd) и файла с данными (*.sdat). Часто к ним добавляется файл с описанием системы координат (*.prj). Наконец, если набор был создан непосредственно в SAGA (или, что то же самое, в QGIS), он будет сопровождаться файлом *.mgrd, в котором записывается история применения инструментов геообработки. Примечание: если в вашей версии QGIS появляется сообщение Версия SAGA 7.8.2 официально не поддерживается - алгоритмы могут вызвать ошибки, игнорируйте его. Инструмент Fill Sinks XXL (Wang &amp; Liu) будет работать без проблем. Сделайте снимок экрана. Скриншот 2: окно QGIS после заполнения локальных понижений на ЦМР Сравните исходную и скорректированную ЦМР. Вопрос 2: Как изменилась амплитуда высот ЦМР после заполнения замкнутых локальных понижений? Какие формы рельефа изменились наиболее сильно? 12.4 Расчёт водосборной площади В начало упражнения ⇡ Водосборная площадь (англ. catchment area) в геоморфометрии определяется для каждой точки поверхности так, как если бы точка была замыкающим створом. В регулярно-сеточном анализе водосборная площадь определяется для отдельных ячеек ЦМР и равняется суммарной площади всех ячеек, сток из которых проходит через данную ячейку (по принципу, описанному выше). Вместо площадей ячеек можно использовать какой-нибудь весовой коэффициент. Например, если этот коэффициент представляет слой поверхностного стока, то результирующая величина будет являться объёмом стока для данной ячейки. Водосборную площадь вместе со всеми другими величинами, которые можно рассчитать по аналогичному принципу, часто называют аккумуляцией потока (англ. flow accumulation). Именно так называются инструменты расчёта водосборной площади в большинстве современных ГИС-пакетов (в том числе в SAGA). Найдите инструмент Flow Accumulation (Top-Down) (для старых версий QGIS и SAGA: Catchment Area) в панели инструментов. Запустите его, используя следующие настройки: Исходное поле высот (Elevation): DEM_filled Метод расчёта (Method): Deterministic 8 Выходной растр водосборной площади (Flow Accumulation): сохраните в рабочую директорию и назовите его flowacc. Оставьте включённой опцию «Открыть выходной файл после завершения алгоритма». Все прочие выходные растры: оставьте поля пустыми и отключите опции «Открыть выходной файл после завершения алгоритма». Остальные параметры оставьте по умолчанию. Запустите расчёт и дождитесь его завершения (может занимать до 7-8 минут). По окончании расчётов в проект QGIS будет добавлен новый растровый слой: Водосборная площадь при движении вниз по склону увеличивается экспоненциально, поэтому изображение в оттенках серого, которое вы видите, почти чёрное. Измените стиль отображения растра на «Одноканальное псевдоцветное», максимальное значение — 1e+07, и выберите шкалу Blues. Примените изменения. Перейдите на вкладку «Пирамиды» и постройте пирамидальные слои всех доступных разрешений для вашего набора данных. Для этого выберите в списке справа все доступные разрешения, установите в переключателе внизу метод передискретизации Гаусса и нажмите кнопку «Построение пирамид». Примените изменения. Пирамидальные слои, или пирамиды — это производные растры относительно низкого разрешения, создаваемые на основе исходного растра для улучшения производительности в процессе визуализации. Если используется мелкий масштаб карты, ГИС-пакет отрисовывает не исходный растр, а один из пирамидальных слоёв. Если после построения пирамид на экране не произойдёт никаких изменений, перезагрузите проект QGIS. Изучите полученное изображение, увеличивая и уменьшая масштаб визуализации. Добавьте в проект мозаику спутниковых снимков из Интернета. Оцените, в какой мере области высоких значений водосборной площади соответствуют положениям водотоков и крупных эрозионных форм. Сделайте снимок экрана. Скриншот 3: растр водосборной площади после настройки визуализации Вопрос 3: Можно ли сказать, что области высоких значений водосборной площади, рассчитанной по ЦМР, соответствуют тальвегам эрозионных форм и руслам рек? Ответ обоснуйте. 12.5 Создание растра водотоков на основе модели водосборной площади В начало упражнения ⇡ Растр водосборной площади (или объёма стока) позволяет выделить сеть потенциальных водотоков. Ячейка считается принадлежащей к сети потенциальных водотоков, если величина водосборной площади в ней превышает некоторый заданный порог. Это упрощённый принцип, но он позволяет строить сети, подобные реальным. Для выборки ячеек в QGIS можно воспользоваться уже знакомым вам инструментом переклассификации (см. Переклассификация наборов данных). Примем в рамках упражнения, что минимальная водосборная площадь, необходимая для формирования водотока, составляет 1 км². Запустите инструмент «Переклассификация по таблице». Переклассифицируйте растр flowacc таким образом, чтобы все значения, меньшие 1 км², получили новое значение \\(-9999\\) (нет данных), а все значения, большие или равные 1 км² — новое значение \\(1\\). Результат сохраните в вашу рабочую директорию под именем streams, формат — GeoTIFF. Откройте свойства растра водотоков и измените стиль отображения на «Палитра / Уникальные значения». Нажмите «Классифицировать», чтобы добавить в таблицу все возможные значения растра, а затем выберите и удалите все значения, кроме \\(1\\). Для значения \\(1\\) установите тёмно-синий цвет, как показано на рисунке ниже. Увеличьте изображение до масштаба 1:100 000 и сделайте снимок экрана. Скриншот 4: Фрагмент растра сети потенциальных водотоков 12.6 Определение границ бассейна р. Оскол В начало упражнения ⇡ Внимание! Инструменты, используемые в этой части упражнения, могут работать некорректно или не работать вовсе. Если вы сталкиваетесь с проблемами, переходите к следующему шагу упражнения. Для дальнейшего анализа нам будет нужна только территория водосборного бассейна р. Оскол. На этом шаге мы определим границы её бассейна. Добавьте на карту набор данных outlet.kml. Он отражает конечную точку модели водотока, соответствующей р. Оскол. Найдите и запустите инструмент Upslope Area из группы SAGA. Этот инструмент предназначен для идентификации всех ячеек, сток из которых проходит через точку с заданными координатами — фактически, он позволяет определить границы водосборного бассейна. Используйте инструмент определения , чтобы узнать координаты X и Y установленной точки. Задайте входные параметры инструмента Upslope Area. Скопируйте координаты X и Y в соответствующие поля. Установите DEM_filled в качестве исходной ЦМР и выберите метод D8. Остальные опции не задавайте. Результат сохраните в папку processing под именем oskol_basin. На полученном растре представлено всего два значения: \\(100\\) для ячеек, входящих в границы бассейна, и \\(0\\) для всех остальных ячеек. Векторизуйте полученный растр. Результат векторизации сохраните в папку processing под именем basin. Если необходимо, удалите из результата векторизации полигон, соответствующий областям за пределами бассейна р. Оскол. Также отключите растр границ бассейна. 12.7 Картографическое представление результата В начало упражнения ⇡ На этом этапе мы создадим трёхмерную визуализацию бассейна р. Оскол. Отобразите слои проекта в охвате слоя DEM. Если на предыдущем шаге упражнения вам не удалось построить границы бассейна, добавьте в проект набор basin.shp из папки с исходными данными. Этот шейп-файл содержит границу бассейна. Измените стиль отображения слоя границ бассейна: установите прозрачную заливку и красную обводку толщиной 0,46 мм Поместите слой устья реки (outlet) над слоем границы бассейна. Измените условный знак устья на маркер в виде красного круга размером 2 мм. Поместите под слоем границ бассейнов слой водосборной площади, а под ним — слой скорректированной ЦМР. Остальные слои отключите. Для слоя водосборной площади установите прозрачность 50 %. Измените настройки визуализации слоя ЦМР следующим образом: Стиль: одноканальное псевдоцветное Минимальное значение: 50 Максимальное значение: 275 Интерполяция: дискретная Шкала: нажмите правой кнопкой мыши на палитру, выберите «Создать новый градиент», тип градиента — «Каталог: cpt-city». В открывшемся интерфейсе в разделе Topography выберите палитру wiki-knutux. Режим классификации: равные интервалы Число классов: 9 После применения настроек изображение должно выглядеть, как показано на рисунке ниже: Для создания 3D-визуализации установите модуль Qgis2threejs. Этот модуль предназначен для создания трёхмерных визуализаций в QGIS на основе растровых и векторных пространственных данных — в первую очередь, цифровых моделей рельефа. Иконка модуля Qgis2treejs появится в панели инструментов. Нажмите на неё, чтобы открыть окно модуля. В окне модуля Qgis2threejs включите слой DEM_fill. Высоты из этого слоя будут использоваться для создания 3D-поверхности, а текстура (материал) изображения будет составлена на основе изображения в основном окне карты. Изображение в окне Qgis2threejs выглядит плоским. Для того, чтобы сделать его более «объёмным», можно увеличить вертикальный масштаб. Для этого зайдите в настройки сцены (Scene – Scene settings…) и установите коэффициент вертикального масштабирования (Z exaggeration) равным 25. Вращая (с помощью зажатой левой кнопки мыши), перемещая (правой кнопкой мыши) и масштабируя (колесо мыши) изображение в окне Qgis2threejs, подберите такой ракурс изображения, который позволит наиболее наглядно, на ваш взгляд, продемонстрировать рельеф местности. Экспортируйте полученное изображение (File – Save Scene As – Image (*.png) …) и вставьте его в отчётный файл. Изображение 5: трёхмерная визуализация бассейна р. Оскол "],["networks.html", "Упражнение 13 Анализ транспортных сетей 13.1 Введение 13.2 Добавление исходных данных 13.3 Выбор элементов дорожной сети 13.4 Построение маршрута 13.5 Расчёт изохрон 13.6 Работа с матрицей «источник-назначение»", " Упражнение 13 Анализ транспортных сетей Архив с исходными данными Контрольный лист 13.1 Введение Цель задания — научиться решать простые задачи сетевого анализа в ГИС Необходимая теоретическая подготовка: Понятие о сетевой модели данных, граф дорожной сети. Сетевой анализ и его основные задачи: поиск кратчайшего маршрута, определение границ зон обслуживания и ближайшего пункта обслуживания, размещение-распределение. Матрица источник-назначение. Необходимая практическая подготовка: Знание основных компонент интерфейса QGIS (менеджер источников данных, таблица слоёв, фрейм карты, менеджер макетов). Выделение объектов на карте. Пространственные и атрибутивные запросы. Исходные данные: наборы пространственных данных о дорожной сети, созданные на основе выгрузки с OpenStreetMap на территорию г. Рязань. Результат: Маршрут между двумя точками назначения. Схема изохрон относительно выбранных стартовых точек. Матрица источник-назначение для складов и точек продажи. Схема зонирования территории по принадлежности к складам. 13.1.1 Контрольный лист Добавить на карту слой дорожной сети, слой зданий и сооружений Выбрать из слоя дорожной сети объекты, подходящие для создания графа дорожной сети Построить маршрут между двумя точками Выполнить анализ дорожной сети для расчёта изохрон Рассчитать матрицу источник-назначение, определить ближайшие источники для каждого назначения Очертить зоны обслуживания 13.1.2 Аннотация Задание посвящено знакомству с сетевым анализом. Задачи, предлагаемые в задании, связаны с определением оптимальных маршрутов, построением зон обслуживания, определением ближайших сервисных точек, размещением сервисных точек. Данные задачи активно используются в логистике — оптимизации перевозок, а также в геомаркетинге и оптимизации местоположения пунктов обслуживания (магазинов, складов, пожарных депо и т.д.). В основе решения этих задач лежит сетевая модель данных, являющаяся частным случаем векторной модели. В сетевой модели дорожная сеть представляется в виде графа. 13.2 Добавление исходных данных В начало упражнения ⇡ Скопируйте материалы к упражнению (файл GeoPackage) в свою рабочую директорию Создайте проект QGIS и сохраните его в свою рабочую директорию Добавьте в проект слои RyazanRoadNetwork (улично-дорожная сеть) и RyazanBuildings (здания и сооружения). Оба этих слоя подготовлены на основе данных OpenStreetMap Задайте следующие настройки отображения слоёв: Улично-дорожная сеть — линии серого цвета (60 % светлоты) толщиной 0,26 мм; Здания и сооружения — полигоны серого цвета (80 % насыщенности) без обводки Задайте подписи слоёв. Для этого откройте свойства соответствующего слоя, перейдите на вкладку «Подписи» и измените стиль подписей с No labels на Single labels. Изучите доступные настройки подписей. Задайте следующие параметры подписей: Для слоя дорожной сети: подписи по полю Name, кегль (размер) шрифта — 8 типографских пунктов, остальные параметры по умолчанию; Для слоя зданий и сооружений: подписи по полю addr:housenumber, кегль (размер) шрифта — 6 типографских пунктов, остальные параметры по умолчанию. Примечание: в некоторых версиях QGIS в интерфейсе настройки подписей некорректно переведено название единиц измерения — вместо правильного «Пункты» написано «Точки». Как правило, эти единицы используются по умолчанию, поэтому даже в случае некорректного перевода у вас не должно возникнуть проблем. Увеличьте масштаб изображения до 1:5000 и сделайте снимок экрана. Изображение фрейма карты должно быть похож на изображение ниже. Снимок экрана №1. Окно QGIS после завершения настройки символов и подписей Вопрос 1: сколько объектов содержится в слое объектов улично-дорожной сети? 13.3 Выбор элементов дорожной сети В начало упражнения ⇡ В рамках этого упражнения мы будем решать задачи логистики на примере движения автомобилей. Однако набор данных об улично-дорожной сети, предоставленный вам в качестве исходных данных, содержит не только действующие автомобильные дороги, но и другие типы объектов. Тип объекта хранится в поле highway. В таблице ниже перечислены значения атрибута highway для тех объектов, которые не должны участвовать в анализе. Значения атрибута highway Пояснение construction строящиеся дороги cycleway велодорожки footway, pedestrian пешеходные дороги и тротуары path тропы proposed планируемые дороги raceway гоночные треки steps лестницы Составьте запрос, чтобы выбрать в слое RyazanRoadNetwork все объекты, кроме перечисленных выше. Это можно сделать разными способами: с использованием оператора &lt;&gt; (не равно) или оператора IN (содержит). Сохраните выборку в новый набор данных формата GeoPackage (правой кнопкой мыши на слой — «Экспорт…» — «Сохранить выбранные объекты как…»). Сохраните новый GeoPackage в вашу рабочую директорию и присвойте ему имя по шаблону RoadNetwork_%Фамилия%. Укажите, что слой необходимо добавить в проект после сохранения Когда новый слой будет добавлен к проекту, измените настройки его визуализации: установите толщину линий равной 0,26 мм, а цвет — любой, кроме того, который уже используется для улично-дорожной сети. Сделайте снимок экрана. Снимок экрана №2. Окно QGIS после сохранения выбранных дорог в отдельный набор 13.4 Построение маршрута В начало упражнения ⇡ Существует несколько подключаемых модулей для QGIS, которые позволяют решать задачи сетевого анализа. Мы воспользуемся одним из самых простых — модулем QNEAT3. В отличие от «продвинутых» программных продуктов, таких, как ArcGIS, большинство модулей для сетевого анализа в QGIS не требуют представления графа дорожной сети в виде отдельной сущности. Вместо этого такой граф создаётся непосредственно в процессе работы инструментов на основе векторного линейного набора объектов. Установите модуль QNEAT3. Откройте панель инструментов анализа и убедитесь, что в неё добавилась группа инструментов QNEAT3. Теперь мы попробуем построить маршрут между двумя точками. Для решения этой задачи используется инструмент Shortest path (point to point) из группы Routing набора QNEAT3 Найдите здание вокзала Рязань-1 (Вокзальная улица, 26А) и Музыкальный колледж (улица Дзержинского, 42). Запомните расположение этих зданий. Подсказка: названия зданий и их адреса могут быть указаны в таблице атрибутов. Запустите инструмент Shortest path (point to point). Откроется интерфейс настройки инструмента. В качестве слоя дорожной сети (Network Layer) укажите набор данных, который вы создали на предыдущем шаге. Чтобы указать начальную точку маршрута, нажмите многоточие справа от поля ввода Start point. Интерфейс настройки инструмента будет свёрнут, а курсор в окне QGIS примет вид мишени. Найдите здание вокзала Рязань-1 и щёлкните левой кнопкой мыши в произвольном месте внутри здания. Координаты курсора будут считаны и введены в поле Start point. Аналогичным образом укажите конечную точку маршрута в пределах здания музыкального колледжа. Проверьте, что в качестве критерия оптимизации указано Shortest Path (кратчайшее расстояние), а выходной набор данных сохраняется во временный файл. Запустите инструмент. Дождитесь, пока будет рассчитан кратчайший маршрут, и не закрывайте интерфейс инструмента — мы воспользуемся им снова, но изменим параметры. Построенный кратчайший маршрут появится в таблице слоёв как временный слой с названием Shortest Path Layer. Измените стиль этого слоя на линию красного цвета толщиной 1 мм. Отобразите карту в охвате слоя Shortest Path Layer. Обратите внимание, что при построении этого маршрута учитывались только длины сегментов пути, но не учитывались характерные скорости и разрешённые направления движения. На следующих шагах мы внесём соответствующие коррективы. Откройте таблицу атрибутов слоя дорожной сети и изучите её содержимое. Вопрос 1: какие характеристики дорожной сети записаны в таблице атрибутов? Вернитесь в интерфейс инструмента Shortest path (point to point) (напомним, что его не нужно было закрывать). Измените критерий оптимизации с кратчайшего пути на наиболее быстрый путь. В настройке Direction field укажите, в каком поле содержится информация о разрешённых направлениях движения. В следующих полях введите значения, соответствующие разрешённым направлениям: yes для движения только в прямом направлении, -1 для движения только в обратном направлении, no для разрешения движения в обоих направлениях. В настройке Speed field укажите, из какого поля следует взять разрешённую скорость движения. Примечание: обратите внимание, в каких единицах измеряется скорость в исходных данных и какие единицы требуются на вход модулю QNEAT. При необходимости воспользуйтесь калькулятором полей, чтобы преобразовать единицы измерения. Снова запустите расчёт пути. Дождитесь, пока инструмент завершит работу, и новый временный слой будет добавлен в проект. После этого окно инструмента можно закрыть. Переименуйте добавленный слой в Fastest Path Layer и измените его отображение на линию синего цвета толщиной 1 мм. Самостоятельно повторите расчёт маршрутов по кратчайшему расстоянию и скорейшему времени для одной из пар «источник-назначение», приведённых в таблице ниже. Сохраняйте построенные пути в «постоянные» наборы данных. № п/п Источник Адрес Назначение Адрес 1 ДК Станкозавода Октябрьская улица, 5 Соборная колокольня улица Кремль, 10 2 ДК Станкозавода Октябрьская улица, 5 Рязанский цирк Лево-Лыбедская улица, 34 3 ДК Станкозавода Октябрьская улица, 5 Вознесенский храм Вознесенская улица, 26А 4 ДК Станкозавода Октябрьская улица, 5 Рязанский городской центр детского творчества улица Есенина, 46 5 Рязань-1 Вокзальная улица, 26А Рязанский государственный радиотехничекий университет улица Гагарина, 59/1 6 Рязань-1 Вокзальная улица, 26А ТЦ “Полетаевский” улица Гагарина, 164 7 Муниципальный культурный центр Первомайский проспект, 68/2 Рязанский театр драмы Театральная площадь, 7 8 Муниципальный культурный центр Первомайский проспект, 68/2 Театр кукол улица Есенина, 27 9 Муниципальный культурный центр Первомайский проспект, 68/2 РИРО улица Урицкого, 2А 10 Муниципальный культурный центр Первомайский проспект, 68/2 НИИ газоразрядных приборов «Плазма» улица Циолковского, 17 Создайте карту-схему построенных путей с масштабной линейкой и легендой. Вставьте эту схему в отчётный файл Примечание: перед тем, как оформлять схему, отключите подписи номеров домов Изображение №3. Схема маршрутов 13.5 Расчёт изохрон В начало упражнения ⇡ Модуль QNEAT3 комбинирует собственные алгоритмы анализа и базовый функционал QGIS для создания представления расстояний (или времени достижения) от определённых точек в виде изохрон. Для этого вычисляется расстояние (или время движения) от стартовой точки до ближайших узлов графа дорожной сети, а затем выполняется линейная интерполяция вычисленной величины между узлами, в результате чего создаётся поверхность расстояния (времени достижения) в растровом представлении. На основе растра создаётся изолинейное представление — в виде изолиний либо в виде полигонов, представляющих послойную окраску. Эта задача решается с использованием библиотеки matplotlib. За расчёт изолиний отвечают инструменты группы Iso-Areas. Найдите на карте Автовокзал Центральный (Московское шоссе, 31). Мы будем рассчитывать время, которое затрачивается на проезд от этой точки на автотранспорте. Запустите инструмент Iso-Area as Interpolation (from Point). Используйте дорожную сеть, которую вы применяли на предыдущем шаге, и укажите здание автовокзала в качестве стартовой точки для расчёта изохрон. Размер области расчёта, или предельное расстояние/время, устанавливается либо в метрах, либо в секундах. Интерпретация величины зависит от того, какой критерий оптимизации был выбран. Установите в переменной Size of Iso-Area значение 900, а критерий оптимизации — по времени. В этом случае значение переменной будет прочитано как время в секундах. Размер ячейки целевого растра интерполяции — оставьте 10 м, как предлагается по умолчанию. Установите дополнительные настройки расчёта таким образом, чтобы при расчёте учитывались скорость и разрешённые направления движения: В поле Direction field нужно выбрать столбец таблицы атрибутов, в котором записаны кодированные значения направления движения; В опциях Value for forward direction, Value for backward direction и Value for both directions указать конкретные значения, которые кодируют соответствующее направление движения В поле Speed Field нужно выбрать столбец таблицы атрибутов, в котором указана скоросто движения по выбранному участку пути. Запустите расчёт. Дождитесь, пока растр времени достижения (временный набор данных) будет добавлен к проекту QGIS Переместите построенный растр на последнее место в списке слоёв. Измените настройки визуализации растра следующим образом Тип визуализации: одноканальное псевдоцветное; Минимум: 0 Максимум: 900 Интерполяция: дискретная Градиент: Magma, инвертировать градиент Число знаков после запятой в легенде (Label Precision): 0 Мода: равные интервалы Число классов: 15 Кроме того, задайте на вкладке «Прозрачность» значение 66 %. В результате окно QGIS будет выглядеть, как показано ниже Добавьте на карту слой складов (Warehouses) из базы RyazanNetworkData.gpkg. С помощью инструмента Iso-Area as Interpolation (from Layer) рассчитайте изохроны для движения от складов. Используйте параметры, аналогичные применённым ранее. Также укажите, что результат интерполяции должен быть сохранён в вашу рабочую директорию как файл TIFF. Когда файл будет создан и добавлен к проекту, примените к нему те же настройки визуализации, которые вы использовали для предыдущего аналогичного растра. Создайте карту-схему с масштабной линейкой и легендой на основе созданного слоя и вставьте её в отчётный файл. Изображение №4. Время достижения точек местности при движении от складов 13.6 Работа с матрицей «источник-назначение» В начало упражнения ⇡ При расчёте изохрон для каждой точки местности рассчитывается расстояние до «источника». При этом, если источников несколько, расстояние рассчитывается только до ближайшего из них, причём сам источник никак не идентифицируется. Однако расчёт кратчайших путей можно делать таким образом, что пути будут построены для каждой пары источник-назначение. Результат такого вычисления удобно представлять в виде матрицы: матрица «источник-назначение» отражает стоимость пути между каждой точкой-источником и каждой точкой-назначением. Под стоимостью здесь может пониматься любая величина, которую необходимо минимизировать: длина маршрута, продолжительность поездки, денежная стоимость. Если в задаче дано \\(M\\) точек-источников и \\(N\\) точек-назначений, то результирующая матрица будет иметь размер \\(M \\times N\\). В практике геоинформационного анализа такое представление по ряду причин не очень удобно, поэтому чаще применяют форму представления не в виде матрицы, а в виде списка из трёх столбцов, где в первом столбце указывается идентификатор источника, во втором — идентификатор назначения, в третьем — рассчитанная стоимость маршрута. Примечание: такой список в математике и анализе данных называется «вектор», а процедура трансформации матрицы в вектор — «векторизация». В геоинформатике оба этих термина имеют несколько другое значение. QNEAT3 позволяет создавать матрицы источник-назначение на основе одного или двух наборов точечных данных и представлять их в виде списка. Опционально строкам списка могут быть сопоставлены линейные векторные объекты, связывающие источник и назначение по прямой линии. Мы воспользуемся матрицей источник-назначение, чтобы определить источник, ближайший к каждой точке назначения и рассчитать границы «зоны обслуживания» (service area) для каждого источника. Для этого мы: Создадим точечный слой, представляющий пункты назначений; Построим матрицу источник-назначение в виде таблицы; Для каждой строки назначения определим путь с наименьшей стоимостью и выберем строку, соответствующую этому пути; Удалим все невыбранные строки; Присоединим матрицу источник-назначение к точечному слою пунктов назначений, таким образом “приписав” к каждому назначению идентификатор источника — иначе говоря, найдём ближайший пункт обслуживания (closest facility) для каждого пункта назначения; Построим диаграмму Вороного (полигоны Тиссена) на пунктах назначений; Объединим построенные полигоны по признаку. В качестве исходных точек мы возьмём известные положения складов, с которыми вы работали в предыдущей части упражнения. В качестве точек назначения мы будем использовать центры полигонов зданий и сооружений. Однако этот набор данных содержит почти 25 тыс. объектов — избыточно много для учебного упражнения. Поэтому сначала мы уменьшим это количество путём случайной выборки. Прежде, чем вы приступите к этой части упражнения: все инструменты, указанные ниже, по умолчанию сохраняют выходные данные как временные файлы. Временные файлы удаляются после закрытия проекта QGIS, поэтому, если вы планируете надолго прерваться при выполнении упражнения, при запуске каждого инструмента явно указывайте, куда и в каком виде следует сохранить результирующий набор данных. Это требование не будет упоминаться далее в инструкции. Создайте случайную выборку объектов в слое зданий и сооружений. Для этого воспользуйтесь инструментом «Вектор» — «Выбор» — «Выбрать случайно…». Выберите в слое RyazanBuildings от 500 до 1500 объектов, согласно указаниям преподавателя, и закройте интерфейс инструмента. Рассчитайте положения центральных точек (центроидов) для выбранных объектов. Для этого воспользуйтесь инструментом «Вектор» — «Обработка геометрии» — «Центроиды…». Создайте центроиды только для выбранных объектов, при этом игнорируйте составную геометрию (не создавайте отдельный центроид для каждой части полигона). Рассчитайте матрицу источник-назначение при помощи инструмента OD Matrix from Layers as Table (m:n). Самостоятельно укажите, какой слой должен использоваться в качестве источника, а какой — в качестве назначения. Уникальными идентификаторами в обоих случаях лучше назначить поле fid. Настройки поиска оптимальных маршрутов установите следующим образом: искать самый быстрый маршрут с учётом направления движения (вы уже неоднократно устанавливали такие настройки). Подождите, пока инструмент рассчитает матрицу — на это потребуется несколько минут, в зависимости от мощности компьютера. Откройте рассчитанную матрицу источник-назначение как таблицу атрибутов. Обратите внимание, что в каждой строке этой таблицы указан идентификатор источника, идентификатор назначения и несколько характеристик стоимости пути. Нас интересует последняя из них — полная стоимость, total_cost. Вопрос 3: сколько всего записей в открывшейся таблице? Почему их именно столько? Теперь вам нужно выбрать в этой таблице строки, соответствующие минимальным расстояниям для каждого пункта назначения. Для этого откройте интерфейс выборки по условию и введите следующее выражение: \"total_cost\" = minimum(\"total_cost\", \"destination_id\") Это выражение устроено следующим образом. Функция minimum ищет минимальное значение в столбце, указанном в качестве первого её аргумента. Второй аргумент используется как критерий группировки: в данном случае он указывает, что нужно искать не единое минимальное значение по всему столбцу, а сгруппировать минимальные значения, соответствующие разным идентификаторам пунктов назначений. Как мы помним, логическое выражение в целом применяется только к текущей строке таблицы атрибутов, поэтому функция minimum выдаст то минимальное значение, которое найдено для группы строк с тем же значением destination_id, что и у текущей строки. Соответственно, логическое выражение в целом будет истинным для строк с минимальной стоимостью проезда для данного пункта назначения и ложным для всех остальных строк того же пункта. Нажмите кнопку «Выбрать объекты» и подождите несколько минут, пока QGIS реализует введённый запрос. Вопрос 4: сколько всего записей было выбрано? Почему именно столько? Включите режим редактирования для таблицы Инвертируйте выборку. Для этого нажмите кнопку «Инвертировать выделение» или Ctrl+R на клавиатуре. Таким образом вы выделите те записи, где время достижения не является минимальным для данных точек назначения. Удалите выбранные строки, сохраните правки и выключите режим редактирования. Примечание: после этой операции в таблице должно остаться столько строк, сколько было исходных центроидов. Если у вас другое количество строк, удалите таблицу и выполните заново часть инструкции, начиная с расчёта матрицы источник-назначение. Теперь мы должны соединить то, что осталось от матрицы источник-назначение, с исходным слоем центроидов, чтобы сопоставить каждому центроиду идентификатор соответствующего склада. Присоедините таблицу к слою центроидов. Из всех столбцов таблицы можно присоединить только один — идентификатор источника. примечание: если вы забыли, как выполняется присоединение таблиц в ГИС, обратитесь к соответствующему разделу упражнения 8 После того, как вы осуществите присоединение, таблица атрибутов слоя центроидов примет следующий вид: Теперь мы создадим диаграмму Вороного (Voronoy diagram) точек центроидов. Диаграмма Вороного разбивает пространство вокруг точек на полигоны, причём каждый полигон ограничивает область пространства, более близких к одной из исходных точек, чем к остальным точкам. Поскольку каждый полигон диаграммы Вороного унаследует атрибуты исходных точек и поскольку в атрибутах точек содержится идентификатор ближайшего склада, мы сможем выделить области пространства, ближайшие к каждому складу при движении по сети автодорог. Полигоны диаграммы Вороного иногда называют полигонами Тиссена (Thiessen polygons). Распространено также некорректное название «полигоны Вороного» — именно оно используется в QGIS. Откройте интерфейс инструмента построения диаграммы Вороного («Вектор» — «Обработка геометрии» — «Полигоны Вороного…»). Задайте исходный слой для построения, оставьте параметр «Буферная область» по умолчанию и запустите расчёт. Результат будет выглядеть аналогично представленному на рисунке ниже: Объедините полигоны с одинаковыми идентификаторами источников. Для этого воспользуйтесь уже знакомой вам функцией объединения по признаку. Полученные полигоны представляют зоны обслуживания (service areas) для каждой из исходных точек. Создайте карту-схему зон обслуживания и вставьте её в отчётный документ. На карте-схеме должны быть показаны положения складов и границы зон обслуживания, соответствующих им. Желательно использовать цветовой фон для изображения разных складов и зон. Также схема должна иметь необходимую географическую основу (можно пользоваться базовой картой из Интернета), название и масштабную линейку. Добавлять легенду не обязательно. Изображение №5. Зоны обслуживания "],["geocoding.html", "Упражнение 14 Адресное геокодирование и ядерная оценка плотности 14.1 Введение 14.2 Получение исходных данных 14.3 Тестирование работы сервиса геокодирования 14.4 Импорт списка адресов в QGIS 14.5 Установка модуля пакетного геокодирования 14.6 Пакетное геокодирование 14.7 Картографирование плотности объявлений", " Упражнение 14 Адресное геокодирование и ядерная оценка плотности Контрольный лист 14.1 Введение Цель задания — научиться создавать новые наборы пространственных данных с использованием геокодирования Необходимая теоретическая подготовка: модели пространственных данных, модели пространственных объектов, базы пространственных объектов, системы координат, геокодирование, адресное геокодирование, ядерная оценка плотности Необходимая практическая подготовка: Знание основных компонент интерфейса QGIS (менеджер источников данных, таблица слоёв, фрейм карты, менеджер компоновок). Работа с различными форматами источников пространственных данных . Настройка символики и подписей объектов. Владение базовыми ГИС-технологиями. Исходные данные: отсутствуют (вся необходимая информация загружается в процессе работы) Результат: геокодированные точки объявлений о продаже недвижимости, карта плотности объявлений 14.1.1 Контрольный лист Получить список адресов с веб-сайта в виде электронной таблицы Загрузить таблицу в QGIS Выполнить геокодирование с использованием сервиса Nominatim Проанализировать результат, определить проблемы, мешающие геокодированию Исправить таблицу в соответсвии с выявленными проблемами Повторно выполнить геокодирование, получить координаты точек, заданных адресами Выполнить ядерную оценку плотности полученных точек Визуализировать результат в виде карты-схемы 14.1.2 Аннотация Геокодирование (англ. geocoding) — это определение координат объектов по их географическим текстовым описаниям, которые, как правило, выражены в виде адресов и/или почтовых кодов. Геокодирование широко применяется в тех сферах, где входящая информация поступает массово, но не имеет прямой географической привязки. Примеры такой информации: места дорожно-транспортных происшествий, адреса объектов недвижимости для продажи или сдачи в аренду, IP-адреса отправителей и получателей сообщений в сети Интернет. Для обеспечения геокодирования необходимо иметь обширную и постоянно обновляемую базу пространственных данных, где каждому адресу сопоставлены географические координаты. Другой компонент геокодирования — подсистема парсинга адреса, которая преобразует поданную на вход текстовую строку в вид, пригодный для автоматического распознавания геокодером. Существует и противоположная операция — обратное геокодирование (англ. reverse geocoding), в ходе которого по заданным географическим координатам определяются почтовые или сетевые адреса. Оперативное и достоверное геокодирование представляет большой интерес для различных групп пользователей — от служб доставок до спасателей и полиции. В то же время, для обеспечения пригодности результатов геокодирования требуется создать и поддерживать в актуальном состоянии обширную базу пространственных данных, а также предусмотреть надёжный интерфейс для обращения к сервису. Это превращает геокодирование в конкурентную бизнес-услугу. Существует ряд коммерческих сервисов, предоставляющих услуги геокодирования: PickPoint, MapQuest, LocationIQ; почти у всех из них есть «демонстрационный» бесплатный режим с ограничением по количеству запросов. Крупные картографические интернет-сервисы, такие, как Google Maps или Яндекс.Карты, предоставляют свои сервисы геокодирования на похожих условиях. Из открытых решений популярностью пользуется сервис Nominatim, использующий данные OpenStreetMap. Результаты геокодирования с помощью Nominatim проигрывают в точности и оперативности результатам коммерческих сервисов (по понятным причинам), но всё же пригодны для использования в научных и учебных целях. Мы воспользуемся сервисом геокодирования Nominatim, чтобы нанести на карту точки, соответствующие объявлениям о продаже недвижимости, предоставленные сайтом ЦИАН. 14.2 Получение исходных данных В начало упражнения ⇡ В качестве исходных данных в этом упражнении мы будем использовать выгрузку объявлений с сайта ЦИАН. Перед началом упражнения следует выбрать охват территории, на которую будет производиться выгрузка. На примерах, приведённых ниже, показаны микрорайоны Московский и Мервино города Рязань. В соответствии с указаниями преподавателя, ваш индивидуальный вариант может быть другим. Откройте сайт ЦИАН В выпадающих списках главной страницы выберите опции поиска, соответствующе следующему запросу: «Купить квартиру на вторичном рынке, любой планировки, любой цены» Нажмите на кнопку «Показать на карте». Отобразите карту таким образом, чтобы охват территории соответствал вашему варианту задания. Нажмите кнопку «Список» в правой части экрана. Под заголовком списка найдите число объявлений, найденных в текущем охвате. Для дальнейшей работы нам нужно, чтобы в вашей подборке было примерно 200 объявлений. Если в списке около 200 объявлений, переходите на следующий шаг инструкции. Если в списке меньше 150 или больше 250 объявлений, вернитесь в окно карты и измените экстент поиска, чтобы в него попало больше или меньше объявлений, а затем снова перейдите в окно списка. Найдите внизу списка кнопку «Сохранить файл в Excel» и нажмите на неё. Файл со списком будет загружен на ваш компьютер под именем offers.xlsx Создайте рабочую директорию и переместите в неё загруженный файл Откройте список любым табличным редактором (например, Microsoft Excel или LibreOffice Calc). Найдите в загруженном файле столбец, в котором записан адрес квартиры. На следующих шагах вы выполните геокодирование адресов и соедините полученные пространственные объекты с текстовой информацией. 14.3 Тестирование работы сервиса геокодирования В начало упражнения ⇡ Прежде чем начинать «пакетное» геокодирование всего списка, мы возьмём несколько отдельных адресов из него и проверим, насколько хорошо работает сервис распознавания адресов Nominatim. Для этого мы воспользуемся страницей интерфейса отладки Nominatim. Откройте страницу интерфейса отладки Nominatim по этой ссылке Интерфейс отладки Nominatim. Используется для тестирования распознавания отдельных адресов Скопируйте любой адрес из вашей таблицы и вставьте его в строку поиска (Search). Нажмите кнопку Search, чтобы запустить поиск Дальнейшее поведение системы зависит от того, насколько успешно парсер смог «прочитать» адрес. Если вся строка адреса распознана корректно, то в окне карты будет отображён объект, соответствующий найденному адресу. Пример успешного геокодирования Если с распознаванием адресов возникли какие-либо трудности, то их можно отследить по выдаче. На рисунке ниже в адресе Рязанская область, Рязань, улица Костычева, 8к1 распознал всё, кроме номера дома, и выдал в качестве результата объект, соответствующий улице. Пример сомнительного результата В этом примере достаточно поставить пробел между номером дома и номером корпуса (8 к1), и Nominatim отработает корректно. Пример результата после исправления входной строки В худшем случае геокодер вообще не сможет определить адрес. В примере ниже (Рязанская область, Рязань, улица Надежды Крупской, 11) геокодер «сломался» уже на названии улицы. Адрес не распознан В этом примере проблема кроется в названии улицы. В Рязани действительно есть улица, названная именем Надежды Крупской, но в OpenStreetMap она называется улица Крупской. С точки зрения Nominatim, улица Надежды Крупской и улица Крупской — это разные улицы. Если изменить запрос на Рязанская область, Рязань, улица Крупской, 11, Nominatim выдаст корректный результат. После изменения названия улицы адрес распознан корректно Подберите три аналогичных примера из вашего набора исходных данных и сделайте скриншоты выдачи сервиса отладки Nominatim. Скриншот 1: успешное распознавание адреса сервисом Nominatim (в ответ на запрос выводится правильный дом) Скриншот 2: неточное или неполное распознавание адреса (в ответ на запрос выводится улица, или неправильный дом, или правильный адрес, но в другом населённом пункте) Скриншот 3: полностью неудачная попытка распознавания (пустая выдача) Мы рассмотрели некоторые потенциальные проблемы с распознаванием адресов, которые возникают при использовании сервиса Nominatim. Следует заметить, что другие, более «продвинутые» сервисы геокодирования могут автоматически распознавать и разрешать проблемы такого рода. 14.4 Импорт списка адресов в QGIS В начало упражнения ⇡ В предыдущих упражнениях вы импортировали табличную информацию в QGIS, пользуясь форматом Comma-Separated Values (CSV). В этом упражнении вы импортируете данные напрямую из таблицы Excel, пользуясь подключаемым модулем Spreadsheet Layers. Создайте проект QGIS и сохраните его в своей рабочей директории Используя функционал модуля QuickMapServices, подключите к проекту QGIS базовую карту OpenStreetMap. Установите модуль Spreadsheet Layers. Модуль доступен в репозитории QGIS, поэтому достаточно ввести его имя в строке поиска. Модуль Spreadsheet Layers в окне управления модулями QGIS После установки модуля найдите опцию импорта табличных данных: меню «Слой» — «Добавить слой» — «Add Spreadsheet Layer». Модуль Spreadsheet Layers в окне управления модулями QGIS В открывшемся окне укажите путь к файлу Excel и страницу, с которой требуется загрузить данные. Выходной слой назовите по шаблону offers-%Фамилия%, где %Фамилия% — ваша фамилия латинскими буквами Инструмент загрузки табличных данных в QGIS При необходимости на этом этапе можно изменить типы данных для столбцов, но в нашем упражнении такой необходимости нет. Нажмите OK, чтобы добавить слой к проекту QGIS. Откройте таблицу атрибутов слоя и убедитесь, что данные из таблицы Excel отображаются корректно. Таблица атрибутов загруженного слоя 14.5 Установка модуля пакетного геокодирования В начало упражнения ⇡ Интерфейс отладки, который мы использовали на ранее, пригоден для геокодирования отдельных адресов, но неудобен для пакетного геокодирования, когда нужно распознавать несколько сотен адресов. Для решения задача пакетного геокодирования на базе QGIS и Nominatim разработано несколько модулей. Мы воспользуемся модулем Bulk Nominatim QGIS Plugin. В отличие от модуля Spreadsheet Layers, этот модуль не содержится в репозитории QGIS, поэтому его придётся установить из ZIP-архива. Перейдите на страницу модуля Bulk Nominatim QGIS Plugin на GitHub: Bulk Nominatim на GitHub Нажмите на кнопку «Code» и в открывшемся выпадающем списке выберите «Download ZIP». Загрузка архива Перенесите загруженный ZIP-архив в вашу рабочую директорию. Вернитесь в QGIS и установите модуль из ZIP-файла Установка модуля из ZIP-файла После установки модуля его инструменты будут доступны через меню «Модули» — «Nominatim GeoCoding» или при помощи кнопок на панели инструменов. Инструменты модуля Bulk GeoCoding 14.6 Пакетное геокодирование В начало упражнения ⇡ Теперь, когда вы установили инструмент для пакетного геокодирования, можно попытаться выполнить распознавание адресов при помощи Nominatim. Откройте интерфейс настройки модуля Bulk Geocoding («Модули» — «Nominatim GeoCoding» — «Settings»). Установите максимальное число объектов для геокодирования (Maximum Features to Geocode) равным \\(200\\). Настройки модуля Bulk GeoCoding Запустите инструмент Bulk GeoCoding. В открывшемся окне укажите исходный слой и поле, из которого будут взяты адреса. Настройки пакетного геокодирования Убедитесь, что вы подключены к Интернету. Нажмите кнопку OK, чтобы запустить процесс пакетного геокодирования. Не закрывайте окно инструмента. Результат геокодирования будет представлен в виде временного точечного слоя. Когда инструмент завершит работу, обратите внимание на выдачу в поле Results. В этом поле отображаются адреса, которые не удалось распознать. Скопируйте эти адреса в отдельный текстовый документ и сохраните этот документ в вашу рабочую директорию. Нераспознанные адреса Закройте окно инструмента и изучите распределение точек, которые были созданы в ходе геокодирования. На рисунке ниже все точки адресов, за исключением двух, группируются в северо-западной части карты. Две отлетающих точки попали в другие населённые пункты. Неправильно распознанные адреса: несколько точек «вылетело» далеко за пределы целевой территории Но и среди точек, попавших в правильный населённый пункт, есть ситуации некорректного и неточного распознавания. При правильном распознавании точка устанавливается поверх здания, имеющего соответствующий адрес. Если точка располагается поверх линейного объекта, как на рисунке ниже, это тоже следует считать ошибкой: распознано название улицы, но не распознан номер дома. Неправильно распознанные адреса: точки установлены поверх улиц Сделайте скриншот окна QGIS после первой попытки геокодирования. Покажите полный охват точечного слоя. Скриншот 1: Результат геокодирования исходной таблицы адресов На следующих шагах мы постараемся систематизировать ситуации, которые приводят к некорректным распознаваниям, и внести правки в соответствующие записи. Строго говоря, правки можно сделать непосредственно в Excel, но, поскольку одной из наших задач является освоение геоинформационного ПО, мы воспользуемся возможностями QGIS. Сохраните слой под именем offers (вашу таблицу с адресами) в формат GeoPackage. Для этого в контекстном меню слоя выберите «Экспорт» — «Сохранить объекты как…». В открывшемся окне укажите имя выходного файла (geocoding_%Фамилия%) и имя слоя (input_table_%Фамилия%). В разделе «Геометрия» обязательно установите тип «Без геометрии». Убедитесь, что опция «Добавить слой в проект» включена. Сохранение таблицы После добавления слоя удалите из проекта старую таблицу, а новый слой переименуйте, убрав из названия имя выходного файла. Изучите списки адресов, которые не были геокодированы или были кодированы с ошибками. Определите возможные причины ошибок. В каждом наборе исходных данных причины ошибок могут быть разными. В демонстрационном наборе наиболее заметны следующие причины: Несовпадения в названиях улиц. Например, Nominatim не распознаёт такие записи, как улица Надежды Крупской или Улица Александра Полина. Вместо них следует подставить улица Крупской и улица Полина, соответственно; Пунктуация в номерах домов. В OpenStreetMap литеры, корпуса, владения и другие «дополнительные» элементы номера дома традиционно вносятся через пробел, например 8 к2. В исходной же таблице эти элементы написаны слитно (8к2). Используя калькулятор полей, отредактируйте поле адресов, чтобы привести адреса в вид, пригодный для использования с Nominatim. В приведённых выше примерах это делается следующим образом: Проблема с полным названием улицы решается использованием строковой функции replace, которая заменяет одну подстроку другой: replace(\"Адрес\", 'улица Надежды Крупской', 'улица Крупской') replace(\"Адрес\", 'улица Александра Полина', 'улица Полина') Чтобы отделить номер корпуса от номера дома, замена с помощью replace уже не поможет, потому что нужно вставить пробел не перед каждой буквой к, а только перед теми, которые содержатся в номере дома. Здесь нам на помощь придут регулярные выражения и функция QGIS regexp_replace. Выражение, приведённое ниже, ищет вхождения буквы к, стоящие после любой цифры (0 - 9), и заменяет его на \\_к (т.е. ставит пробел перед буквой): regexp_replace(\"Адрес\", '(.*[0-9])к(.*)', '\\\\1 к\\\\2') Подробное изучение операторов и синтаксиса регулярных выражений выходит за рамки нашего курса. После внесения необходимых правок в поле «Адрес» удалите из списка слоёв предыдущий результат геокодирования, а затем выполните геокодирование повторно. Изучите новый результат геокодирования. Если из 200 имеющихся адресов корректно распознано менее 150, повторите шаги 11–12. Добейтесь корректного позициронирования по крайней мере 150 адресов. Сохранение таблицы После получения пригодного результата перепроецируйте его в подходящую систему координат («Вектор» — «Управление данными» — «Перепроецировать слой…») и сохраните в тот же GeoPackage, где лежит исходная таблица. Назовите его points. Удалите временный слой с результатом распознавания из таблицы слоёв Запустите редактирование слоя точек и удалите все точки, которые находятся за пределами вашего участка. После удаления увеличьте изображение до охвата слоя и сделайте снимок экрана и ответьте на контрольный вопрос. Скриншот 2: Результат геокодирования отредактированной таблицы адресов 14.7 Картографирование плотности объявлений В начало упражнения ⇡ В результате геокодирования вы получили набор точек, каждая из которых соответствует одному объявлению о продаже недвижимости. При этом точки объявлений с одинаковым адресом будут иметь полностью совпадающие координаты. Поэтому визуальное отображение адресов даёт искажённое представление о распределении продаваемой недвижимости по территории. Чтобы получить более достоверное распределение, можно перейти от дискретного представления явления (отдельные точки) к континуальному представлению (поле плотности). Для решения этой задачи применяется ядерная оценка плотности (kernel density estimation). Результатом ядерной оценки плотности является растр (регулярная сетка), каждая ячейка которой характеризует плотность явления или его ожидаемое количество. Примечание: результат ядерной оценки плотности зачастую называют «тепловой картой» или «теплокартой», поскольку при удачно подобранных графических средствах области высокой концентрации явления выглядят «яркими», «горячими», а области низкой концентрации — «тёмными», «холодными». Несмотря на широкое распространение этих названий, мы не рекомендуем пользоваться ими в географических исследованиях, чтобы избежать путаницы с картами климатических и метеорологических характеристик, где «тепло» и «холодно» используются в прямом смысле. Для выполнения ядерной оценки плотности в QGIS имеется инструмент Тепловая карта (оценка плотности ядер). Его можно найти в панели инструментов анализа, в разделе «Интерполяция» Инструмент ядерной оценки плотности в QGIS Запустите инструмент ядерной оценки плотности. В качестве исходного слоя задайте геокодированные точки Проверьте предлагаемое значение в поле «Радиус». Если возле поля «Радиус» изображён предупреждающий знак, а предлагаемая единица измерения — градусы, значит, ваш исходный слой сохранён в географической системе координат. Выполните перепроецирование слоя (шаг 14 предыдущего раздела). Если с единицами измерения всё в порядке, установите радиус равным 250 м. Это охват области, на которую будет «распределяться» плотность точек. Установите размер пиксела по X и по Y равным 5 м. Этого вполне достаточно для аппроксимации. Укажите, что результирующий слой (Heatmap) нужно сохранить в вашу рабочую директорию под именем heatmap_%Фамилия%.tif, где %Фамилия% — ваша фамилия латинскими буквами Настройки ядерной оценки плотности Запустите инструмент ядерной оценки плотности и дождитесь, пока результат оценки будет добавлен к карте. После этого закройте инструмент ядерной оценки плотности. Результат ядерной оценки плотности Поместите слой исходных точек над слоем ядерной оценки плотности. Откройте свойства слоя ядерной оценки плотности на вкладке «Стиль». Измените цветовую схему на «Одноканальное псевдоцветное». Округлите максимальное отображаемое значение вверх до ближайшего целого числа, кратного 5. Измените тип интерполяции на «Линейную», задайте точность подписи равной 0, режим классификации — «Равные интервалы». Установите число интервалов, равное или пропорциональное максимальному значению. Результат ядерной оценки плотности Нажмите правой кнопкой на изображение шкалы (градиента) и активируйте опцию «Инвертировать градиент». Перейдите на вкладку «Прозрачность» и установите прозрачность слоя равной 50 %. В результате применения описанных настроек вы получите изображение ядерной оценки, аналогичное представленному ниже: Результат ядерной оценки плотности Сделайте снимок экрана. Скриншот 3: Ядерная оценка плотности объявлений о продаже недвижимости Создайте картографическое изображение на основе имеющихся пространственных данных. Создайте макет компоновки, добавьте на него картографическое изображение, легенду, масштабную линейку, название карты и сведения об авторстве. Для картографического изображения настройте градусную сетку. В легенде сохраните только те условные знаки, которые соответствуют тематическому содержанию карты. Экспортируйте карту в формат PNG и вставьте её в отчёт. Рисунок 4: Карта-схема плотности объявлений о продаже недвижимости Ответьте на контрольные вопросы в отчётном файле. "],["manual-catalog.html", "A Форматы пространственных данных A.1 Шейп-файлы A.2 GeoPackage A.3 Базы геоданных ESRI", " A Форматы пространственных данных A.1 Шейп-файлы A.2 GeoPackage A.3 Базы геоданных ESRI "],["manual-crs.html", "B Форматы описания систем координат", " B Форматы описания систем координат В современной практике работы с ГИС применяется три основных формата описания систем координат: Текстовое описание в формате Well-Known Text (WKT); Текстовое описание в формате строки PROJ; Код (индекс) системы координат в одной из широко используемых баз данных — EPSG, ESRI, IAU, SpatialReference.org Формат PROJ — один из трёх стандартных форматов описания систем координат, был предложен разработчиками библиотеки PROJ, используемой для преобразования систем координат пространственных данных (отсюда и название формата). Часто этот формат называют также PROJ.4, поскольку он был введен в 4-й версии библиотеки PROJ. Другой формат — коды EPSG (удобный ресурс для поиска — epsg.io), введённые в оборот для быстрого доступа к наиболее распространенным системам координат. Третий вариант — формат Well-Known Text (WKT), который предоставляет наиболее полные возможности для описания параметров системы координат. Формат WKT является международным стандартом. Ознакомиться с его определением можно на сайте Open Geospatial Consortium. "],["manual-plugins.html", "C Установка модулей в QGIS C.1 Установка модулей C.2 Обновление модулей C.3 Удаление модулей", " C Установка модулей в QGIS Одно из преимуществ QGIS как геоинформационной платформы — наличие большого количества подключаемых модулей (плагинов). Подключаемые модули расширяют возможности QGIS, предоставляя пользователям специализированные инструменты для решения определённых задач — например, для конвертации логов ГНСС-приёмников, геокодирования или получения информации из кадастровых баз данных. С другой стороны, поскольку большинство подключаемых модулей написано сторонними разработчиками, программный код любого модуля может содержать ошибки, приводящей к некорректной работе модуля, или не обеспечивать требуемый функционал. C.1 Установка модулей Существует два пути установки модулей: Установка из репозитория; Установка из ZIP-архива. Для установки новых модулей, обновления или удаления имеющихся модулей следует зайти в меню «Модули» — «Управление модулями…» Установка из репозитория — наиболее удобный способ установки модулей в QGIS. Этот способ требует подключения к Интернету. При запуске команды «Управление модулями…» QGIS производит проверку доступных модулей в репозиториях, сохранённых в списке. По умолчанию в списке присутствует только официальный репозиторий модулей QGIS. Включение модуля в официальный репозиторий даёт некоторые гарантии его стабильной работы: от разработчика требуется поддерживать сайт и репозиторий кода модуля, а также отслеживать сообщения об ошибках. Для установки из репозитория достаточно выбрать вкладку «Все» или «Не установленные» в левой части окна управления модулями, а затем при помощи строки поиска в верхней части найти нужный модуль по названию или ключевым словам. Выбрав нужный модуль из списка подходящих, нажмите кнопку «Установить модуль» в правом нижнем углу. Установка модуля из архива применяется, как правило, для экспериментальных модулей, которые не доведены разработчиками до состояния, пригодного для размещения в открытом репозитории. Для установки модуля из архива необходимо загрузить на компьютер пользователя ZIP-архив с файлами модуля. Затем в окне управления модулями нужно открыть вкладку «Установить из ZIP файла», в этой вкладке указать путь к файлу и нажать на кнопку «Установить модуль» C.2 Обновление модулей Модули, размещённые в открытых репозиториях, периодически получают обновления от разработчиков. Модули, установленные из ZIP-архивов, не получают обновлений автоматически. Для перехода на новую версию модуля нужно получить архив с новой версией, а затем повторить процедуру установки. C.3 Удаление модулей Для удаления модуля нужно выбрать его на вкладке «Установленные», а затем нажать кнопку «Удалить модуль» в правом нижнем углу. "],["mastertest.html", "D Инструкция по регистрации в системе Мастер-тест", " D Инструкция по регистрации в системе Мастер-тест Зайдите на сайт Мастер-Тест Нажмите кнопку «Регистрация» Введите ваше имя и фамилию, а также адрес электронной почты. Придумайте пароль. На указанный e-mail придёт сообщение с кодом. Введите его в поле «Код»: После регистрации в системе перейдите на главную страницу На главной странице укажите, что вы регистрируетесь как студент, и выберите часовой пояс, соответствующий вашему местоположению. Нажмите «Продолжить» Перейдите на вкладку «Мои учителя» и нажмите кнопку «Добавить учителя» в верхней строке. В появившемся окне введите код 9c833c4d и нажмите «Добавить» Доступные вам тесты будут отображаться на вкладке «Активные тесты». "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
